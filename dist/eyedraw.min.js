/*! eyedraw 13-04-2013 */
var ED={};if(ED.handleRadius=15,ED.arrowDelta=4,ED.squiggleWidth={Thin:4,Medium:12,Thick:20},ED.recentClick=!1,ED.eye={Right:0,Left:1},ED.drawFunctionMode={Draw:0,HitTest:1},ED.Mode={None:0,Move:1,Scale:2,Arc:3,Rotate:4,Apex:5,Handles:6,Draw:7,Select:8},ED.handleRing={Inner:0,Outer:1},ED.modified=!1,ED.findOffset=function(t,e,a){if(t.offsetParent){do e+=t.offsetLeft,a+=t.offsetTop;while(t=t.offsetParent);return{left:e,top:a}}},ED.findPosition=function(t,e){if("undefined"!=typeof jQuery)var a=jQuery(t).offset();else var a=ED.findOffset(t,0,0);return{x:e.pageX-a.left,y:e.pageY-a.top}},ED.objectIsEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},ED.isFirefox=function(){var t=0,e=window.navigator.userAgent;return t=e.indexOf("Firefox"),t>0?!0:!1},ED.Mod=function(t,e){return t-Math.floor(t/e)*e},ED.errorHandler=function(t,e,a){console.log("EYEDRAW ERROR! class: ["+t+"] method: ["+e+"] message: ["+a+"]")},ED.randomArray=[.657,.2886,.7388,.1621,.9896,.0434,.1695,.9099,.1948,.4433,.158,.7392,.873,.2165,.7138,.6316,.3425,.2838,.4551,.4153,.7421,.3364,.6087,.1986,.5764,.1952,.6179,.6699,.0903,.2968,.2684,.9383,.2488,.4579,.2921,.9085,.7951,.45,.2255,.3366,.667,.73,.5511,.5623,.1376,.5553,.9898,.4317,.5922,.6452,.5008,.7077,.0704,.2293,.5697,.7415,.1557,.2944,.4566,.4129,.2449,.562,.4105,.5486,.8917,.9346,.0921,.7998,.7717,.0357,.1179,.0168,.152,.5187,.3466,.1663,.5935,.7524,.841,.1859,.6012,.8171,.9272,.3367,.8133,.4868,.3665,.9625,.7839,.3052,.1651,.6414,.7361,.0065,.3267,.0554,.3389,.8967,.8777,.0557,.9201,.6015,.2676,.3365,.2606,.0989,.2085,.3526,.8476,.0146,.019,.6896,.5198,.9871,.0288,.8037,.6741,.2148,.2584,.8447,.848,.5557,.248,.4736,.8869,.1867,.3869,.6871,.1011,.7561,.734,.1525,.9968,.8179,.7103,.5462,.415,.4187,.0478,.6511,.0386,.5243,.7271,.9093,.4461,.1264,.0756,.9405,.7287,.0684,.282,.4059,.3694,.7641,.4188,.0498,.7841,.9136,.621,.2249,.9935,.9709,.0741,.6218,.3166,.2237,.7754,.4191,.2195,.2935,.4529,.9112,.9183,.3275,.1856,.8345,.0442,.6297,.903,.4689,.9512,.2219,.9993,.8981,.1018,.9362,.6426,.4563,.1267,.7889,.5057,.8588,.4669,.0687,.6623,.3681,.8152,.9004,.0822,.3652],ED.Drawing=function(t,e,a,r,i){var o=0,s=0,n=!1;if(this.controllerFunctionName="eyeDrawController",this.graphicsPath="img/",i!==void 0&&(i.offsetX&&(o=i.offsetX),i.offsetY&&(s=i.offsetY),i.toImage&&(n=i.toImage),i.controllerFunctionName&&(this.controllerFunctionName=i.controllerFunctionName),i.graphicsPath&&(this.graphicsPath=i.graphicsPath)),this.canvas=t,this.eye=e,this.IDSuffix=a,this.isEditable=r,this.hoverTimer=null,this.convertToImage=n&&!this.isEditable?!0:!1,this.context=this.canvas.getContext("2d"),this.doodleArray=[],this.bindingArray=[],this.listenerArray=[],this.transform=new ED.AffineTransform,this.inverseTransform=new ED.AffineTransform,this.selectedDoodle=null,this.mouseDown=!1,this.doubleClick=!1,this.mode=ED.Mode.None,this.lastMousePosition=new ED.Point(0,0),this.doubleClickMilliSeconds=250,this.readyNotificationSent=!1,this.newPointOnClick=!1,this.completeLine=!1,this.globalScaleFactor=1,this.scrollValue=0,this.lastDoodleId=0,this.isActive=!1,this.isNew=!0,this.boundElementDeleteValueArray=[],this.canvasParent=this.canvas.parentElement,this.notificationArray=[],this.canvasTooltip=document.getElementById(this.canvas.id+"Tooltip"),this.scale=this.canvas.height/1001,this.doodlePlaneWidth=this.canvas.width/this.scale,this.doodlePlaneHeight=this.canvas.height/this.scale,this.imageArray=[],this.imageArray.LatticePattern=new Image,this.imageArray.CribriformPattern=new Image,this.imageArray.CribriformPatternSmall=new Image,this.imageArray.CryoPattern=new Image,this.imageArray.AntPVRPattern=new Image,this.imageArray.LaserPattern=new Image,this.imageArray.FuchsPattern=new Image,this.imageArray.PSCPattern=new Image,this.imageArray.MeshworkPatternLight=new Image,this.imageArray.MeshworkPatternMedium=new Image,this.imageArray.MeshworkPatternHeavy=new Image,this.imageArray.NewVesselPattern=new Image,this.transform.translate(this.canvas.width/2,this.canvas.height/2),this.transform.scale(this.scale,this.scale),this.inverseTransform=this.transform.createInverse(),this.clear(),this.moveToFrontButton=document.getElementById("moveToFront"+this.IDSuffix),this.moveToBackButton=document.getElementById("moveToBack"+this.IDSuffix),this.flipVerButton=document.getElementById("flipVer"+this.IDSuffix),this.flipHorButton=document.getElementById("flipHor"+this.IDSuffix),this.deleteSelectedDoodleButton=document.getElementById("deleteSelectedDoodle"+this.IDSuffix),this.lockButton=document.getElementById("lock"+this.IDSuffix),this.unlockButton=document.getElementById("unlock"+this.IDSuffix),this.squiggleSpan=document.getElementById("squiggleSpan"+this.IDSuffix),this.colourPreview=document.getElementById("colourPreview"+this.IDSuffix),this.fillRadio=document.getElementById("fillRadio"+this.IDSuffix),this.thickness=document.getElementById("thicknessSelect"+this.IDSuffix),this.selectionRectangleIsBeingDragged=!1,this.selectionRectangleStart=new ED.Point(0,0),this.selectionRectangleEnd=new ED.Point(0,0),this.isEditable){var l=this;this.canvas.addEventListener("mousedown",function(t){var e=ED.findPosition(this,t),a=new ED.Point(e.x,e.y);l.mousedown(a)},!1),this.canvas.addEventListener("mouseup",function(t){var e=ED.findPosition(this,t),a=new ED.Point(e.x,e.y);l.mouseup(a)},!1),this.canvas.addEventListener("mousemove",function(t){var e=ED.findPosition(this,t),a=new ED.Point(e.x,e.y);l.mousemove(a)},!1),this.canvas.addEventListener("mouseover",function(t){var e=ED.findPosition(this,t),a=new ED.Point(e.x,e.y);l.mouseover(a)},!1),this.canvas.addEventListener("mouseout",function(t){var e=ED.findPosition(this,t),a=new ED.Point(e.x,e.y);l.mouseout(a)},!1),this.canvas.addEventListener("touchstart",function(t){if(void 0!==t.targetTouches[0]){var e=new ED.Point(t.targetTouches[0].pageX-this.offsetLeft,t.targetTouches[0].pageY-this.offsetTop);t.preventDefault()}l.mousedown(e)},!1),this.canvas.addEventListener("touchend",function(t){if(void 0!==t.targetTouches[0]){var e=new ED.Point(t.targetTouches[0].pageX-this.offsetLeft,t.targetTouches[0].pageY-this.offsetTop);l.mouseup(e)}},!1),this.canvas.addEventListener("touchmove",function(t){if(void 0!==t.targetTouches[0]){var e=new ED.Point(t.targetTouches[0].pageX-this.offsetLeft,t.targetTouches[0].pageY-this.offsetTop);l.mousemove(e)}},!1),window.addEventListener("keydown",function(t){document.activeElement&&"CANVAS"==document.activeElement.tagName&&l.keydown(t)},!0),this.canvas.onselectstart=function(){return!1}}},ED.Drawing.prototype.init=function(){this.preLoadImagesFrom(this.graphicsPath)},ED.Drawing.prototype.replaceWithImage=function(){var t=document.createElement("img");if(t.setAttribute("src",this.canvas.toDataURL("image/png")),this.canvasParent.hasChildNodes())for(;this.canvasParent.childNodes.length>=1;)this.canvasParent.removeChild(this.canvasParent.firstChild);this.canvasParent.appendChild(t)},ED.Drawing.prototype.preLoadImagesFrom=function(t){var e=this;for(var a in this.imageArray)this.imageArray[a].onload=function(){e.checkAllLoaded()},this.imageArray[a].onerror=function(){ED.errorHandler("ED.Drawing","preLoadImagesFrom","Error loading image files from directory: "+t)},this.imageArray[a].src=t+a+".gif"},ED.Drawing.prototype.checkAllLoaded=function(){var t=!0;for(var e in this.imageArray){var a=!1;this.imageArray[e].width>0&&(a=!0),t=t&&a}t&&(this.readyNotificationSent||(this.readyNotificationSent=!0,this.notify("ready")))},ED.Drawing.prototype.registerForNotifications=function(t,e,a){e===void 0&&(e="notificationHandler"),a===void 0&&(a=[]),this.notificationArray[this.notificationArray.length]={object:t,methodName:e,notificationList:a}},ED.Drawing.prototype.unRegisterForNotifications=function(t){var e=this.notificationArray.indexOf(t);e>=0&&this.notificationArray.splice(e,1)},ED.Drawing.prototype.notify=function(t,e){for(var a={eventName:t,selectedDoodle:this.selectedDoodle,object:e},r=0;this.notificationArray.length>r;r++){var i=this.notificationArray[r].notificationList,o=this.notificationArray[r].object,s=this.notificationArray[r].methodName;(0==i.length||i.indexOf(t)>=0)&&(o[s]!==void 0?o[s].apply(o,[a]):ED.errorHandler("ED.Drawing","notify","Attempt to call undefined notification handler method"))}},ED.Drawing.prototype.loadDoodles=function(t){var e=document.getElementById(t);if(e&&e.value.length>0){var a=window.JSON.parse(e.value);this.load(a),this.isNew=!1,this.notify("doodlesLoaded")}},ED.Drawing.prototype.load=function(t){for(var e=0;t.length>e;e++){if(void 0===ED[t[e].subclass]){ED.errorHandler("ED.Drawing","load","Unrecognised doodle: "+t[e].subclass);break}if(this.doodleArray[e]=new ED[t[e].subclass](this,t[e].originX,t[e].originY,t[e].radius,t[e].apexX,t[e].apexY,t[e].scaleX,t[e].scaleY,t[e].arc,t[e].rotation,t[e].order),this.doodleArray[e].id=e,t[e].squiggleArray!==void 0)for(var a=0;t[e].squiggleArray.length>a;a++){for(var r=t[e].squiggleArray[a].colour,i=new ED.Colour(r.red,r.green,r.blue,r.alpha),o=t[e].squiggleArray[a].thickness,s=t[e].squiggleArray[a].filled,n=new ED.Squiggle(this.doodleArray[e],i,o,s),l=t[e].squiggleArray[a].pointsArray,h=0;l.length>h;h++){var d=new ED.Point(l[h].x,l[h].y);n.addPoint(d)}n.complete=!0,this.doodleArray[e].squiggleArray.push(n)}if(t[e].params!==void 0)for(var a=0;t[e].params.length>a;a++){var c=t[e].params[a].name,p=t[e].params[a].value;this.doodleArray[e].setParameterFromString(c,p)}}this.doodleArray.sort(function(t,e){return t.order-e.order})},ED.Drawing.prototype.save=function(){return"["+this.json()+"]"},ED.Drawing.prototype.json=function(){for(var t="",e=0;this.doodleArray.length>e;e++){var a=this.doodleArray[e];a.isSaveable&&(t=t+a.json()+",")}return t=t.substring(0,t.length-1)},ED.Drawing.prototype.drawAllDoodles=function(){var t=this.context;t.beginPath();for(var e,a=!1,r=0;this.doodleArray.length>r;r++)this.doodleArray[r].isPointInLine&&(a?t.lineTo(this.doodleArray[r].originX,this.doodleArray[r].originY):(t.moveTo(this.doodleArray[r].originX,this.doodleArray[r].originY),a=!0,e=new ED.Point(this.doodleArray[r].originX,this.doodleArray[r].originY)));this.completeLine&&e!==void 0&&t.lineTo(e.x,e.y),a&&(t.lineWidth=4,t.strokeStyle="rgba(20,20,20,1)",t.stroke());for(var r=0;this.doodleArray.length>r;r++)this.context.save(),this.doodleArray[r].draw(),this.context.restore()},ED.Drawing.prototype.mousedown=function(t){this.mouseDown=!0,ED.recentClick&&(this.doubleClick=!0),ED.recentClick=!0,setTimeout("ED.recentClick = false;",this.doubleClickMilliSeconds);var e=!1;this.selectedDoodle=null;for(var a=this.doodleArray.length-1;a>-1;a--)e?(this.doodleArray[a].isSelected=!1,this.doodleArray[a].isForDrawing=!1):(this.context.save(),this.doodleArray[a].draw(t)?this.doodleArray[a].isSelectable&&!this.doodleArray[a].isLocked&&(this.doubleClick&&this.doodleArray[a].isSelected&&this.doodleArray[a].isDrawable&&(this.doodleArray[a].isForDrawing=!0),this.doodleArray[a].isSelected=!0,this.selectedDoodle=this.doodleArray[a],e=!0,this.notify("doodleSelected"),!this.doubleClick&&this.doodleArray[a].isForDrawing&&this.doodleArray[a].addSquiggle()):(this.doodleArray[a].isSelected=!1,this.doodleArray[a].isForDrawing=!1),this.context.restore()),this.doodleArray[a].isBeingDragged=!1;if(this.newPointOnClick&&!e){var r=this.inverseTransform.transformPoint(t),i=this.addDoodle("PointInLine");i.originX=r.x,i.originY=r.y}this.repaint(),this.notify("mousedown",{drawing:this,point:t})},ED.Drawing.prototype.mousemove=function(t){this.notify("mousemove",{drawing:this,point:t});var e="";this.startHoverTimer(t);var a=this.selectedDoodle;if(this.mouseDown&&null!=a){if(a.isBeingDragged){var r=this.inverseTransform.transformPoint(t),i=this.inverseTransform.transformPoint(this.lastMousePosition),o=a.inverseTransform.transformPoint(t),s=a.inverseTransform.transformPoint(this.lastMousePosition),n=new ED.Point(t.x-this.canvas.width/2,t.y-this.canvas.height/2),l=new ED.Point(this.lastMousePosition.x-this.canvas.width/2,this.lastMousePosition.y-this.canvas.height/2),h=new ED.Point(0,0),d=new ED.Point(0,-100),c=new ED.Point(a.originX,a.originY),p=new ED.Point(a.originX,a.originY-100);switch(this.mode){case ED.Mode.None:break;case ED.Mode.Move:if(a.isMoveable){var D=a.originX,u=a.originY;if(a.snapToGrid){var y=r.x-a.gridDisplacementX,g=Math.floor(y/a.gridSpacing),E=ED.Mod(y,a.gridSpacing);D=a.gridDisplacementX+a.gridSpacing*(g+Math.round(E/a.gridSpacing));var f=r.y-a.gridDisplacementY,m=Math.floor(f/a.gridSpacing),P=ED.Mod(f,a.gridSpacing);u=a.gridDisplacementY+a.gridSpacing*(m+Math.round(P/a.gridSpacing)),a.move(D-a.originX,u-a.originY)}else a.snapToQuadrant?(0!=r.x&&(D=a.quadrantPoint.x*r.x/Math.abs(r.x)),0!=r.y&&(u=a.quadrantPoint.y*r.y/Math.abs(r.y)),a.move(D-a.originX,u-a.originY)):a.snapToPoints?(D=a.nearestPointTo(r).x,u=a.nearestPointTo(r).y,a.move(D-a.originX,u-a.originY)):a.move(r.x-i.x,r.y-i.y);e="move"}else if(a.isRotatable){var w=this.innerAngle(d,h,l),b=this.innerAngle(d,h,n),M=b-w;if(a.snapToAngles)var v=a.nearestAngleTo(b);else var v=ED.Mod(a.rotation+M,2*Math.PI);a.setSimpleParameter("rotation",a.parameterValidationArray.rotation.range.constrainToAngularRange(v,!1)),a.updateDependentParameters("rotation");var A=Math.sqrt(i.x*i.x+i.y*i.y),x=Math.sqrt(r.x*r.x+r.y*r.y),S=a.radius+(x-A);a.setSimpleParameter("radius",a.parameterValidationArray.radius.range.constrain(S)),a.updateDependentParameters("radius")}break;case ED.Mode.Scale:if(a.isScaleable){var C=a.scaleX/Math.abs(a.scaleX),T=a.scaleY/Math.abs(a.scaleY),k=o.x/s.x,I=o.y/s.y;a.isSqueezable||(I=k>I?k:k),k>0&&I>0?(newScaleX=a.scaleX*k,newScaleY=a.scaleY*I,newScaleX=a.parameterValidationArray.scaleX.range.constrain(Math.abs(newScaleX)),newScaleY=a.parameterValidationArray.scaleY.range.constrain(Math.abs(newScaleY)),a.setSimpleParameter("scaleX",newScaleX*C),a.setSimpleParameter("scaleY",newScaleY*T),a.updateDependentParameters("scaleX"),a.updateDependentParameters("scaleY")):this.mode=ED.Mode.None}break;case ED.Mode.Arc:var b=this.innerAngle(p,c,o),w=this.innerAngle(p,c,s),H=b-w;a.isArcSymmetrical&&(H=2*H),rotationCorrection=1,2>a.draggingHandleIndex&&(H=-H,rotationCorrection=-1),a.parameterValidationArray.arc.range.isBelow(a.arc+H)?(H=a.parameterValidationArray.arc.range.min-a.arc,a.setSimpleParameter("arc",a.parameterValidationArray.arc.range.min),this.mode=ED.Mode.None):a.parameterValidationArray.arc.range.isAbove(a.arc+H)?(H=a.parameterValidationArray.arc.range.max-a.arc,a.setSimpleParameter("arc",a.parameterValidationArray.arc.range.max),this.mode=ED.Mode.None):a.setSimpleParameter("arc",a.arc+H),a.updateDependentParameters("arc"),a.isArcSymmetrical||(rotationCorrection=rotationCorrection*H/2,a.setSimpleParameter("rotation",a.rotation+rotationCorrection),a.updateDependentParameters("rotation"));break;case ED.Mode.Rotate:if(a.isRotatable){var w=this.innerAngle(p,c,i),b=this.innerAngle(p,c,r),H=b-w;a.setSimpleParameter("rotation",a.rotation+H),a.updateDependentParameters("rotation")}break;case ED.Mode.Apex:var Y=a.apexX+(o.x-s.x),R=a.apexY+(o.y-s.y);a.setSimpleParameter("apexX",a.parameterValidationArray.apexX.range.constrain(Y)),a.setSimpleParameter("apexY",a.parameterValidationArray.apexY.range.constrain(R)),a.updateDependentParameters("apexX"),a.updateDependentParameters("apexY");break;case ED.Mode.Handles:var F=a.draggingHandleIndex,V=new ED.Point(0,0);if(V.x=a.squiggleArray[0].pointsArray[F].x+(o.x-s.x),V.y=a.squiggleArray[0].pointsArray[F].y+(o.y-s.y),a.handleCoordinateRangeArray!==void 0&&(V.x=a.handleCoordinateRangeArray[F].x.constrain(V.x),V.y=a.handleCoordinateRangeArray[F].y.constrain(V.y)),a.handleVectorRangeArray!==void 0){var X=a.handleVectorRangeArray[F].length.constrain(V.length()),W=a.handleVectorRangeArray[F].angle.constrainToAngularRange(V.direction(),!1);V.setWithPolars(X,W)}a.squiggleArray[0].pointsArray[F].x=V.x,a.squiggleArray[0].pointsArray[F].y=V.y,a.updateDependentParameters("handles");break;case ED.Mode.Draw:var z=new ED.Point(o.x,o.y);a.addPointToSquiggle(z);break;case ED.Mode.Select:var z=new ED.Point(o.x,o.y);console.log("Selecting ",z.x,z.y);break;default:}}else a.isBeingDragged=!0;this.lastMousePosition=t,this.notify("mousedragged",{point:t,action:e}),this.repaint()}},ED.Drawing.prototype.mouseup=function(t){this.mouseDown=!1,this.doubleClick=!1,this.mode=ED.Mode.None,this.selectionRectangleIsBeingDragged=!1,null!=this.selectedDoodle&&(this.selectedDoodle.isBeingDragged=!1,this.selectedDoodle.isDrawable&&(this.selectedDoodle.completeSquiggle(),this.drawAllDoodles()),this.selectedDoodle.willStaySelected||(this.selectedDoodle.isSelected=!1,this.selectedDoodle=null)),this.repaint(),this.notify("mouseup",t)},ED.Drawing.prototype.mouseover=function(t){this.isActive=!0,this.notify("mouseover",t)},ED.Drawing.prototype.mouseout=function(t){this.isActive=!1,this.stopHoverTimer(),this.mouseDown=!1,this.mode=ED.Mode.None,null!=this.selectedDoodle&&(this.selectedDoodle.isBeingDragged=!1,this.selectedDoodle.isDrawable&&(this.selectedDoodle.completeSquiggle(),this.drawAllDoodles())),this.notify("mouseout",t)},ED.Drawing.prototype.keydown=function(t){if(null!=this.selectedDoodle){switch(t.keyCode){case 8:"Label"!=this.selectedDoodle.className&&this.deleteSelectedDoodle();break;case 37:this.selectedDoodle.move(-ED.arrowDelta,0);break;case 38:this.selectedDoodle.move(0,-ED.arrowDelta);break;case 39:this.selectedDoodle.move(ED.arrowDelta,0);break;case 40:this.selectedDoodle.move(0,ED.arrowDelta);break;default:}var e=0;16!=t.keyCode&&(t.keyCode>=65&&90>=t.keyCode?e=t.shiftKey?t.keyCode:t.keyCode+32:32==t.keyCode||t.keyCode>47&&58>t.keyCode?e=t.keyCode:222==t.keyCode?e=t.shiftKey?34:39:186==t.keyCode?e=t.shiftKey?58:59:188==t.keyCode||190==t.keyCode?(188==t.keyCode&&(e=44),190==t.keyCode&&(e=46)):8==t.keyCode?"Label"==this.selectedDoodle.className&&(e=t.keyCode):13==t.keyCode&&(e=13)),13==e?this.deselectDoodles():e>0&&"Label"==this.selectedDoodle.className&&this.selectedDoodle.addLetter(e),this.repaint(),t.stopPropagation(),t.preventDefault(),this.notify("keydown",t.keyCode)}},ED.Drawing.prototype.startHoverTimer=function(t){if(this.isEditable&&null!=this.canvasTooltip){this.stopHoverTimer();var e=this;this.hoverTimer=setTimeout(function(){e.hover(t)},1e3)}},ED.Drawing.prototype.stopHoverTimer=function(){null!=this.canvasTooltip&&(clearTimeout(this.hoverTimer),this.canvasTooltip.innerHTML="",this.hideTooltip())},ED.Drawing.prototype.hover=function(t){this.showTooltip(t),this.notify("hover",t)},ED.Drawing.prototype.showTooltip=function(t){var e=t.x,a=t.y;if(this.canvas.offsetParent){var r,i=this.canvas;do{var o=document.defaultView.getComputedStyle(i,null).getPropertyValue("position");r=!1,null!=o&&"static"==o&&(r=!0,e+=i.offsetLeft,a+=i.offsetTop);var r=r&&(i=i.offsetParent)}while(r)}this.canvasTooltip.style.left=e+"px",this.canvasTooltip.style.top=a+18+"px";for(var s=!1,n=this.doodleArray.length-1;n>-1;n--)s||(this.context.save(),this.doodleArray[n].draw(t)&&(this.canvasTooltip.innerHTML=this.doodleArray[n].tooltip(),s=!0),this.context.restore());this.canvasTooltip.innerHTML.length>0&&(this.canvasTooltip.style.display="block")},ED.Drawing.prototype.hideTooltip=function(){this.canvasTooltip.style.display="none"},ED.Drawing.prototype.moveToFront=function(){if(null!=this.selectedDoodle){this.selectedDoodle.order=1e3,this.doodleArray.sort(function(t,e){return t.order-e.order});for(var t=0;this.doodleArray.length>t;t++)this.doodleArray[t].order=t;this.repaint()}this.notify("moveToFront")},ED.Drawing.prototype.moveToBack=function(){if(null!=this.selectedDoodle){this.selectedDoodle.order=-1,this.doodleArray.sort(function(t,e){return t.order-e.order});for(var t=0;this.doodleArray.length>t;t++)this.doodleArray[t].order=t;this.repaint()}this.notify("moveToBack")},ED.Drawing.prototype.moveNextTo=function(t,e,a){if(this.hasDoodleOfClass(e)){t.order=1e3,this.doodleArray.sort(function(t,e){return t.order-e.order});for(var r=0;this.doodleArray.length>r;r++)this.doodleArray[r].order=r;for(var i=0,r=0;this.doodleArray.length-1>r;r++)this.doodleArray[r].order=r+i,this.doodleArray[r].className==e&&(i=1,a?t.order=r+1:(t.order=r,this.doodleArray[r].order=r+1));this.doodleArray.sort(function(t,e){return t.order-e.order})}},ED.Drawing.prototype.flipVer=function(){null!=this.selectedDoodle&&(this.selectedDoodle.scaleY=-1*this.selectedDoodle.scaleY,this.repaint()),this.notify("flipVer")},ED.Drawing.prototype.flipHor=function(){null!=this.selectedDoodle&&(this.selectedDoodle.scaleX=-1*this.selectedDoodle.scaleX,this.repaint()),this.notify("flipHor")},ED.Drawing.prototype.deleteDoodle=function(t){var e=!1,a="Attempt to delete a doodle that does not exist";if(t.willDelete()){for(var r=0;this.doodleArray.length>r;r++)if(this.doodleArray[r].id==t.id)if(this.doodleArray[r].isDeletable){e=t.className,null!=this.selectedDoodle&&this.selectedDoodle.id==t.id&&(this.selectedDoodle=null);for(var i in t.bindingArray){var o=t.bindingArray[i].id,s=t.bindingArray[i].attribute,n=document.getElementById(o),l=this.boundElementDeleteValueArray[o];if(null!=n&&l!==void 0)switch(n.type){case"checkbox":s?ED.errorHandler("ED.Drawing","deleteDoodle","Binding to a checkbox with a non-standard attribute not yet supported"):"true"==l?n.setAttribute("checked","checked"):n.removeAttribute("checked");break;case"select-one":if(s){for(var h=0;n.length>h;h++)if(n.options[h].getAttribute(s)==l){n.value=n.options[h].value;break}}else n.value=l;break;default:s?n.setAttribute(s,l):n.value=l}t.removeBinding(i)}this.doodleArray.splice(r,1)}else a="Attempt to delete a doodle that is not deletable, className: "+t.className}else a="Doodle refused permission to be deleted, className: "+t.className;if(e){for(var r=0;this.doodleArray.length>r;r++)this.doodleArray[r].order=r;this.repaint(),this.notify("doodleDeleted",e)}else ED.errorHandler("ED.Drawing","deleteDoodle",a)},ED.Drawing.prototype.deleteSelectedDoodle=function(){null!=this.selectedDoodle?this.deleteDoodle(this.selectedDoodle):ED.errorHandler("ED.Drawing","deleteSelectedDoodle","Attempt to delete selected doodle, when none selected")},ED.Drawing.prototype.deleteDoodleOfId=function(t){var e=this.doodleOfId(t);e?this.deleteDoodle(e):ED.errorHandler("ED.Drawing","deleteDoodleOfId","Attempt to delete doodle with invalid id")},ED.Drawing.prototype.lock=function(){if(null!=this.selectedDoodle){for(var t=0;this.doodleArray.length>t;t++)this.doodleArray[t].isSelected&&(this.doodleArray[t].isLocked=!0,this.doodleArray[t].isSelected=!1,this.selectedDoodle=null);this.repaint()}},ED.Drawing.prototype.unlock=function(){for(var t=0;this.doodleArray.length>t;t++)this.doodleArray[t].isLocked=!1;this.repaint()},ED.Drawing.prototype.deselectDoodles=function(){for(var t=0;this.doodleArray.length>t;t++)this.doodleArray[t].isSelected=!1;this.selectedDoodle=null,this.repaint()},ED.Drawing.prototype.selectNextDoodle=function(t){this.scrollValue+=t;var e=t>0?!0:!1,a=96;if(this.scrollValue>a||-a>this.scrollValue){this.scrollValue=0;for(var r=-1,i=0;this.doodleArray.length>i;i++)this.doodleArray[i].isSelected&&(r=i,this.doodleArray[i].isSelected=!1);r>=0&&(e?(r++,r==this.doodleArray.length&&(r=0)):(r--,0>r&&(r=this.doodleArray.length-1)),r==this.doodleArray.length,this.doodleArray[r].isSelected=!0,this.selectedDoodle=this.doodleArray[r]),this.repaint()}},ED.Drawing.prototype.isReady=function(){this.modified=!1,this.convertToImage&&this.replaceWithImage()},ED.Drawing.prototype.addDoodle=function(t,e,a){var r=this.hasDoodleOfClass(t);if(!ED.hasOwnProperty(t))return ED.errorHandler("ED.Drawing","addDoodle","Unable to find definition for subclass "+t),null;var i=new ED[t](this);if(i.isUnique&&this.hasDoodleOfClass(t))return ED.errorHandler("ED.Drawing","addDoodle","Attempt to add a second unique doodle of class "+t),null;for(var o=0;this.doodleArray.length>o;o++)this.doodleArray[o].isSelected=!1;if(e!==void 0)for(var s in e){var n=i.validateParameter(s,e[s]);n.valid?i.setParameterFromString(s,n.value):ED.errorHandler("ED.Drawing","addDoodle","ParameterDefaults array contains an invalid value for parameter "+s)}if(this.selectedDoodle=i,i.scaleX=i.scaleX*this.globalScaleFactor,i.scaleY=i.scaleY*this.globalScaleFactor,i.isDrawable&&(i.isForDrawing=!0),this.doodleArray[this.doodleArray.length]=i,!r)for(var l in this.bindingArray[t]){var h,d=this.bindingArray[t][l].id,c=this.bindingArray[t][l].attribute,p=document.getElementById(d);switch(p.type){case"checkbox":c?ED.errorHandler("ED.Drawing","addDoodle","Binding to a checkbox with a non-standard attribute not yet supported"):h=""+p.checked;break;case"select-one":c?p.selectedIndex>-1&&(h=p.options[p.selectedIndex].getAttribute(c)):h=p.value;break;default:h=c?p.getAttribute(c):p.value}h==this.boundElementDeleteValueArray[d]&&(h=i[l]);var D=i.validateParameter(l,h);D.valid?(i.setParameterFromString(l,D.value),i.updateDependentParameters(l)):(h=i[l],ED.errorHandler("ED.Drawing","addDoodle","Invalid value for parameter: "+l)),i.addBinding(l,this.bindingArray[t][l]),i.setParameterFromString(l,D.value),i.updateDependentParameters(l),this.updateBindings(i)}if(a!==void 0)for(var s in a)i.addBinding(s,a[s]);return i.addAtBack?this.moveToBack():this.repaint(),this.notify("doodleAdded",i),i},ED.Drawing.prototype.addBindings=function(t){this.bindingArray=t;var e=this;for(var a in t){var r=this.firstDoodleOfClass(a);for(var i in t[a]){var o=t[a][i].id,s=document.getElementById(o);s?(s.addEventListener("change",function(){for(var a in e.bindingArray)for(var r in e.bindingArray[a])this.id==t[a][r].id&&(e.hasDoodleOfClass(a)||(e.addDoodle(a),e.deselectDoodles()))},!1),r&&r.addBinding(i,t[a][i])):ED.errorHandler("ED.Drawing","addBindings","Attempt to add binding for an element that does not exist for parameter: "+i)}}},ED.Drawing.prototype.addDeleteValues=function(t){for(elementId in t)this.boundElementDeleteValueArray[elementId]=t[elementId]},ED.Drawing.prototype.eventHandler=function(t,e,a,r,i){switch(t){case"onchange":var o=this.doodleOfId(e);if(o)if(this.boundElementDeleteValueArray[r]==i)this.deleteDoodleOfId(e);else{o.drawing.isActive=!0;var s;for(var n in o.bindingArray)o.bindingArray[n].id==r&&(s=n);var l=o.validateParameter(s,i);if(l.valid?o.setParameterWithAnimation(s,l.value):ED.errorHandler("ED.Drawing","eventHandler","Attempt to change HTML element value to an invalid value for parameter "+s),i!=l.value){var h=document.getElementById(r),d=o.bindingArray[s].attribute;switch(h.type){case"checkbox":d?ED.errorHandler("ED.Drawing","eventHandler","Binding to a checkbox with a non-standard attribute not yet supported"):(console.log("setting checkbox - needs testing with a suitable doodle"),"true"==value?h.setAttribute("checked","checked"):h.removeAttribute("checked"));break;case"select-one":if(d){for(var c=0;h.length>c;c++)if(h.options[c].getAttribute(d)==l.value){h.value=h.options[c].value;break}}else h.value=l.value;break;default:d?h.setAttribute(d,l.value):h.value=l.value}}}else ED.errorHandler("ED.Drawing","eventHandler","Doodle of id: "+e+" no longer exists");break;default:}},ED.isNumeric=function(t){return t-0==t&&t.length>0},ED.Drawing.prototype.updateBindings=function(t){var e=t;if(e===void 0&&(e=this.selectedDoodle),null!=e)for(var a in e.bindingArray){var r=document.getElementById(e.bindingArray[a].id),i=e.bindingArray[a].attribute,o=e.getParameter(a);switch(r.type){case"checkbox":i?ED.errorHandler("ED.Drawing","updateBindings","Binding to a checkbox with a non-standard attribute not yet supported"):"true"==o?r.setAttribute("checked","checked"):r.removeAttribute("checked");break;case"select-one":if(i){for(var s=0;r.length>s;s++)if(r.options[s].getAttribute(i)==o){r.value=r.options[s].value;break}}else r.value=o;break;default:i?r.setAttribute(i,o):r.value=o}}},ED.Drawing.prototype.hasDoodleOfClass=function(t){for(var e=!1,a=0;this.doodleArray.length>a;a++)this.doodleArray[a].className==t&&(e=!0);return e},ED.Drawing.prototype.numberOfDoodlesOfClass=function(t){for(var e=0,a=0;this.doodleArray.length>a;a++)this.doodleArray[a].className==t&&e++;return e},ED.Drawing.prototype.firstDoodleOfClass=function(t){for(var e=!1,a=0;this.doodleArray.length>a;a++)if(this.doodleArray[a].className==t){e=this.doodleArray[a];break}return e},ED.Drawing.prototype.lastDoodleOfClass=function(t){for(var e=!1,a=this.doodleArray.length-1;a>=0;a--)if(this.doodleArray[a].className==t){e=this.doodleArray[a];break}return e},ED.Drawing.prototype.allDoodlesOfClass=function(t){for(var e=[],a=this.doodleArray.length-1;a>=0;a--)this.doodleArray[a].className==t&&e.push(this.doodleArray[a]);return e},ED.Drawing.prototype.setParameterValueForClass=function(t,e,a){for(var r=this.doodleArray.length-1;r>=0;r--)if(this.doodleArray[r].className==a){var i=this.doodleArray[r];i.setParameterWithAnimation(t,e)}this.repaint()},ED.Drawing.prototype.doodleOfId=function(t){for(var e=!1,a=0;this.doodleArray.length>a;a++)if(this.doodleArray[a].id==t){e=this.doodleArray[a];break}return e},ED.Drawing.prototype.deleteAllDoodles=function(){for(var t=this.doodleArray.length-1;t>=0;t--)this.doodleArray[t].isDeletable&&this.deleteDoodle(this.doodleArray[t])},ED.Drawing.prototype.deleteDoodlesOfClass=function(t){for(var e=this.doodleArray.length-1;e>=0;e--)this.doodleArray[e].className==t&&this.deleteDoodle(this.doodleArray[e])},ED.Drawing.prototype.setParameterForDoodle=function(t,e,a){t[e]!==void 0?t[e]=+a:t.setParameterFromString(e,a),this.saveToInputElement!==void 0&&this.saveToInputElement(),this.repaint()},ED.Drawing.prototype.setParameterForDoodleOfClass=function(t,e,a){var r=this.firstDoodleOfClass(t);r.setParameterWithAnimation(e,a),this.saveToInputElement!==void 0&&this.saveToInputElement(),this.repaint()},ED.Drawing.prototype.totalDegreesExtent=function(t){for(var e=0,a=0;this.doodleArray.length>a;a++)this.doodleArray[a].className==t&&(e+=this.doodleArray[a].degreesExtent());return e>360&&(e=360),e},ED.Drawing.prototype.report=function(){for(var t="",e=[],a=[],r=0;this.doodleArray.length>r;r++){var i=this.doodleArray[r];if(i.groupDescription().length>0)e[i.className]===void 0?(e[i.className]=i.groupDescription(),e[i.className]+=i.description()):i.description().length>0&&(e[i.className]+=", ",e[i.className]+=i.description()),i.groupDescriptionEnd().length>0&&a[i.className]===void 0&&(a[i.className]=i.groupDescriptionEnd());else if(i.willReport){var o=i.description();o.length>0&&(0==t.length?t+=o:t=t+", "+o.firstLetterToLowerCase())}}for(className in e){var o=e[className],s="";a[className]!==void 0&&(s=a[className]),o=o.addAndAfterLastComma()+s,o.length>0&&(0==t.length?t+=o:t=t+", "+o.firstLetterToLowerCase())}return t},ED.Drawing.prototype.diagnosis=function(){for(var t=0,e=0,a=0;this.doodleArray.length>a;a++){var r=this.doodleArray[a],i=r.snomedCode();if(i>0){var o=r.diagnosticHierarchy();o>t&&(t=o,e=i)}}return e},ED.Drawing.prototype.setEye=function(t){"Right"==t&&(this.eye=ED.eye.Right),"Left"==t&&(this.eye=ED.eye.Left),this.repaint()},ED.Drawing.prototype.clear=function(){this.canvas.width=this.canvas.width,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.translate(this.canvas.width/2,this.canvas.height/2),this.context.scale(this.scale,this.scale)},ED.Drawing.prototype.repaint=function(){if(this.clear(),this.image!==void 0)if(this.image.width>=this.image.height){var t=1e3*this.image.height/this.image.width;this.context.drawImage(this.image,-500,-t/2,1e3,t)}else{var e=1e3*this.image.width/this.image.height;this.context.drawImage(this.image,-e/2,-500,e,1e3)}if(this.drawAllDoodles(),null!=this.selectedDoodle?(null!==this.moveToFrontButton&&(this.moveToFrontButton.disabled=!1),null!==this.moveToBackButton&&(this.moveToBackButton.disabled=!1),null!==this.flipVerButton&&(this.flipVerButton.disabled=!1),null!==this.flipHorButton&&(this.flipHorButton.disabled=!1),null!==this.deleteSelectedDoodleButton&&this.selectedDoodle.isDeletable&&(this.deleteSelectedDoodleButton.disabled=!1),null!==this.lockButton&&(this.lockButton.disabled=!1),null!==this.squiggleSpan&&this.selectedDoodle.isDrawable&&(this.squiggleSpan.style.display="inline-block")):(null!==this.moveToFrontButton&&(this.moveToFrontButton.disabled=!0),null!==this.moveToBackButton&&(this.moveToBackButton.disabled=!0),null!==this.flipVerButton&&(this.flipVerButton.disabled=!0),null!==this.flipHorButton&&(this.flipHorButton.disabled=!0),null!==this.deleteSelectedDoodleButton&&(this.deleteSelectedDoodleButton.disabled=!0),null!==this.lockButton&&(this.lockButton.disabled=!0),null!==this.squiggleSpan&&(this.squiggleSpan.style.display="none")),null!=this.unlockButton){this.unlockButton.disabled=!0;
for(var a=0;this.doodleArray.length>a;a++)if(this.doodleArray[a].isLocked){this.unlockButton.disabled=!1;break}}var r=document.getElementById(this.canvas.id+"doodleToolbar");if(r){for(var i=r.getElementsByTagName("button"),a=0;i.length>a;a++)i[a].disabled=!1;for(var a=0;this.doodleArray.length>a;a++){var o=document.getElementById(this.doodleArray[a].className+this.IDSuffix);o&&(o.disabled=this.doodleArray[a].isUnique)}}if(this.modified||(this.modified=!0),this.selectionRectangleIsBeingDragged){var s=this.context;s.beginPath(),s.moveTo(this.selectionRectangleStart.x,this.selectionRectangleStart.y),s.lineTo(this.selectionRectangleEnd.x,this.selectionRectangleStart.y),s.lineTo(this.selectionRectangleEnd.x,this.selectionRectangleEnd.y),s.lineTo(this.selectionRectangleStart.x,this.selectionRectangleEnd.y),s.closePath(),s.lineWidth=1,s.strokeStyle="gray",s.stroke()}},ED.Drawing.prototype.innerAngle=function(t,e,a){var r=new ED.Point(t.x-e.x,t.y-e.y),i=new ED.Point(a.x-e.x,a.y-e.y);return r.clockwiseAngleTo(i)},ED.Drawing.prototype.togglePointInLine=function(){this.newPointOnClick?(this.newPointOnClick=!1,this.completeLine=!0,this.deselectDoodles(),this.repaint()):(this.newPointOnClick=!0,this.completeLine=!1)},ED.Drawing.prototype.nextDoodleId=function(){return this.lastDoodleId++},ED.Report=function(t){this.drawing=t,this.breaksInAttached=0,this.breaksInDetached=0,this.largestBreakType="Not found",this.largestBreakSize=0,this.lowestBreakPosition=12,this.pvrType="None",this.pvrCClockHours=0,this.antPvrClockHours=0;var e=0,a=0,r=180,i=[];i.UTear="U tear",i.RoundHole="Round hole",i.Dialysis="Dialysis",i.GRT="GRT",i.MacularHole="Macular hole",i.OuterLeafBreak="Outer Leaf Break",this.rrdArray=[];var o,s;for(o=0;this.drawing.doodleArray.length>o;o++)s=this.drawing.doodleArray[o],"RRD"==s.className&&this.rrdArray.push(s);for(o=0;this.drawing.doodleArray.length>o;o++)if(s=this.drawing.doodleArray[o],"StarFold"==s.className)this.pvrType="C",e+=180*s.arc/Math.PI;else if("AntPVR"==s.className)this.pvrType="C",a+=180*s.arc/Math.PI;else if(s.className in i){var n=0;n="UTear"==s.className||"RoundHole"==s.className||"OuterLeafBreak"==s.className?(Math.round(180*Math.atan2(s.originX,-s.originY)/Math.PI)+360)%360:Math.round(180*s.rotation/Math.PI+360)%360;var l=this.inDetachment(n);l?this.breaksInDetached++:this.breaksInAttached++,l&&s.arc>this.largestBreakSize&&(this.largestBreakSize=s.arc,this.largestBreakType=i[s.className]);var h=Math.abs(n-180);if(l&&r>h){r=h;var d=n+15;c=d%30,this.lowestBreakPosition=Math.floor((d-c)/30),0==this.lowestBreakPosition&&(this.lowestBreakPosition=12)}}e+=25;var c=e%30;this.pvrCClockHours=Math.floor((e-c)/30),a+=25,c=a%30,this.antPvrClockHours=Math.floor((a-c)/30);var p=180*this.largestBreakSize/Math.PI+25,c=p%30;this.largestBreakSize=Math.floor((p-c)/30)},ED.Report.prototype.inDetachment=function(t){var e=!1;for(key in this.rrdArray){var a=this.rrdArray[key],r=180*(a.rotation-a.arc/2)/Math.PI,i=180*(a.rotation+a.arc/2)/Math.PI,r=(r+360)%360,i=(i+360)%360;if(r>i)(t>=0&&i>=t||t>=r&&360>=t)&&(e=!0);else{if(i==r)return!0;t>=r&&i>=t&&(e=!0)}}return e},ED.Report.prototype.extent=function(){var t=[];this.drawing.eye==ED.eye.Right?(t.SN=0,t.IN=0,t.IT=0,t.ST=0):(t.ST=0,t.IT=0,t.IN=0,t.SN=0);var e=15;for(quadrant in t)for(var a=0;3>a;a++){var r=this.inDetachment(e)?1:0;t[quadrant]=t[quadrant]+r,e+=30}return t},ED.Report.prototype.isMacOff=function(){var t=!1;for(key in this.rrdArray){var e=this.rrdArray[key];e.isMacOff()&&(t=!0)}return t},ED.Doodle=function(t,e,a,r,i,o,s,n,l,h,d){if(t!==void 0){this.drawing=t,this.id=this.drawing.nextDoodleId(),this.squiggleArray=[],this.transform=new ED.AffineTransform,this.inverseTransform=new ED.AffineTransform,this.isLocked=!1,this.isSelectable=!0,this.isShowHighlight=!0,this.willStaySelected=!0,this.isDeletable=!0,this.isSaveable=!0,this.isOrientated=!1,this.isScaleable=!0,this.isSqueezable=!1,this.isMoveable=!0,this.isRotatable=!0,this.isDrawable=!1,this.isUnique=!1,this.isArcSymmetrical=!1,this.addAtBack=!1,this.isPointInLine=!1,this.snapToGrid=!1,this.snapToQuadrant=!1,this.snapToPoints=!1,this.snapToAngles=!1,this.willReport=!0,this.willSync=!0;var c=Math.round(this.drawing.doodlePlaneWidth/2),p=Math.round(this.drawing.doodlePlaneHeight/2);if(this.parameterValidationArray={originX:{kind:"simple",type:"int",range:new ED.Range(-c,+c),delta:15},originY:{kind:"simple",type:"int",range:new ED.Range(-p,+p),delta:15},radius:{kind:"simple",type:"float",range:new ED.Range(100,450),precision:6,delta:15},apexX:{kind:"simple",type:"int",range:new ED.Range(-500,500),delta:15},apexY:{kind:"simple",type:"int",range:new ED.Range(-500,500),delta:15},scaleX:{kind:"simple",type:"float",range:new ED.Range(.5,4),precision:6,delta:.1},scaleY:{kind:"simple",type:"float",range:new ED.Range(.5,4),precision:6,delta:.1},arc:{kind:"simple",type:"float",range:new ED.Range(Math.PI/12,2*Math.PI),precision:6,delta:.1},rotation:{kind:"simple",type:"float",range:new ED.Range(0,2*Math.PI),precision:6,delta:.2}},this.gridSpacing=200,this.gridDisplacementX=0,this.gridDisplacementY=0,this.isBeingDragged=!1,this.draggingHandleIndex=null,this.draggingHandleRing=null,this.isClicked=!1,this.drawFunctionMode=ED.drawFunctionMode.Draw,this.isFilled=!0,this.derivedParametersArray=[],this.animationFrameRate=30,this.animationDataArray=[],this.parentClass="",this.inFrontOfClassArray=[],this.pointsArray=[],this.anglesArray=[],this.quadrantPoint=new ED.Point(200,200),this.bindingArray=[],this.drawing.listenerArray[this.id]=[],this.handleArray=[],this.handleArray[0]=new ED.Handle(new ED.Point(-50,50),!1,ED.Mode.Scale,!1),this.handleArray[1]=new ED.Handle(new ED.Point(-50,-50),!1,ED.Mode.Scale,!1),this.handleArray[2]=new ED.Handle(new ED.Point(50,-50),!1,ED.Mode.Scale,!1),this.handleArray[3]=new ED.Handle(new ED.Point(50,50),!1,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Handle(new ED.Point(this.apexX,this.apexY),!1,ED.Mode.Apex,!1),this.setHandles(),this.leftExtremity=new ED.Point(-100,-100),this.rightExtremity=new ED.Point(0,-100),this.version=1,this.setPropertyDefaults(),e===void 0)this.originX=0,this.originY=0,this.radius=100,this.apexX=0,this.apexY=0,this.scaleX=1,this.scaleY=1,this.arc=Math.PI,this.rotation=0,this.order=this.drawing.doodleArray.length,this.setParameterDefaults(),this.isSelected=!0;else{this.originX=+e,this.originY=+a,this.radius=+r,this.apexX=+i,this.apexY=+o,this.scaleX=+s,this.scaleY=+n,this.arc=l*Math.PI/180,this.rotation=h*Math.PI/180,this.order=+d;for(var D in this.parameterValidationArray){var u=this.parameterValidationArray[D];"simple"==u.kind&&this.updateDependentParameters(D)}this.isSelected=!1,this.isForDrawing=!1}}},ED.Doodle.prototype.setHandles=function(){},ED.Doodle.prototype.setPropertyDefaults=function(){},ED.Doodle.prototype.setParameterDefaults=function(){},ED.Doodle.prototype.position=function(){},ED.Doodle.prototype.willDelete=function(){return!0},ED.Doodle.prototype.move=function(t,e){var a=Math.round(+t),r=Math.round(+e),i=new ED.Point(0,0),o=new ED.Point(0,-100);if(this.isMoveable){var s=this.parameterValidationArray.originX.range.constrain(this.originX+a),n=this.parameterValidationArray.originY.range.constrain(this.originY+r);if(0!=a&&this.setSimpleParameter("originX",s),0!=r&&this.setSimpleParameter("originY",n),this.updateDependentParameters("originX"),this.updateDependentParameters("originY"),(0!=a||0!=r)&&this.isOrientated){var l=new ED.Point(this.originX,this.originY),h=this.drawing.innerAngle(o,i,l);this.setSimpleParameter("rotation",h),this.updateDependentParameters("rotation")}this.drawing.notify("doodleMoved",{doodle:this})}},ED.Doodle.prototype.draw=function(t){this.drawFunctionMode=t!==void 0?ED.drawFunctionMode.HitTest:ED.drawFunctionMode.Draw;var e=this.drawing.context;e.translate(this.originX,this.originY),e.rotate(this.rotation),e.scale(this.scaleX,this.scaleY),this.transform.setToTransform(this.drawing.transform),this.transform.translate(this.originX,this.originY),this.transform.rotate(this.rotation),this.transform.scale(this.scaleX,this.scaleY),this.inverseTransform=this.transform.createInverse(),this.isClicked=!1},ED.Doodle.prototype.drawHandles=function(t){this.drawFunctionMode==ED.drawFunctionMode.HitTest&&(this.draggingHandleIndex=null,this.draggingHandleRing=null);var e=this.drawing.context;e.save(),e.setTransform(1,0,0,1,0,0),e.lineWidth=1,e.strokeStyle="red",e.fillStyle="yellow";for(var a=2*Math.PI,r=0;this.handleArray.length>r;r++){var i=this.handleArray[r];i.isVisible&&(e.beginPath(),e.arc(i.location.x,i.location.y,ED.handleRadius/2,0,a,!0),this.drawFunctionMode==ED.drawFunctionMode.HitTest&&e.isPointInPath(t.x,t.y)&&(this.draggingHandleIndex=r,this.draggingHandleRing=ED.handleRing.Inner,this.drawing.mode=i.mode,this.isClicked=!0),this.isRotatable&&i.isRotatable&&(e.moveTo(i.location.x+ED.handleRadius,i.location.y),e.arc(i.location.x,i.location.y,ED.handleRadius,0,a,!0),this.drawFunctionMode==ED.drawFunctionMode.HitTest&&e.isPointInPath(t.x,t.y)&&(this.draggingHandleIndex=r,null==this.draggingHandleRing&&(this.draggingHandleRing=ED.handleRing.Outer,this.drawing.mode=ED.Mode.Rotate),this.isClicked=!0)),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.fill(),e.stroke()))}e.restore()},ED.Doodle.prototype.drawBoundary=function(t){var e=this.drawing.context;if(this.drawFunctionMode==ED.drawFunctionMode.HitTest){if(ED.isFirefox()){e.save(),e.setTransform(1,0,0,1,0,0);var a=e.isPointInPath(t.x,t.y);e.restore()}else var a=e.isPointInPath(t.x,t.y);a&&(this.drawing.mode=this.isDrawable&&this.isForDrawing?ED.Mode.Draw:ED.Mode.Move,this.isClicked=!0)}else this.isSelected&&this.isShowHighlight&&(e.shadowColor="gray",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=20),this.isForDrawing&&(e.shadowColor="blue",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=20),this.isFilled&&e.fill(),e.stroke(),e.shadowBlur=0,this.isSelected&&this.isShowHighlight&&this.drawHighlightExtras()},ED.Doodle.prototype.drawHighlightExtras=function(){},ED.Doodle.prototype.groupDescription=function(){return""},ED.Doodle.prototype.description=function(){return""},ED.Doodle.prototype.groupDescriptionEnd=function(){return""},ED.Doodle.prototype.tooltip=function(){var t=ED.trans[this.className];return t!==void 0?t:""},ED.Doodle.prototype.snomedCode=function(){return 0},ED.Doodle.prototype.diagnosticHierarchy=function(){return 0},ED.Doodle.prototype.dependentParameterValues=function(){return[]},ED.Doodle.prototype.updateDependentParameters=function(t){var e=this.dependentParameterValues(t,this[t]);for(var a in e)this.setSimpleParameter(a,e[a]);this.drawing.updateBindings(this)},ED.Doodle.prototype.validateParameter=function(t,e){var a=this.parameterValidationArray[t],r="";if(a){var i=!1;switch(r=(""+e).trim(),a.type){case"string":a.list.indexOf(r)>=0&&(i=!0);break;case"float":ED.isNumeric(r)&&(r=parseFloat(r),r=a.range.constrain(r),r=r.toFixed(a.precision),i=!0);break;case"int":ED.isNumeric(r)&&(r=parseInt(r),r=a.range.constrain(r),r=r.toFixed(0),i=!0);break;case"mod":ED.isNumeric(r)&&(r=parseInt(r),r=a.range.constrain(r),"top"==a.clock?r==a.range.min&&(r=a.range.max):"bottom"==a.clock&&r==a.range.max&&(r=a.range.min),r=r.toFixed(0),i=!0);break;case"bool":("true"==e||"false"==e)&&(r=e,i=!0);break;default:ED.errorHandler("ED.Drawing","eventHandler","Illegal validation type")}}else ED.errorHandler("ED.Doodle","validateParameter","Unknown parameter name");i||(r=this.getParameter(t),ED.errorHandler("ED.Doodle","validateParameter","Validation failure for parameter: "+t+" with value: "+e));var o=[];return o.valid=i,o.value=r,o},ED.Doodle.prototype.setParameterWithAnimation=function(t,e){if(this.parameterValidationArray[t].animate){var a=this.dependentParameterValues(t,e);for(var r in a){var i=this.parameterValidationArray[r].delta,o=a[r]-this[r];if("rotation"==r){var s=0>(Math.PI-Math.abs(o))*o?-1:1;o*=s,0>o&&(o+=2*Math.PI),o>3.141&&this.rotation<Math.PI&&(s=-s)}else var s=0>o?-1:1;i*=s;var n=Math.abs(Math.floor(o/i)),l={timer:null,delta:i,frames:n,frameCounter:0};this.animationDataArray[r]=l,n>0?this.increment(r,a[r]):(this.setSimpleParameter(r,a[r]),this.updateDependentParameters(r),this.drawing.repaint())}}else this.setParameterFromString(t,""+e)},ED.Doodle.prototype.setSimpleParameter=function(t,e){var a={};a.doodle=this,a.parameter=t,a.value=e,a.oldValue=this[t],this[t]=e,this.drawing.notify("parameterChanged",a)},ED.Doodle.prototype.setParameterFromString=function(t,e){var a=typeof e;"string"!=a&&ED.errorHandler("ED.Doodle","setParameterFromString","_value parameter should be of type string, not "+a);var r=this.parameterValidationArray[t];if(r){switch(r.type){case"string":this[t]=e;break;case"float":this[t]=parseFloat(e);break;case"int":this[t]=parseInt(e);break;case"mod":this[t]=parseInt(e);break;case"bool":this[t]="true"==e;break;default:ED.errorHandler("ED.Doodle","setParameterFromString","Illegal validation type: "+r.type)}if(this.updateDependentParameters(t),"derived"==this.parameterValidationArray[t].kind){var i=this.dependentParameterValues(t,e);for(var o in i)this.updateDependentParameters(o)}}else ED.errorHandler("ED.Doodle","setParameterFromString","No item in parameterValidationArray corresponding to parameter: "+t);this.drawing.repaint()},ED.Doodle.prototype.setOriginWithDisplacements=function(t,e){if(this.originX=this.drawing.eye==ED.eye.Right?-t:t,this.originY=-t,this.addAtBack)var a=this.drawing.firstDoodleOfClass(this.className);else var a=this.drawing.lastDoodleOfClass(this.className);if(a){var r=a.originX-e,i=a.originY-e;this.originX=this.parameterValidationArray.originX.range.constrain(r),this.originY=this.parameterValidationArray.originY.range.constrain(i)}},ED.Doodle.prototype.setRotationWithDisplacements=function(t,e){var a,r=this.drawing.eye==ED.eye.Right?-1:1;if(this.addAtBack)var i=this.drawing.firstDoodleOfClass(this.className);else var i=this.drawing.lastDoodleOfClass(this.className);a=i?(180*i.rotation/Math.PI+r*e+360)%360*Math.PI/180:(r*t+360)%360*Math.PI/180,this.rotation=this.parameterValidationArray.rotation.range.constrain(a)},ED.Doodle.prototype.deselect=function(){this.isSelected=!1,this.drawing.selectedDoodle=null,this.drawing.repaint()},ED.Doodle.prototype.getParameter=function(t){var e=this.parameterValidationArray[t],a="";if(e)switch(e.type){case"string":a=this[t];break;case"float":a=this[t].toFixed(e.precision);break;case"int":a=this[t].toFixed(0);break;case"mod":a=Math.round(this[t]),"top"==e.clock?a==e.range.min&&(a=e.range.max):"bottom"==e.clock&&a==e.range.max&&(a=e.range.min),a=a.toFixed(0);break;case"bool":a=""+this[t];break;default:ED.errorHandler("ED.Doodle","getParameter","Illegal validation type")}else ED.errorHandler("ED.Doodle","getParameter","No entry in parameterValidationArray corresponding to parameter: "+t);return a},ED.Doodle.prototype.increment=function(t,e){var a=this[t];this.animationDataArray[t].frameCounter++;var r=1e3/this.animationFrameRate;if(this.animationDataArray[t].frameCounter==this.animationDataArray[t].frames)this.setSimpleParameter(t,e),this.updateDependentParameters(t),clearTimeout(this.animationDataArray[t].timer);else{this.setSimpleParameter(t,a+this.animationDataArray[t].delta),this.updateDependentParameters(t);var i=this;this.animationDataArray[t].timer=setTimeout(function(){i.increment(t,e)},r)}this.drawing.repaint()},ED.Doodle.prototype.addBinding=function(t,e){var a=e.id,r=e.attribute;if(this[t]!==void 0){var i=document.getElementById(a);if(null!=i){this.bindingArray[t]={id:a,attribute:r};var o,s=this.drawing,n=this.id,l=this.className;switch(i.type){case"checkbox":r?ED.errorHandler("ED.Doodle","addBinding","Binding to a checkbox with a non-standard attribute not yet supported"):(this.setParameterFromString(t,""+i.checked),i.addEventListener("change",o=function(){s.eventHandler("onchange",n,l,this.id,""+this.checked)},!1));break;case"select-one":r?(i.selectedIndex>-1&&this.setParameterFromString(t,i.options[i.selectedIndex].getAttribute(r)),i.addEventListener("change",o=function(){s.eventHandler("onchange",n,l,this.id,this.options[this.selectedIndex].getAttribute(r))},!1)):(this.setParameterFromString(t,i.value),i.addEventListener("change",o=function(){s.eventHandler("onchange",n,l,this.id,this.value)},!1));break;default:r?(this.setParameterFromString(t,i.getAttribute(r)),i.addEventListener("change",o=function(){s.eventHandler("onchange",n,l,this.id,this.getAttribute(r))},!1)):(this.setParameterFromString(t,i.value),i.addEventListener("change",o=function(){s.eventHandler("onchange",n,l,this.id,this.value)},!1))}this.drawing.listenerArray[this.id][t]=o}else ED.errorHandler("ED.Doodle","addBinding","Failed to add binding. DOM has no element with id: "+a)}else ED.errorHandler("ED.Doodle","addBinding","Failed to add binding. Doodle of class: "+this.className+" has no parameter of name: "+t)},ED.Doodle.prototype.removeBinding=function(t){var e;for(var a in this.bindingArray)a==t&&(e=this.bindingArray[t].id);delete this.bindingArray[t];var r=document.getElementById(e);r.removeEventListener("change",this.drawing.listenerArray[this.id][t],!1),delete this.drawing.listenerArray[this.id][t]},ED.Doodle.prototype.clockHour=function(){var t;if(this.isRotatable&&!this.isMoveable)t=(6*this.rotation/Math.PI+12)%12;else var e=new ED.Point(0,-100),a=new ED.Point(this.originX,this.originY),t=(6*e.clockwiseAngleTo(a)/Math.PI+12)%12;return t=t.toFixed(0),0==t&&(t=12),t},ED.Doodle.prototype.degrees=function(){var t;if(this.isRotatable&&!this.isMoveable)t=(180*this.rotation/Math.PI+360)%360;else{var e=new ED.Point(0,-100),a=new ED.Point(this.originX,this.originY);t=(180*e.clockwiseAngleTo(a)/Math.PI+360)%360}return t=t.toFixed(0),0==t&&(t=0),t},ED.Doodle.prototype.clockHourExtent=function(){var t,e;if(this.isRotatable&&!this.isMoveable)t=(6*(this.rotation-this.arc/2)/Math.PI+12)%12,e=(6*(this.rotation+this.arc/2)/Math.PI+12)%12;else{var a=new ED.Point(0,-100),r=new ED.Point(this.originX,this.originY);(6*a.clockwiseAngleTo(r)/Math.PI+12)%12}return t=t.toFixed(0),0==t&&(t=12),e=e.toFixed(0),0==e&&(e=12),"from "+t+" to "+e},ED.Doodle.prototype.degreesExtent=function(){var t=180*this.arc/Math.PI,e=Math.round(t);return e},ED.Doodle.prototype.locationRelativeToDisc=function(){var t="";return this.drawing.eye==ED.eye.Right?this.originX>180&&420>this.originX&&this.originY>-120&&120>this.originY?t="at the disc":(t+=0>=this.originY?"supero":"infero",t+=300>=this.originX?"temporally":"nasally"):-180>this.originX&&this.originX>-420&&this.originY>-120&&120>this.originY?t="at the disc":(t+=0>=this.originY?"supero":"infero",t+=this.originX>=-300?"temporally":"nasally"),t},ED.Doodle.prototype.locationRelativeToFovea=function(){var t="";return this.drawing.eye==ED.eye.Right?this.originX>-10&&10>this.originX&&this.originY>-10&&10>this.originY?t="at the fovea":(t+=0>=this.originY?"supero":"infero",t+=0>=this.originX?"temporal":"nasal",t+=" to the fovea"):this.originX>-10&&10>this.originX&&this.originY>-10&&10>this.originY?t="at the fovea":(t+=0>=this.originY?"supero":"infero",t+=this.originX>=0?"temporally":"nasally",t+=" to the fovea"),t},ED.Doodle.prototype.addSquiggle=function(){var t,e=this.drawing.colourPreview.style.backgroundColor,a=e.match(/\d+/g),r=this.drawing.fillRadio.checked,i=this.drawing.thickness.value;switch(i){case"Thin":t=ED.squiggleWidth.Thin;break;case"Medium":t=ED.squiggleWidth.Medium;break;case"Thick":t=ED.squiggleWidth.Thick;break;default:t=ED.squiggleWidth.Thin}var o=new ED.Colour(a[0],a[1],a[2],1),s=new ED.Squiggle(this,o,t,r);this.squiggleArray.push(s)},ED.Doodle.prototype.addPointToSquiggle=function(t){if(this.squiggleArray.length>0){var e=this.squiggleArray.length-1,a=this.squiggleArray[e];a.addPoint(t)}},ED.Doodle.prototype.completeSquiggle=function(){if(this.squiggleArray.length>0){var t=this.squiggleArray.length-1,e=this.squiggleArray[t];e.complete=!0}},ED.Doodle.prototype.calculateArc=function(){var t=new ED.Point(this.leftExtremity.x-this.drawing.canvas.width/2,this.leftExtremity.y-this.drawing.canvas.height/2),e=new ED.Point(this.rightExtremity.x-this.drawing.canvas.width/2,this.rightExtremity.y-this.drawing.canvas.height/2);return t.clockwiseAngleTo(e)},ED.Doodle.prototype.nearestPointTo=function(t){if(this.pointsArray.length>0){for(var e=1e7,a=0,r=0;this.pointsArray.length>r;r++){var i=this.pointsArray[r],o=(t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y);e>o&&(e=o,a=r)}return this.pointsArray[a]}return ED.errorHandler("ED.Doodle","nearestPointTo","Attempt to calculate nearest points with an empty points array"),t},ED.Doodle.prototype.nearestAngleTo=function(t){if(this.anglesArray.length>0){for(var e=2*Math.PI,a=0,r=0;this.anglesArray.length>r;r++){var i=this.anglesArray[r],o=Math.abs(i-t);e>o&&(e=o,a=r)}return this.anglesArray[a]}return ED.errorHandler("ED.Doodle","nearestAngleTo","Attempt to calculate nearest angle with an empty angles array"),t},ED.Doodle.prototype.json=function(){var t="{";t=t+'"version": '+this.version.toFixed(1)+", ",t=t+'"subclass": '+'"'+this.className+'", ',t=t+'"originX": '+this.originX.toFixed(0)+", ",t=t+'"originY": '+this.originY.toFixed(0)+", ",t=t+'"radius": '+this.radius.toFixed(0)+", ",t=t+'"apexX": '+this.apexX.toFixed(0)+", ",t=t+'"apexY": '+this.apexY.toFixed(0)+", ",t=t+'"scaleX": '+this.scaleX.toFixed(2)+", ",t=t+'"scaleY": '+this.scaleY.toFixed(2)+", ",t=t+'"arc": '+(180*this.arc/Math.PI).toFixed(0)+", ",t=t+'"rotation": '+(180*this.rotation/Math.PI).toFixed(0)+", ",t=t+'"order": '+this.order.toFixed(0)+", ",t+='"squiggleArray": [';for(var e=0;this.squiggleArray.length>e;e++)t+=this.squiggleArray[e].json(),this.squiggleArray.length-e>1&&(t+=", ");if(t+="], ",t+='"params": [',this.savedParams!==void 0)for(var e=0;this.savedParams.length>e;e++){var a=this.savedParams[e];t=t+'{ "name": "'+a+'", "value": "'+this[a]+'" }',this.savedParams.length-e>1&&(t+=", ")}return t+="]",t+="}"},ED.Doodle.prototype.drawSpot=function(t,e,a,r,i){t.beginPath(),t.arc(e,a,r,0,2*Math.PI,!0),t.fillStyle=i,t.fill()},ED.Doodle.prototype.drawCircle=function(t,e,a,r,i,o,s){t.beginPath(),t.arc(e,a,r,0,2*Math.PI,!0),t.fillStyle=i,t.fill(),t.lineWidth=o,t.strokeStyle=s,t.stroke()},ED.Doodle.prototype.drawLine=function(t,e,a,r,i,o,s){t.beginPath(),t.moveTo(e,a),t.lineTo(r,i),t.lineWidth=o,t.strokeStyle=s,t.stroke()},ED.Doodle.prototype.drawLaserSpot=function(t,e,a){this.drawCircle(t,e,a,15,"Yellow",10,"rgba(255, 128, 0, 1)")},ED.Doodle.prototype.xForY=function(t,e){return Math.sqrt(t*t-e*e)},ED.Doodle.prototype.debug=function(){console.log("org: "+this.originX+" : "+this.originY),console.log("apx: "+this.apexX+" : "+this.apexY),console.log("rot: "+180*this.rotation/Math.PI),console.log("arc: "+180*this.arc/Math.PI)},ED.Handle=function(t,e,a,r){this.location=null==t?new ED.Point(0,0):t,this.isVisible=e,this.mode=a,this.isRotatable=r},ED.Range=function(t,e){this.min=t,this.max=e},ED.Range.prototype.setMinAndMax=function(t,e){this.min=t,this.max=e},ED.Range.prototype.isBelow=function(t){return this.min>t?!0:!1},ED.Range.prototype.isAbove=function(t){return t>this.max?!0:!1},ED.Range.prototype.includes=function(t){return this.min>t||t>this.max?!1:!0},ED.Range.prototype.constrain=function(t){return this.min>t?this.min:t>this.max?this.max:t},ED.Range.prototype.includesInAngularRange=function(t,e){var a=100,r=new ED.Point(0,0),i=new ED.Point(0,0),o=new ED.Point(0,0);return e?(r.setWithPolars(a,this.min*Math.PI/180),i.setWithPolars(a,this.max*Math.PI/180),o.setWithPolars(a,t*Math.PI/180)):(r.setWithPolars(a,this.min),i.setWithPolars(a,this.max),o.setWithPolars(a,t)),r.clockwiseAngleTo(o)<=r.clockwiseAngleTo(i)},ED.Range.prototype.constrainToAngularRange=function(t,e){if(this.max-this.min<(e?360:2*Math.PI)){var a=100,r=new ED.Point(0,0),i=new ED.Point(0,0),o=new ED.Point(0,0);return e?(r.setWithPolars(a,this.min*Math.PI/180),i.setWithPolars(a,this.max*Math.PI/180),o.setWithPolars(a,t*Math.PI/180)):(r.setWithPolars(a,this.min),i.setWithPolars(a,this.max),o.setWithPolars(a,t)),r.clockwiseAngleTo(o)<=r.clockwiseAngleTo(i)?t:o.clockwiseAngleTo(r)<i.clockwiseAngleTo(o)?this.min:this.max}return t},ED.Point=function(t,e){this.x=Math.round(+t),this.y=Math.round(+e),this.components=[this.x,this.y,1]},ED.Point.prototype.setWithPolars=function(t,e){this.x=Math.round(t*Math.sin(e)),this.y=Math.round(-t*Math.cos(e))},ED.Point.prototype.distanceTo=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},ED.Point.prototype.dotProduct=function(t){return this.x*t.x+this.y*t.y},ED.Point.prototype.crossProduct=function(t){return this.x*t.y-this.y*t.x},ED.Point.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},ED.Point.prototype.direction=function(){var t=new ED.Point(0,-100);return t.clockwiseAngleTo(this)},ED.Point.prototype.clockwiseAngleTo=function(t){var e=Math.acos(this.dotProduct(t)/(this.length()*t.length()));return 0>this.crossProduct(t)?2*Math.PI-e:e},ED.Point.prototype.pointAtRadiusAndClockwiseAngle=function(t,e){var a=this.direction(),r=new ED.Point(0,0);return r.setWithPolars(t,a+e),r},ED.Point.prototype.pointAtAngleToLineToPointAtProportion=function(t,e,a){var i=new ED.Point((e.x-this.x)*a,(e.y-this.y)*a);r=i.length();var o=i.pointAtRadiusAndClockwiseAngle(r,t);return o.x+=this.x,o.y+=this.y,o},ED.Point.prototype.clockHour=function(){var t=new ED.Point(0,-100),e=(6*t.clockwiseAngleTo(this)/Math.PI+12)%12;return e=e.toFixed(0),0==e&&(e=12),e},ED.Point.prototype.tangentialControlPoint=function(t){var e=this.length(),a=this.direction(),r=e/Math.cos(t),i=new ED.Point(0,0);return i.setWithPolars(r,a+t),i},ED.Point.prototype.json=function(){return'{"x":'+this.x.toFixed(2)+',"y":'+this.y.toFixed(2)+"}"},ED.AffineTransform=function(){this.components=[[1,0,0],[0,1,0],[0,0,1]]},ED.AffineTransform.prototype.setToIdentity=function(){this.components[0][0]=1,this.components[0][1]=0,this.components[0][2]=0,this.components[1][0]=0,this.components[1][1]=1,this.components[1][2]=0,this.components[2][0]=0,this.components[2][1]=0,this.components[2][2]=1},ED.AffineTransform.prototype.setToTransform=function(t){this.components[0][0]=t.components[0][0],this.components[0][1]=t.components[0][1],this.components[0][2]=t.components[0][2],this.components[1][0]=t.components[1][0],this.components[1][1]=t.components[1][1],this.components[1][2]=t.components[1][2],this.components[2][0]=t.components[2][0],this.components[2][1]=t.components[2][1],this.components[2][2]=t.components[2][2]},ED.AffineTransform.prototype.translate=function(t,e){this.components[0][2]=this.components[0][0]*t+this.components[0][1]*e+this.components[0][2],this.components[1][2]=this.components[1][0]*t+this.components[1][1]*e+this.components[1][2],this.components[2][2]=this.components[2][0]*t+this.components[2][1]*e+this.components[2][2]},ED.AffineTransform.prototype.scale=function(t,e){this.components[0][0]=this.components[0][0]*t,this.components[0][1]=this.components[0][1]*e,this.components[1][0]=this.components[1][0]*t,this.components[1][1]=this.components[1][1]*e,this.components[2][0]=this.components[2][0]*t,this.components[2][1]=this.components[2][1]*e},ED.AffineTransform.prototype.rotate=function(t){var e=Math.cos(t),a=Math.sin(t),r=[[0,0,0],[0,0,0],[0,0,0]];r[0][0]=this.components[0][0]*e+this.components[0][1]*a,r[0][1]=this.components[0][1]*e-this.components[0][0]*a,r[1][0]=this.components[1][0]*e+this.components[1][1]*a,r[1][1]=this.components[1][1]*e-this.components[1][0]*a,r[2][0]=this.components[2][0]*e+this.components[2][1]*a,r[2][1]=this.components[2][1]*e-this.components[2][0]*a,this.components[0][0]=r[0][0],this.components[0][1]=r[0][1],this.components[1][0]=r[1][0],this.components[1][1]=r[1][1],this.components[2][0]=r[2][0],this.components[2][1]=r[2][1]},ED.AffineTransform.prototype.transformPoint=function(t){var e=t.x*this.components[0][0]+t.y*this.components[0][1]+1*this.components[0][2],a=t.x*this.components[1][0]+t.y*this.components[1][1]+1*this.components[1][2];return new ED.Point(e,a)},ED.AffineTransform.prototype.determinant=function(){return this.components[0][0]*(this.components[1][1]*this.components[2][2]-this.components[1][2]*this.components[2][1])-this.components[0][1]*(this.components[1][0]*this.components[2][2]-this.components[1][2]*this.components[2][0])+this.components[0][2]*(this.components[1][0]*this.components[2][1]-this.components[1][1]*this.components[2][0])},ED.AffineTransform.prototype.createInverse=function(){var t=new ED.AffineTransform,e=this.determinant(),a=1/e;return t.components[0][0]=a*(this.components[1][1]*this.components[2][2]-this.components[1][2]*this.components[2][1]),t.components[0][1]=a*(this.components[0][2]*this.components[2][1]-this.components[0][1]*this.components[2][2]),t.components[0][2]=a*(this.components[0][1]*this.components[1][2]-this.components[0][2]*this.components[1][1]),t.components[1][0]=a*(this.components[1][2]*this.components[2][0]-this.components[1][0]*this.components[2][2]),t.components[1][1]=a*(this.components[0][0]*this.components[2][2]-this.components[0][2]*this.components[2][0]),t.components[1][2]=a*(this.components[0][2]*this.components[1][0]-this.components[0][0]*this.components[1][2]),t.components[2][0]=a*(this.components[1][0]*this.components[2][1]-this.components[1][1]*this.components[2][0]),t.components[2][1]=a*(this.components[0][1]*this.components[2][0]-this.components[0][0]*this.components[2][1]),t.components[2][2]=a*(this.components[0][0]*this.components[1][1]-this.components[0][1]*this.components[1][0]),t},ED.Squiggle=function(t,e,a,r){this.doodle=t,this.colour=e,this.thickness=a,this.filled=r,this.pointsArray=[],this.complete=!1},ED.Squiggle.prototype.addPoint=function(t){this.pointsArray.push(t)},ED.Squiggle.prototype.json=function(){var t="{";t=t+'"colour": '+this.colour.json()+", ",t=t+'"thickness": '+this.thickness+", ",t=t+'"filled": "'+this.filled+'", ',t+='"pointsArray": [';for(var e=0;this.pointsArray.length>e;e++)t+=this.pointsArray[e].json(),this.pointsArray.length-e>1&&(t+=", ");return t+="]",t+="}"},ED.Colour=function(t,e,a,r){this.red=t,this.green=e,this.blue=a,this.alpha=r},ED.Colour.prototype.setWithHexString=function(t){this.red=parseInt(t.charAt(0)+t.charAt(1),16),this.green=parseInt(t.charAt(2)+t.charAt(3),16),this.blue=parseInt(t.charAt(4)+t.charAt(5),16)},ED.Colour.prototype.rgba=function(){return"rgba("+this.red+", "+this.green+", "+this.blue+", "+this.alpha+")"},ED.Colour.prototype.json=function(){return'{"red":'+this.red+',"green":'+this.green+',"blue":'+this.blue+',"alpha":'+this.alpha+"}"},String.prototype.firstLetterToLowerCase=function(){var t=this.charAt(1);return t==t.toUpperCase()?this:this.charAt(0).toLowerCase()+this.slice(1)},String.prototype.addAndAfterLastComma=function(){for(var t=!1,e=this.length-1;e>=0;e--)if(","==this.charAt(e)){t=!0;break}return t?this.substring(0,e)+", and"+this.substring(e+1,this.length):this},null==ED||"object"!=typeof ED)var ED={};if(ED.trans={},ED.trans.ACIOL="Anterior chamber IOL<br/><br/>Drag to move<br/>Drag the handle to rotate",ED.trans.AngleGradeEast="Grade of angle (Iris)<br/><br/>Drag handle to adjust amount of angle obscure by iris",ED.trans.AngleGradeNorth="Grade of angle (Iris)<br/><br/>Drag handle to adjust amount of angle obscure by iris",ED.trans.AngleGradeSouth="Grade of angle (Iris)<br/><br/>Drag handle to adjust amount of angle obscure by iris",ED.trans.AngleGradeWest="Grade of angle (Iris)<br/><br/>Drag handle to adjust amount of angle obscure by iris",ED.trans.AngleNV="Angle new vessels<br/><br/>Drag to move around angle<br/>Drag handles to change extent",ED.trans.AngleRecession="Angle recession<br/><br/>Drag to move around angle<br/>Drag handles to change extent",ED.trans.AntSeg="Anterior segment<br/><br/>Drag the handle to resize the pupil<br/><br/>The iris is semi-transparent so that IOLs, and<br/>other structures can be seen behind it",ED.trans.AntSegCrossSection="",ED.trans.AntSynech="Anterior synechiae<br/><br/>Drag to move around angle<br/>Drag handles to change extent",ED.trans.ArcuateScotoma="Arcuate scotoma<br/><br/>Drag handle to change size",ED.trans.Bleb="Trabeculectomy bleb<br/><br/>Drag to move around the limbus",ED.trans.BlotHaemorrhage="Blot haemorrhage<br/><br/>Drag to position<br/>Drag the handle to change size",ED.trans.BuckleSuture="Buckle suture<br/><br/>Drag to position",ED.trans.CapsularTensionRing="Capsular Tension Ring<br/><br/>This cannot be selected directly since it is behind the iris<br/>Select the iris first<br/>Then move the scroll wheel until the ring is selected<br/>Click the 'Move to front' button<br/>Err.. of course if you are seeing this tooltip you have already done it",ED.trans.ChandelierSingle="Chandelier illumination<br/><br/>Drag to rotate around centre<br/>",ED.trans.ChandelierDouble="Double chandelier illumination<br/><br/>Drag to rotate around centre<br/>",ED.trans.CiliaryInjection="Ciliary injection<br/><br/>Drag to rotate around centre<br/>Drag handles to change extent",ED.trans.Circinate="Circinate (Ring of exudates)<br/><br/>Drag to position<br/>Drag handle to change size",ED.trans.CircumferentialBuckle="Circumferential buckle<br/><br/>Drag to position<br/>Drag outer handles to change extent<br/>Drag middle handle to change width",ED.trans.CornealAbrasion="Corneal abrasion<br/><br/>Drag to position<br/>Drag handle to change size",ED.trans.CorneaCrossSection="Corneal cross section",ED.trans.CornealErosion="Removal of corneal epithelium<br/><br/>Drag to position<br/>Drag handle to change size",ED.trans.CornealOedema="Corneal oedema<br/><br/>Drag to position<br/>Drag handle to change size and density",ED.trans.CornealStriae="Corneal striae",ED.trans.CornealScar="Corneal Scar<br/><br/>Drag outer handle to change shape<br/>Drag inner handle to change density",ED.trans.CornealSuture="Corneal suture<br/><br/>Drag to move",ED.trans.CorticalCataract="",ED.trans.CottonWoolSpot="Cotton wool spot<br/><br/>Drag to position<br/>Drag handle to change shape and size",ED.trans.CNV="Choroidal neovascular membrane<br/><br/>Drag to move<br/>Drag handle to scale",ED.trans.CutterPI="Cutter iridectomy<br/><br/>Drag to move around the iris",ED.trans.CystoidMacularOedema="Cystoid macular oedema<br/><br/>Drag handle to change size",ED.trans.DiabeticNV="Diabetic new vessels<br/><br/>Drag to position<br/>Drag handle to change size",ED.trans.DiscHaemorrhage="Disc haemorrhage<br/><br/>Drag to position",ED.trans.DiscPallor="Disc Pallor<br/><br/>Drag to position<br/>Drag handles to adjust extent",ED.trans.DrainageSite="Drainage site<br/><br/>Drag to change position",ED.trans.EncirclingBand="Encircling band<br/><br/>Drag to change orientation of Watzke sleeve",ED.trans.EpiretinalMembrane="Epiretinal membrane<br/><br/>Drag inner handle to change shape and size<br/>Drag outer handle to rotate",ED.trans.FibrousProliferation="Fibrous Proliferation<br/><br/>Drag to position<br/>Drag inner handle to change shape and size<br/>Drag outer handle to rotate",ED.trans.FocalLaser="Focal laser burns<br/><br/>Drag the handle for a bigger area with more burns",ED.trans.Fundus="",ED.trans.Fuchs="Fuch's Endothelial Dystrophy<br/><br/>Drag handle to change shape",ED.trans.Geographic="Geographic Atrophy<br/><br/>Drag middle handle to alter size of remaining central island of RPE<br/>Drag outside handle to scale",ED.trans.Gonioscopy="Goniogram<br/><br/>Drag top left handle up and down to alter pigment density<br/>Drag top left handle left and right to alter pigment homogeneity",ED.trans.HardDrusen="Hard drusen<br/><br/>Drag middle handle up and down to alter density of drusen<br/>Drag outside handle to scale",ED.trans.HardExudate="Hard exudate<br/><br/>Drag to position",ED.trans.Hyphaema="Hyphaema<br/><br/>Drag handle vertically to change size<br/>Drag handle horizontally to change density",ED.trans.Hypopyon="Hypopyon<br/><br/>Drag handle vertically to change size",ED.trans.IrisHook="Iris hook<br/><br/>Drag to move around the clock<br/><br/>The hook will match the size of the pupil as it changes<br/>Subsequent hooks are added to the next quadrant",ED.trans.IrisNaevus="Iris naevus<br/><br/>Drag to move<br/>Drag handle to change size",ED.trans.IRMA="Intraretinal microvascular abnormalities<br/><br/>Drag to move<br/>Drag inner handle to change size<br/>Drag outer handle to rotate",ED.trans.KeraticPrecipitates="Keratic precipitates<br/><br/>Drag middle handle up and down to alter density<br/>Drag middle handle left and right to alter size<br/>Drag outside handle to scale",ED.trans.KrukenbergSpindle="Krukenberg's spindle<br/><br/>Drag to move</br>Drag outer handle to change shape",ED.trans.LaserCircle="A circle of laser spots<br/><br/>Drag handle to change shape",ED.trans.LaserDemarcation="A row of laser spots for demarcation<br/><br/>Drag to rotate<br/>Drag each end handle to increase extent<br/>Drag the middle handle to move line more posteriorly",ED.trans.LaserSpot="A single laser spot<br/><br/>Drag to position<br/>Drag the handle to change size",ED.trans.LasikFlap="LASIK flap<br/><br/>Drag to rotate<br/>Drag the handle to scale",ED.trans.LensCrossSection="",ED.trans.LimbalRelaxingIncision="Limbal relaxing incision<br/><br/>Drag to move",ED.trans.MacularGrid="Macular grid<br/><br/>Drag the handle to scale",ED.trans.MacularHole="Macular hole<br/><br/>Drag the handle to scale",ED.trans.MacularThickening="Macular thickening<br/><br/>Drag to position<br/>Drag handle to change size",ED.trans.MattressSuture="Mattress suture<br/><br/>Drag to move",ED.trans.Microaneurysm="Microaneurysm<br/><br/>Drag to position",ED.trans.NerveFibreDefect="Nerve fibre layer defect<br/><br/>Drag to position<br/>Drag handles to change size",ED.trans.OperatingTable="Operating table",ED.trans.OpticDisc="Optic disc<br/><br/>Basic mode: Drag handle to adjust cup/disc ratio<br/>Expert mode: Drag handles to re-shape disc",ED.trans.OpticDiscPit="Optic disc pit<br/><br/>Drag to position<br/>Drag handle to change shape",ED.trans.Papilloedema="Papilloedema",ED.trans.PCIOL="Posterior chamber IOL<br/><br/>Drag to move<br/>Drag the handle to rotate",ED.trans.PeripapillaryAtrophy="Peripapillary atrophy<br/><br/>Drag to rotate<br/>Drag handles to change extent",ED.trans.PeripheralRRD="Peripheral retinal detachment<br/><br/>Drag to rotate<br/>Drag each end handle to increase extent<br/>Drag the middle handle to move posterior limit",ED.trans.PhakoIncision="Phako incision<br/><br/>Drag end handle to change length<br/>Drag the middle handle to change section type<br/>Drag the incision itself to move",ED.trans.PI="Peripheral iridectomy<br/><br/>Drag to move around the iris",ED.trans.PosteriorEmbryotoxon="Posterior embryotoxon",ED.trans.PosteriorSynechia="PosteriorSynechia<br/><br/>Drag to rotate around centre<br/>Drag handles to increase extent",ED.trans.PostPole="Posterior pole<br/><br/>The disc cup can be edited by clicking on the disc, and dragging the yellow handle<br/>The gray circle marks one disc diameter from the fovea",ED.trans.PreRetinalHaemorrhage="Preretinal haemorrhage<br/><br/>Drag to position<br/>Drag handles to change shape and size",ED.trans.PRPPostPole="Pan-retinal photocoagulation",ED.trans.RadialSponge="Radial sponge<br/><br/>Drag to change position",ED.trans.RK="Radial keratotomy<br/><br/>Drag to rotate<br/>Drag outer handle to resize<br/>Drag inner handle to adjust central extent",ED.trans.RoundHole="",ED.trans.RRD="",ED.trans.Rubeosis="Rubeosis iridis<br/><br/>Drag to rotate around centre<br/>Drag handles to increase extent",ED.trans.SectorPRP="A sector of panretinal photocoagulation<br/><br/>Drag to rotate around centre<br/>Drag each end handle to increase extent",ED.trans.ScleralIncision="Scleral incision<br/><br/>Drag to move around the sclera",ED.trans.SectorIridectomy="Sector Iridectomy<br/><br/>Drag to position<br/>Drag handles to adjust extent",ED.trans.Sclerostomy="A sclerostomy for vitrectomy<br/><br/>Drag to rotate around centre<br/>Drag each handle to alter gauge<br/>Click suture button to toggle suture",ED.trans.SidePort="Side port<br/><br/>Drag to move",ED.trans.Surgeon="Surgeon",ED.trans.ToricPCIOL="Toric posterior chamber IOL<br/><br/>Drag to move<br/>Drag the handle to rotate",ED.trans.TractionRetinalDetachment="Traction retinal detachment<br/><br/>Drag to position<br/>Drag inner handle to change shape and size<br/>Drag outer handle to rotate",ED.trans.TransilluminationDefect="Transillumination defects of the iris<br/><br/>Drag to rotate around centre<br/>Drag each end handle to alter extent",ED.trans.UTear="",ED.trans.VitreousOpacity="Vitreous Opacity<br/><br/>Drag to move<br/>Drag the inner handle up and down to alter opacity<br/>Drag the outer handle to scale",ED.trans.Crepitations="Crepitations<br/><br/>Drag to move<br/>Drag handle to resize",ED.trans.Stenosis="Stenosis<br/><br/>Drag to move<br/>Drag handle up and down to change degree<br/>Drag handle to left and right to change type",ED.trans.Wheeze="Wheeze<br/><br/>Drag to move",ED.trans.Effusion="Pleural effusion<br/><br/>Drag handle to move up",ED.trans.LeftCoronaryArtery="Left coronary artery<br/><br/>Drag handle to move origin and make anomolous",ED.trans.DrugStent="Drug eluting stent<br/><br/>Drag to move",ED.trans.MetalStent="Metal stent<br/><br/>Drag to move",ED.trans.Bypass="Coronary artery bypass<br/><br/>Drag handle to alter destination",ED.trans.Bruit="Bruit<br/><br/>Drag to move",ED.trans.Bruising="Bruising<br/><br/>Drag to move<br/>Drag handle to resize",ED.trans.Haematoma="Haematoma<br/><br/>Drag to move<br/>Drag handle to resize",ED.ACIOL=function(t,e,a,r,i,o,s,n,l,h,d){this.className="ACIOL",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)
},ED.ACIOL.prototype=new ED.Doodle,ED.ACIOL.prototype.constructor=ED.ACIOL,ED.ACIOL.superclass=ED.Doodle.prototype,ED.ACIOL.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Rotate,!1)},ED.ACIOL.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isUnique=!0},ED.ACIOL.prototype.setParameterDefaults=function(){this.scaleX=.8,this.scaleY=.8},ED.ACIOL.prototype.draw=function(t){var e=this.drawing.context;ED.ACIOL.superclass.draw.call(this,t),e.beginPath();var a=240;e.arc(0,0,a,0,2*Math.PI,!1),e.moveTo(150,-190),e.bezierCurveTo(160,-200,170,-210,160,-230),e.bezierCurveTo(150,-250,100,-280,50,-290),e.bezierCurveTo(0,-300,-220,-330,-230,-340),e.bezierCurveTo(-250,-360,-220,-420,-200,-430),e.bezierCurveTo(-180,-440,-180,-440,-150,-450),e.bezierCurveTo(-120,-460,-130,-430,-120,-420),e.bezierCurveTo(-110,-410,110,-410,120,-420),e.bezierCurveTo(130,-430,120,-460,150,-450),e.bezierCurveTo(180,-440,180,-440,200,-430),e.bezierCurveTo(220,-420,180,-400,150,-390),e.bezierCurveTo(120,-380,-120,-380,-150,-390),e.bezierCurveTo(-180,-400,-190,-370,-170,-360),e.bezierCurveTo(-150,-350,20,-330,70,-320),e.bezierCurveTo(120,-310,190,-280,210,-250),e.bezierCurveTo(230,-220,220,-140,220,-100),e.moveTo(-150,190),e.bezierCurveTo(-160,200,-170,210,-160,230),e.bezierCurveTo(-150,250,-100,280,-50,290),e.bezierCurveTo(0,300,220,330,230,340),e.bezierCurveTo(250,360,220,420,200,430),e.bezierCurveTo(180,440,180,440,150,450),e.bezierCurveTo(120,460,130,430,120,420),e.bezierCurveTo(110,410,-110,410,-120,420),e.bezierCurveTo(-130,430,-120,460,-150,450),e.bezierCurveTo(-180,440,-180,440,-200,430),e.bezierCurveTo(-220,420,-180,400,-150,390),e.bezierCurveTo(-120,380,120,380,150,390),e.bezierCurveTo(180,400,190,370,170,360),e.bezierCurveTo(150,350,-20,330,-70,320),e.bezierCurveTo(-120,310,-190,280,-210,250),e.bezierCurveTo(-230,220,-220,140,-220,100),e.fillStyle="rgba(255,255,255,0.75)",e.lineWidth=4,e.strokeStyle="darkgray",this.drawBoundary(t);var r=new ED.Point(0,0);return r.setWithPolars(a,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(r),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ACIOL.prototype.description=function(){var t="Anterior chamber IOL",e=40,a="";return-e>this.originY&&(a.length>0&&(a+=" and"),a+=" superiorly"),this.originY>e&&(a.length>0&&(a+=" and"),a+=" inferiorly"),-e>this.originX&&(a.length>0&&(a+=" and"),a+=this.drawing.eye==ED.eye.Right?" temporally":" nasally"),this.originX>e&&(a.length>0&&(a+=" and"),a+=this.drawing.eye==ED.eye.Right?" nasally":" temporally"),a.length>0&&(t+=" displaced"+a),t},ED.AntSeg=function(t,e,a,r,i,o,s,n,l,h,d){this.className="AntSeg",this.pupilSize="Large",this.pxe=!0,this.savedParams=["pxe"],ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.AntSeg.prototype=new ED.Doodle,ED.AntSeg.prototype.constructor=ED.AntSeg,ED.AntSeg.superclass=ED.Doodle.prototype,ED.AntSeg.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.AntSeg.prototype.setPropertyDefaults=function(){this.version=1.1,this.isDeletable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-280,-60),this.parameterValidationArray.pupilSize={kind:"derived",type:"string",list:["Large","Medium","Small"],animate:!0},this.parameterValidationArray.pxe={kind:"derived",type:"bool"}},ED.AntSeg.prototype.setParameterDefaults=function(){this.setParameterFromString("pupilSize","Large"),this.setParameterFromString("pxe","false")},ED.AntSeg.prototype.dependentParameterValues=function(t,e){var a=[];switch(t){case"apexY":a.pupilSize=-200>e?"Large":-100>e?"Medium":"Small";break;case"pupilSize":switch(e){case"Large":-200>this.apexY?returnValue=this.apexY:a.apexY=-260;break;case"Medium":this.apexY>=-200&&-100>this.apexY?returnValue=this.apexY:a.apexY=-200;break;case"Small":this.apexY>=-100?returnValue=this.apexY:a.apexY=-100}}return a},ED.AntSeg.prototype.draw=function(t){var e=this.drawing.context;ED.AntSeg.superclass.draw.call(this,t);var a=380,r=-this.apexY,i=0,o=2*Math.PI;if(e.beginPath(),e.arc(0,0,a,i,o,!0),e.moveTo(r,0),e.arc(0,0,r,o,i,!1),e.lineWidth=4,e.fillStyle="rgba(100, 200, 250, 0.5)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&this.pxe){e.lineWidth=8,e.strokeStyle="darkgray";var s,n=.8*r,l=1.05*r,h=36,d=2*Math.PI/h;for(s=0;h>s;s++)e.beginPath(),e.arc(0,0,n,s*d,s*d+d/2,!1),e.stroke(),e.beginPath(),e.arc(0,0,l,s*d,s*d+d/2,!1),e.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AntSeg.prototype.description=function(){return 1==this.drawing.doodleArray.length?"No abnormality":""},ED.AntSegCrossSection=function(t,e,a,r,i,o,s,n,l,h,d){this.className="AntSegCrossSection",this.pupilSize="Large",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.AntSegCrossSection.prototype=new ED.Doodle,ED.AntSegCrossSection.prototype.constructor=ED.AntSegCrossSection,ED.AntSegCrossSection.superclass=ED.Doodle.prototype,ED.AntSegCrossSection.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.AntSegCrossSection.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexY.range.setMinAndMax(-280,-60),this.parameterValidationArray.pupilSize={kind:"derived",type:"string",list:["Large","Medium","Small"],animate:!0}},ED.AntSegCrossSection.prototype.setParameterDefaults=function(){this.setParameterFromString("pupilSize","Large"),this.apexX=24,this.originX=44},ED.AntSegCrossSection.prototype.dependentParameterValues=function(t,e){var a=[];switch(t){case"apexY":if(this.parameterValidationArray.apexX.range.setMinAndMax(-40-140/220*(this.apexY+280),32-72/220*(this.apexY+280)),this.drawing.isActive)var r=this.parameterValidationArray.apexX.range.constrain(this.apexX);else var r=this.parameterValidationArray.apexX.range.max;this.setSimpleParameter("apexX",r),a.pupilSize=-200>e?"Large":-100>e?"Medium":"Small";break;case"pupilSize":switch(e){case"Large":a.apexY=-260;break;case"Medium":a.apexY=-200;break;case"Small":a.apexY=-100}}return a},ED.AntSegCrossSection.prototype.draw=function(t){var e=this.drawing.context;ED.AntSegCrossSection.superclass.draw.call(this,t);var a=this.apexX;e.beginPath(),e.moveTo(60,480),e.lineTo(140,480),e.lineTo(140,380),e.bezierCurveTo(120,340,120,340,100,380),e.bezierCurveTo(80,340,80,340,60,380);var r=.15*Math.abs(a);return e.bezierCurveTo(40,460,a+60+r,-this.apexY,a,-this.apexY),e.bezierCurveTo(a-60-r,-this.apexY,-21,317,0,380),e.moveTo(60,-480),e.lineTo(140,-480),e.lineTo(140,-380),e.bezierCurveTo(120,-340,120,-340,100,-380),e.bezierCurveTo(80,-340,80,-340,60,-380),e.bezierCurveTo(40,-460,a+60+r,this.apexY,a,this.apexY),e.bezierCurveTo(a-60-r,this.apexY,-21,-317,0,-380),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255, 160, 40, 1)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Bleb=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Bleb",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Bleb.prototype=new ED.Doodle,ED.Bleb.prototype.constructor=ED.Bleb,ED.Bleb.superclass=ED.Doodle.prototype,ED.Bleb.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.Bleb.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(30,30)},ED.Bleb.prototype.draw=function(t){var e=this.drawing.context;ED.Bleb.superclass.draw.call(this,t);var a=384;e.beginPath();var r=Math.PI/12;return e.arc(0,0,a,-r-Math.PI/2,r-Math.PI/2,!1),e.lineTo(a/4,1.25*-a),e.lineTo(-a/4,1.25*-a),e.closePath(),e.fillStyle="rgba(240,240,240,0.9)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(-40,-a),e.lineTo(-40,1.15*-a),e.lineTo(40,1.15*-a),e.lineTo(40,-a),e.stroke()),this.isClicked},ED.Bleb.prototype.description=function(){return"Trabeculectomy bleb at "+this.clockHour()+" o'clock"},ED.CapsularTensionRing=function(t,e,a,r,i,o,s,n,l,h,d){this.className="CapsularTensionRing",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.CapsularTensionRing.prototype=new ED.Doodle,ED.CapsularTensionRing.prototype.constructor=ED.CapsularTensionRing,ED.CapsularTensionRing.superclass=ED.Doodle.prototype,ED.CapsularTensionRing.prototype.setPropertyDefaults=function(){this.addAtBack=!0,this.isScaleable=!1,this.isMoveable=!1,this.isUnique=!0},ED.CapsularTensionRing.prototype.setParameterDefaults=function(){this.rotation=-Math.PI/2},ED.CapsularTensionRing.prototype.draw=function(t){var e=this.drawing.context;ED.CapsularTensionRing.superclass.draw.call(this,t),e.beginPath();var a=360,r=340,i=300,o=15,s=.2*Math.PI;e.arc(0,0,a,-s,s,!0);var n=new ED.Point(0,0);n.setWithPolars(a,Math.PI/2+.8*s);var l=new ED.Point(0,0);l.setWithPolars(i,Math.PI/2+.8*s);var h=new ED.Point(0,0);h.setWithPolars(i,Math.PI/2+s);var d=new ED.Point(0,0);d.setWithPolars(i,Math.PI/2+1.1*s);var c=new ED.Point(0,0);c.setWithPolars(r,Math.PI/2+1.1*s);var p=new ED.Point(0,0);p.setWithPolars(r,Math.PI/2+1.2*s),e.bezierCurveTo(n.x,n.y,l.x,l.y,h.x,h.y),e.bezierCurveTo(d.x,d.y,c.x,c.y,p.x,p.y),e.arc(0,0,r,1.2*s,-1.2*s,!1);var D=new ED.Point(0,0);D.setWithPolars(r,Math.PI/2-1.1*s);var u=new ED.Point(0,0);u.setWithPolars(i,Math.PI/2-1.1*s);var y=new ED.Point(0,0);y.setWithPolars(i,Math.PI/2-s);var g=new ED.Point(0,0);g.setWithPolars(i,Math.PI/2-.8*s);var E=new ED.Point(0,0);E.setWithPolars(a,Math.PI/2-.8*s);var f=new ED.Point(0,0);f.setWithPolars(a,Math.PI/2-s),e.bezierCurveTo(D.x,D.y,u.x,u.y,y.x,y.y),e.bezierCurveTo(g.x,g.y,E.x,E.y,f.x,f.y);var m=new ED.Point(0,0);m.setWithPolars(r-8,Math.PI/2-s);var P=new ED.Point(0,0);P.setWithPolars(r-8+o,Math.PI/2-s),e.moveTo(P.x,P.y),e.arc(m.x,m.y,15,0,2*Math.PI,!1);var w=new ED.Point(0,0);w.setWithPolars(r-8,Math.PI/2+s);var b=new ED.Point(0,0);return b.setWithPolars(r-8+o,Math.PI/2+s),e.moveTo(b.x,b.y),e.arc(w.x,w.y,15,0,2*Math.PI,!1),e.closePath(),e.fillStyle="rgba(255,255,255,0.75)",e.lineWidth=4,e.strokeStyle="darkgray",this.drawBoundary(t),this.isClicked},ED.CapsularTensionRing.prototype.description=function(){var t="Capsular Tension Ring";return t},ED.CiliaryInjection=function(t,e,a,r,i,o,s,n,l,h,d){this.className="CiliaryInjection",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.CiliaryInjection.prototype=new ED.Doodle,ED.CiliaryInjection.prototype.constructor=ED.CiliaryInjection,ED.CiliaryInjection.superclass=ED.Doodle.prototype,ED.CiliaryInjection.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1)},ED.CiliaryInjection.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(20*Math.PI/180,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-334,-300),this.parameterValidationArray.radius.range.setMinAndMax(250,450)},ED.CiliaryInjection.prototype.setParameterDefaults=function(){this.arc=90*Math.PI/180,this.setRotationWithDisplacements(90,-120)},ED.CiliaryInjection.prototype.draw=function(t){var e=this.drawing.context;ED.CiliaryInjection.superclass.draw.call(this,t);var a=480,r=400,i=r+(a-r)/2,o=this.arc/2;-Math.PI/2+o;var s=-Math.PI/2-o,n=i*Math.sin(o),l=-i*Math.cos(o),h=-i*Math.sin(o),d=l;if(e.beginPath(),e.arc(0,0,a,-Math.PI/2+o,-Math.PI/2-o,!0),e.arc(0,0,r,-Math.PI/2-o,-Math.PI/2+o,!1),e.closePath(),e.fillStyle="rgba(218,230,241,0)",e.lineWidth=4,e.strokeStyle="rgba(218,230,241,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var c=60,p=2*Math.PI/c,D=Math.floor(this.arc/p),u=new ED.Point(0,0),y=new ED.Point(0,0);e.beginPath();for(var g=0;D>g;g++){var o=Math.PI/2+s+g*p;u.setWithPolars(a,o),y.setWithPolars(r,o),e.moveTo(u.x,u.y),e.lineTo(y.x,y.y)}e.strokeStyle="red",e.lineWidth=16,e.stroke()}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(h,d)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(n,l)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CiliaryInjection.prototype.groupDescription=function(){return"Ciliary injection "},ED.CorneaCrossSection=function(t,e,a,r,i,o,s,n,l,h,d){this.className="CorneaCrossSection",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.CorneaCrossSection.prototype=new ED.Doodle,ED.CorneaCrossSection.prototype.constructor=ED.CorneaCrossSection,ED.CorneaCrossSection.superclass=ED.Doodle.prototype,ED.CorneaCrossSection.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0},ED.CorneaCrossSection.prototype.setParameterDefaults=function(){this.originX=44},ED.CorneaCrossSection.prototype.draw=function(t){var e=this.drawing.context;return ED.CorneaCrossSection.superclass.draw.call(this,t),e.beginPath(),e.moveTo(60,-480),e.lineTo(-80,-480),e.bezierCurveTo(-100,-440,-100,-440,-120,-380),e.bezierCurveTo(-240,-260,-320,-160,-320,0),e.bezierCurveTo(-320,160,-240,260,-120,380),e.bezierCurveTo(-100,440,-100,440,-80,480),e.lineTo(60,480),e.lineTo(0,380),e.bezierCurveTo(-80,260,-220,180,-220,0),e.bezierCurveTo(-220,-180,-80,-260,0,-380),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(245, 245, 245, 0.5)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(56,-478),e.lineTo(-78,-478),e.bezierCurveTo(-98,-440,-96,-440,-118,-378),e.lineTo(-4,-378),e.lineTo(56,-478),e.moveTo(56,478),e.lineTo(-78,478),e.bezierCurveTo(-98,440,-96,440,-118,378),e.lineTo(-4,378),e.closePath(),e.fillStyle="rgba(255,255,185,1)",e.fill()),this.isClicked},ED.CornealAbrasion=function(t,e,a,r,i,o,s,n,l,h,d){this.className="CornealAbrasion",this.isInVisualAxis=!1,ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.CornealAbrasion.prototype=new ED.Doodle,ED.CornealAbrasion.prototype.constructor=ED.CornealAbrasion,ED.CornealAbrasion.superclass=ED.Doodle.prototype,ED.CornealAbrasion.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.CornealAbrasion.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.isRotatable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.25,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.25,2)},ED.CornealAbrasion.prototype.setParameterDefaults=function(){this.apexY=-50,this.scaleX=1.5,this.scaleY=1,this.setOriginWithDisplacements(0,25)},ED.CornealAbrasion.prototype.draw=function(t){var e=this.drawing.context;ED.CornealAbrasion.superclass.draw.call(this,t),e.beginPath();var a=120;e.arc(0,0,a,0,2*Math.PI,!1),e.closePath(),-this.apexY/100,e.fillStyle="rgba(0, 255, 0, 1)",e.strokeStyle="rgba(100,100,100,0.9)",this.drawBoundary(t);var r=new ED.Point(0,0);return r.setWithPolars(a,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(r),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CornealAbrasion.prototype.description=function(){var t="",e=this.scaleX+this.scaleY;return t=2>e?"Small ":4>e?"Medium ":"Large ",t+="corneal abrasion"},ED.CornealOedema=function(t,e,a,r,i,o,s,n,l,h,d){this.className="CornealOedema",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.CornealOedema.prototype=new ED.Doodle,ED.CornealOedema.prototype.constructor=ED.CornealOedema,ED.CornealOedema.superclass=ED.Doodle.prototype,ED.CornealOedema.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.CornealOedema.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-50,50),this.parameterValidationArray.apexY.range.setMinAndMax(-380,-100)},ED.CornealOedema.prototype.setParameterDefaults=function(){this.apexY=-350},ED.CornealOedema.prototype.draw=function(t){var e=this.drawing.context;ED.CornealOedema.superclass.draw.call(this,t),e.beginPath();var a=-this.apexY;e.arc(0,0,a,0,2*Math.PI,!1),e.closePath();var r=.3+(this.apexX+50)/200;return e.fillStyle="rgba(100,100,100,"+r.toFixed(2)+")",e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CornealOedema.prototype.description=function(){return"Corneal oedema"},ED.CornealScar=function(t,e,a,r,i,o,s,n,l,h,d){this.className="CornealScar",this.isInVisualAxis=!1,ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.CornealScar.prototype=new ED.Doodle,ED.CornealScar.prototype.constructor=ED.CornealScar,ED.CornealScar.superclass=ED.Doodle.prototype,ED.CornealScar.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.CornealScar.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.isRotatable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-100,-10)},ED.CornealScar.prototype.setParameterDefaults=function(){this.apexY=-50,this.scaleX=.7,this.scaleY=.5,this.setOriginWithDisplacements(0,25)},ED.CornealScar.prototype.draw=function(t){var e=this.drawing.context;ED.CornealScar.superclass.draw.call(this,t),e.beginPath();var a=100;e.arc(0,0,a,0,2*Math.PI,!1),e.closePath();var r=-this.apexY/100;if(e.fillStyle="rgba(100,100,100,"+r.toFixed(2)+")",e.strokeStyle="rgba(100,100,100,0.9)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var i=new ED.Point(0,0),o=this.drawing.transform.transformPoint(i),e=this.drawing.context;this.isInVisualAxis=e.isPointInPath(o.x,o.y)?!0:!1}var s=new ED.Point(0,0);return s.setWithPolars(a,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(s),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CornealScar.prototype.description=function(){var t="",e=this.scaleX+this.scaleY;return t=2>e?"Small ":4>e?"Medium ":"Large ",t+="corneal scar",this.isInVisualAxis&&(t+=" involving visual axis"),t},ED.CornealScar.prototype.snomedCode=function(){return 95726001},ED.CornealScar.prototype.diagnosticHierarchy=function(){return 2},ED.CornealStriae=function(t,e,a,r,i,o,s,n,l,h,d){this.className="CornealStriae",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.CornealStriae.prototype=new ED.Doodle,ED.CornealStriae.prototype.constructor=ED.CornealStriae,ED.CornealStriae.superclass=ED.Doodle.prototype,ED.CornealStriae.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-50,50),this.parameterValidationArray.apexY.range.setMinAndMax(-380,-100)},ED.CornealStriae.prototype.setParameterDefaults=function(){this.apexY=-350},ED.CornealStriae.prototype.draw=function(t){var e=this.drawing.context;ED.CornealStriae.superclass.draw.call(this,t),e.beginPath();var a=-this.apexY;if(e.arc(0,0,a,0,2*Math.PI,!1),e.closePath(),e.fillStyle="rgba(100,100,100,0)",e.strokeStyle="rgba(100,100,100,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var r=-300,i=50,o=30,s=80,n=-2*s;e.beginPath();for(var l=0;5>l;l++)e.moveTo(n+s*l,r),e.bezierCurveTo(n+s*l-o,r+1*i,n+s*l-o,r+2*i,n+s*l,r+3*i),e.bezierCurveTo(n+s*l+o,r+4*i,n+s*l+o,r+5*i,n+s*l,r+6*i),e.bezierCurveTo(n+s*l-o,r+7*i,n+s*l-o,r+8*i,n+s*l,r+9*i),e.bezierCurveTo(n+s*l+o,r+10*i,n+s*l+o,r+11*i,n+s*l,r+12*i);e.lineWidth=20,e.strokeStyle="rgba(100,100,100,0.6)",e.stroke()}return this.isClicked},ED.CornealStriae.prototype.description=function(){return"Striate keratopathy"},ED.CornealSuture=function(t,e,a,r,i,o,s,n,l,h,d){this.className="CornealSuture",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.CornealSuture.prototype=new ED.Doodle,ED.CornealSuture.prototype.constructor=ED.CornealSuture,ED.CornealSuture.superclass=ED.Doodle.prototype,ED.CornealSuture.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.CornealSuture.prototype.setParameterDefaults=function(){this.radius=374,this.setRotationWithDisplacements(10,20)},ED.CornealSuture.prototype.draw=function(t){var e=this.drawing.context;ED.CornealSuture.superclass.draw.call(this,t),e.beginPath();var a=this.radius;if(e.rect(-20,-(a+40),40,80),e.closePath(),e.fillStyle="rgba(255,255,255,0.0)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.moveTo(0,-a-40),e.lineTo(0,-a+40),e.moveTo(-10,-a+10),e.lineTo(0,-a+20),e.lineTo(-10,-a+30),e.lineWidth=2;var r="rgba(0,0,120,0.7)";e.strokeStyle=r,e.stroke(),this.drawSpot(e,0,-a+20,4,r)}return this.isClicked},ED.CornealSuture.prototype.description=function(){var t="Corneal suture at ";return t+=this.clockHour()+" o'clock"},ED.CorticalCataract=function(t,e,a,r,i,o,s,n,l,h,d){this.className="CorticalCataract",this.grade="Mild",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.CorticalCataract.prototype=new ED.Doodle,ED.CorticalCataract.prototype.constructor=ED.CorticalCataract,ED.CorticalCataract.superclass=ED.Doodle.prototype,ED.CorticalCataract.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.CorticalCataract.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isRotatable=!1,this.isUnique=!0,this.parentClass="Lens",this.inFrontOfClassArray=["Lens","PostSubcapCataract","NuclearCataract"],this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-180,-20),this.parameterValidationArray.originX.range.setMinAndMax(-500,500),this.parameterValidationArray.originY.range.setMinAndMax(-500,500),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["Mild","Moderate","White"],animate:!0}},ED.CorticalCataract.prototype.setParameterDefaults=function(){this.setParameterFromString("grade","Mild")},ED.CorticalCataract.prototype.dependentParameterValues=function(t,e){var a=[];switch(t){case"apexY":a.grade=-120>e?"Mild":-60>e?"Moderate":"White";break;case"grade":switch(e){case"Mild":a.apexY=-180;break;case"Moderate":a.apexY=-100;break;case"White":a.apexY=-20}}return a},ED.CorticalCataract.prototype.draw=function(t){var e=this.drawing.context;ED.CorticalCataract.superclass.draw.call(this,t),e.beginPath();var a=16,r=240,i=230,o=2*Math.PI/a,s=o/2,n=-this.apexY,l=new ED.Point(0,0);l.setWithPolars(i,-s),e.moveTo(l.x,l.y);for(var h=0;a>h;h++){var d=h*o-s,c=new ED.Point(0,0);c.setWithPolars(i,d),e.lineTo(c.x,c.y);var p=new ED.Point(0,0);p.setWithPolars(n,h*o),e.lineTo(p.x,p.y)}return e.lineTo(l.x,l.y),e.moveTo(r,0),e.arc(0,0,r,0,2*Math.PI,!0),e.lineWidth=4,e.lineJoin="bevel",e.fillStyle="rgba(200,200,200,0.75)",e.strokeStyle="rgba(200,200,200,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CorticalCataract.prototype.description=function(){return this.getParameter("grade")+" cortical cataract"},ED.CorticalCataract.prototype.snomedCode=function(){return 193576003},ED.CorticalCataract.prototype.diagnosticHierarchy=function(){return 3},ED.CorticalCataractCrossSection=function(t,e,a,r,i,o,s,n,l,h,d){this.className="CorticalCataractCrossSection",this.grade="Mild",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.CorticalCataractCrossSection.prototype=new ED.Doodle,ED.CorticalCataractCrossSection.prototype.constructor=ED.CorticalCataractCrossSection,ED.CorticalCataractCrossSection.superclass=ED.Doodle.prototype,ED.CorticalCataractCrossSection.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.CorticalCataractCrossSection.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isRotatable=!1,this.isUnique=!0,this.parentClass="LensCrossSection",this.inFrontOfClassArray=["LensCrossSection","NuclearCataractCrossSection"],this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-180,-20),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["Mild","Moderate","White"],animate:!0}},ED.CorticalCataractCrossSection.prototype.setParameterDefaults=function(){this.originX=44,this.setParameterFromString("grade","Mild")},ED.CorticalCataractCrossSection.prototype.dependentParameterValues=function(t,e){var a=[];switch(t){case"apexY":a.grade=-120>e?"Mild":-60>e?"Moderate":"White";break;case"grade":switch(e){case"Mild":a.apexY=-180;break;case"Moderate":a.apexY=-100;break;case"White":a.apexY=-20}}return a},ED.CorticalCataractCrossSection.prototype.draw=function(t){var e=this.drawing.context;ED.CorticalCataractCrossSection.superclass.draw.call(this,t);var a=240,r=300,i=100,o=Math.asin(a/r),s=r*Math.cos(o),n=r-30;o=Math.acos(s/n);var l=Math.asin(-this.apexY/n);e.beginPath(),e.arc(i-s,0,n,l,o,!1),e.arc(i+s,0,n,Math.PI-o,Math.PI-l,!1);var h=n*Math.cos(l);return e.moveTo(i-s+h,this.apexY),e.arc(i-s,0,n,-l,-o,!0),e.arc(i+s,0,n,Math.PI+o,Math.PI+l,!0),e.lineWidth=30,e.lineCap="round",e.lineJoin="round",e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(200,200,200,0.75)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(i,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Fuchs=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Fuchs",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Fuchs.prototype=new ED.Doodle,ED.Fuchs.prototype.constructor=ED.Fuchs,ED.Fuchs.superclass=ED.Doodle.prototype,ED.Fuchs.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.Fuchs.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.isSqueezable=!0,this.isUnique=!0},ED.Fuchs.prototype.draw=function(t){var e=this.drawing.context;ED.Fuchs.superclass.draw.call(this,t),e.beginPath();var a=300;e.arc(0,0,a,0,2*Math.PI,!1),e.closePath();var r=e.createPattern(this.drawing.imageArray.FuchsPattern,"repeat");e.fillStyle=r,e.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(t);var i=new ED.Point(0,0);return i.setWithPolars(a,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(i),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Fuchs.prototype.description=function(){return"Fuch's Endothelial Dystrophy"},ED.Fuchs.prototype.snomedCode=function(){return 193839007},ED.Fuchs.prototype.diagnosticHierarchy=function(){return 2},ED.Hyphaema=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Hyphaema",this.ro=380,this.minimum=304,ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Hyphaema.prototype=new ED.Doodle,ED.Hyphaema.prototype.constructor=ED.Hyphaema,ED.Hyphaema.superclass=ED.Doodle.prototype,ED.Hyphaema.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Hyphaema.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.arc.range.setMinAndMax(20*Math.PI/180,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-50,50),this.parameterValidationArray.apexY.range.setMinAndMax(-380,this.minimum),this.parameterValidationArray.radius.range.setMinAndMax(250,450)},ED.Hyphaema.prototype.setParameterDefaults=function(){this.apexY=152},ED.Hyphaema.prototype.draw=function(t){var e=this.drawing.context;ED.Hyphaema.superclass.draw.call(this,t);var a=Math.asin(this.apexY/this.ro);e.beginPath(),e.arc(0,0,this.ro,a,Math.PI-a,!1),e.closePath();var r=(.1+(this.apexX+50)/111).toFixed(2);return e.fillStyle="rgba(255,0,0,"+r+")",e.lineWidth=1,e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Hyphaema.prototype.description=function(){var t=10*Math.round(10*(this.ro-this.apexY)/(2*this.ro));return t+"% hyphaema"},ED.Hypopyon=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Hypopyon",this.ro=380,this.minimum=304,ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Hypopyon.prototype=new ED.Doodle,ED.Hypopyon.prototype.constructor=ED.Hypopyon,ED.Hypopyon.superclass=ED.Doodle.prototype,ED.Hypopyon.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Hypopyon.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.arc.range.setMinAndMax(20*Math.PI/180,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-380,this.minimum),this.parameterValidationArray.radius.range.setMinAndMax(250,450)},ED.Hypopyon.prototype.setParameterDefaults=function(){this.apexY=260},ED.Hypopyon.prototype.draw=function(t){var e=this.drawing.context;ED.Hypopyon.superclass.draw.call(this,t);var a=Math.asin(this.apexY/this.ro);return e.beginPath(),e.arc(0,0,this.ro,a,Math.PI-a,!1),e.closePath(),e.fillStyle="rgba(221,209,171,1)",e.lineWidth=1,e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Hypopyon.prototype.description=function(){var t=Math.round(10*(this.ro-this.apexY)/(2*this.ro));return t+"mm hypopyon"},ED.IrisHook=function(t,e,a,r,i,o,s,n,l,h,d){this.className="IrisHook",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.IrisHook.prototype=new ED.Doodle,ED.IrisHook.prototype.constructor=ED.IrisHook,ED.IrisHook.superclass=ED.Doodle.prototype,ED.IrisHook.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isScaleable=!1},ED.IrisHook.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(45,90)},ED.IrisHook.prototype.draw=function(t){var e=this.drawing.context;ED.IrisHook.superclass.draw.call(this,t),e.beginPath();var a=260,r=this.drawing.lastDoodleOfClass("AntSeg");return r&&(a=-r.apexY),e.rect(-25,-440,50,180+a),e.closePath(),e.fillStyle="rgba(255,255,255,0)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(10,-430),e.lineTo(10,-a+10),e.lineTo(-10,-a),e.lineWidth=12,e.strokeStyle="rgba(120,120,120,0.75)",e.stroke(),e.beginPath(),e.moveTo(-20,-400),e.lineTo(40,-400),e.lineWidth=24,e.strokeStyle="rgba(255,120,0,0.75)",e.stroke()),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.IrisHook.prototype.groupDescription=function(){return"Iris hooks used at "},ED.IrisHook.prototype.description=function(){var t="";return t+=this.clockHour()},ED.IrisHook.prototype.groupDescriptionEnd=function(){return" o'clock"},ED.IrisNaevus=function(t,e,a,r,i,o,s,n,l,h,d){this.className="IrisNaevus",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.IrisNaevus.prototype=new ED.Doodle,ED.IrisNaevus.prototype.constructor=ED.IrisNaevus,ED.IrisNaevus.superclass=ED.Doodle.prototype,ED.IrisNaevus.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.IrisNaevus.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.isOrientated=!0},ED.IrisNaevus.prototype.setParameterDefaults=function(){this.originY=-226,this.scaleX=1.8},ED.IrisNaevus.prototype.draw=function(t){var e=this.drawing.context;ED.IrisNaevus.superclass.draw.call(this,t),e.beginPath();
var a=50;e.arc(0,0,a,0,2*Math.PI,!1),e.closePath(),e.fillStyle="brown",e.strokeStyle="rgba(100,100,100,0.9)",this.drawBoundary(t);var r=new ED.Point(0,0);return r.setWithPolars(a,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(r),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.IrisNaevus.prototype.description=function(){return"Iris naevus"},ED.LasikFlap=function(t,e,a,r,i,o,s,n,l,h,d){this.className="LasikFlap",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.LasikFlap.prototype=new ED.Doodle,ED.LasikFlap.prototype.constructor=ED.LasikFlap,ED.LasikFlap.superclass=ED.Doodle.prototype,ED.LasikFlap.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.LasikFlap.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isUnique=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.75,1.15),this.parameterValidationArray.scaleY.range.setMinAndMax(.75,1.15),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-200,-60)},ED.LasikFlap.prototype.setParameterDefaults=function(){this.apexY=-100},ED.LasikFlap.prototype.draw=function(t){var e=this.drawing.context;ED.LasikFlap.superclass.draw.call(this,t);var a=320,r=Math.PI/6,i=-Math.PI/2-r,o=-Math.PI/2+r;e.beginPath(),e.arc(0,0,a,i,o,!0),e.closePath(),e.fillStyle="rgba(155,255,255,0)",e.lineWidth=2,e.strokeStyle="rgba(100,100,100,0.9)",this.drawBoundary(t);var s=new ED.Point(0,0);return s.setWithPolars(a,r),this.handleArray[2].location=this.transform.transformPoint(s),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.LasikFlap.prototype.description=function(){var t="";if(this.drawing.eye==ED.eye.Right)var e=!0;else var e=!1;var a=Math.cos(this.rotation),r=Math.sin(this.rotation),i=Math.abs(a),o=Math.abs(r),s="";return r>a&&o>i&&(s=e?"nasal":"temporal"),r>a&&i>o&&(s="inferior"),a>r&&o>i&&(s=e?"temporal":"nasal"),a>r&&i>o&&(s="superior"),t="LASIK flap with "+s+" hinge"},ED.Lens=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Lens",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Lens.prototype=new ED.Doodle,ED.Lens.prototype.constructor=ED.Lens,ED.Lens.superclass=ED.Doodle.prototype,ED.Lens.prototype.setPropertyDefaults=function(){this.isUnique=!0,this.addAtBack=!0,this.parameterValidationArray.originX.range.setMinAndMax(-500,500),this.parameterValidationArray.originY.range.setMinAndMax(-500,500)},ED.Lens.prototype.setParameterDefaults=function(){},ED.Lens.prototype.draw=function(t){var e=this.drawing.context;ED.Lens.superclass.draw.call(this,t);var a=240;if(e.beginPath(),e.arc(0,0,a,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var r=a-60;e.beginPath(),e.arc(0,0,r,0,2*Math.PI,!0),e.strokeStyle="rgba(220, 220, 220, 0.75)",e.stroke()}return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.LensCrossSection=function(t,e,a,r,i,o,s,n,l,h,d){this.className="LensCrossSection",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.LensCrossSection.prototype=new ED.Doodle,ED.LensCrossSection.prototype.constructor=ED.LensCrossSection,ED.LensCrossSection.superclass=ED.Doodle.prototype,ED.LensCrossSection.prototype.setPropertyDefaults=function(){this.isUnique=!0,this.addAtBack=!0,this.parameterValidationArray.originX.range.setMinAndMax(-150,200),this.parameterValidationArray.originY.range.setMinAndMax(-380,380)},ED.LensCrossSection.prototype.setParameterDefaults=function(){this.originX=44},ED.LensCrossSection.prototype.draw=function(t){var e=this.drawing.context;ED.LensCrossSection.superclass.draw.call(this,t);var a=240,r=300,i=100,o=Math.asin(a/r),s=r*Math.cos(o),n=r-60,l=Math.acos(s/n);return e.beginPath(),e.arc(i-s,0,r,o,-o,!0),e.arc(i+s,0,r,Math.PI+o,Math.PI-o,!0),e.stroke(),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(i,n*Math.sin(l)),e.arc(i-s,0,n,l,-l,!0),e.arc(i+s,0,n,Math.PI+l,Math.PI-l,!0),e.strokeStyle="rgba(220, 220, 220, 0.75)",e.stroke(),e.beginPath(),e.moveTo(44-this.originX+80,-this.originY-349),e.lineTo(64,-207),e.moveTo(44-this.originX+80,-this.originY-349),e.lineTo(138,-207),e.moveTo(44-this.originX+120,-this.originY-349),e.lineTo(64,-207),e.moveTo(44-this.originX+120,-this.originY-349),e.lineTo(138,-207),e.moveTo(44-this.originX+80,-this.originY+349),e.lineTo(64,207),e.moveTo(44-this.originX+80,-this.originY+349),e.lineTo(138,207),e.moveTo(44-this.originX+120,-this.originY+349),e.lineTo(64,207),e.moveTo(44-this.originX+120,-this.originY+349),e.lineTo(138,207),e.lineWidth=2,e.strokeStyle="gray",e.stroke()),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.LimbalRelaxingIncision=function(t,e,a,r,i,o,s,n,l,h,d){this.className="LimbalRelaxingIncision",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.LimbalRelaxingIncision.prototype=new ED.Doodle,ED.LimbalRelaxingIncision.prototype.constructor=ED.LimbalRelaxingIncision,ED.LimbalRelaxingIncision.superclass=ED.Doodle.prototype,ED.LimbalRelaxingIncision.prototype.setHandles=function(){this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1)},ED.LimbalRelaxingIncision.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(20*Math.PI/180,Math.PI/2),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-334,-300),this.parameterValidationArray.radius.range.setMinAndMax(250,450)},ED.LimbalRelaxingIncision.prototype.setParameterDefaults=function(){this.arc=30*Math.PI/180;var t=this.drawing.lastDoodleOfClass(this.className);t?(this.rotation=t.rotation+Math.PI,this.arc=t.arc):this.rotation=this.drawing.eye==ED.eye.Right?-Math.PI/2:Math.PI/2},ED.LimbalRelaxingIncision.prototype.draw=function(t){var e=this.drawing.context;ED.LimbalRelaxingIncision.superclass.draw.call(this,t);var a=360,r=12,i=a+r,o=a-r;e.beginPath();var s=this.arc/2;e.arc(0,0,i,-Math.PI/2+s,-Math.PI/2-s,!0),e.arc(0,0,o,-Math.PI/2-s,-Math.PI/2+s,!1),e.closePath(),e.fillStyle="rgba(100,100,200,0.75)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(t);var n=new ED.Point(0,0);return n.setWithPolars(a,s),this.handleArray[3].location=this.transform.transformPoint(n),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.LimbalRelaxingIncision.prototype.description=function(){var t="Limbal relaxing incision "+(180*this.arc/Math.PI).toFixed(0)+" degrees at ";return t+=this.clockHour()+" o'clock"},ED.MattressSuture=function(t,e,a,r,i,o,s,n,l,h,d){this.className="MattressSuture",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.MattressSuture.prototype=new ED.Doodle,ED.MattressSuture.prototype.constructor=ED.MattressSuture,ED.MattressSuture.superclass=ED.Doodle.prototype,ED.MattressSuture.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.MattressSuture.prototype.setParameterDefaults=function(){this.radius=374,this.setRotationWithDisplacements(10,20)},ED.MattressSuture.prototype.draw=function(t){var e=this.drawing.context;ED.MattressSuture.superclass.draw.call(this,t),e.beginPath();var a=this.radius;return e.rect(-40,-(a+40),80,80),e.closePath(),e.fillStyle="rgba(255,255,255,0.0)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(-40,-(a+40)),e.lineTo(40,-(a+40)),e.lineTo(-40,-(a-40)),e.lineTo(40,-(a-40)),e.lineTo(-40,-(a+40)),e.lineWidth=2,e.strokeStyle="rgba(0,0,120,0.7)",e.closePath(),e.stroke()),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.MattressSuture.prototype.description=function(){var t="Mattress suture at ";return t+=this.clockHour()+" o'clock"},ED.NuclearCataract=function(t,e,a,r,i,o,s,n,l,h,d){this.className="NuclearCataract",this.grade="Mild",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.NuclearCataract.prototype=new ED.Doodle,ED.NuclearCataract.prototype.constructor=ED.NuclearCataract,ED.NuclearCataract.superclass=ED.Doodle.prototype,ED.NuclearCataract.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.NuclearCataract.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isRotatable=!1,this.isUnique=!0,this.addAtBack=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-120,0),this.parameterValidationArray.originX.range.setMinAndMax(-500,500),this.parameterValidationArray.originY.range.setMinAndMax(-500,500),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["Mild","Moderate","Brunescent"],animate:!0}},ED.NuclearCataract.prototype.setParameterDefaults=function(){this.setParameterFromString("grade","Mild")},ED.NuclearCataract.prototype.dependentParameterValues=function(t,e){var a=[];switch(t){case"apexY":a.grade=-80>e?"Mild":-40>e?"Moderate":"Brunescent";break;case"grade":switch(e){case"Mild":a.apexY=-120;break;case"Moderate":a.apexY=-80;break;case"Brunescent":a.apexY=0}}return a},ED.NuclearCataract.prototype.draw=function(t){var e=this.drawing.context;ED.NuclearCataract.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,200,0,2*Math.PI,!0),e.closePath(),e.lineWidth=0,yellowColour="rgba(255, 255, 0, 0.75)";var a="rgba("+Math.round(120-this.apexY)+", "+Math.round(60-this.apexY)+", 0, 0.75)",r=e.createRadialGradient(0,0,210,0,0,50);return r.addColorStop(0,yellowColour),r.addColorStop(1,a),e.fillStyle=r,e.strokeStyle="rgba(0,0,0,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.NuclearCataract.prototype.description=function(){return this.getParameter("grade")+" nuclear cataract"},ED.NuclearCataract.prototype.snomedCode=function(){return 53889007},ED.NuclearCataract.prototype.diagnosticHierarchy=function(){return 3},ED.NuclearCataractCrossSection=function(t,e,a,r,i,o,s,n,l,h,d){this.className="NuclearCataractCrossSection",this.grade="Mild",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.NuclearCataractCrossSection.prototype=new ED.Doodle,ED.NuclearCataractCrossSection.prototype.constructor=ED.NuclearCataractCrossSection,ED.NuclearCataractCrossSection.superclass=ED.Doodle.prototype,ED.NuclearCataractCrossSection.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.NuclearCataractCrossSection.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isRotatable=!1,this.isUnique=!0,this.parentClass="LensCrossSection",this.inFrontOfClassArray=["LensCrossSection","NuclearCataractCrossSection"],this.parameterValidationArray.apexX.range.setMinAndMax(100,100),this.parameterValidationArray.apexY.range.setMinAndMax(-180,-20),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["Mild","Moderate","Brunescent"],animate:!0}},ED.NuclearCataractCrossSection.prototype.setParameterDefaults=function(){this.apexX=100,this.originX=44,this.setParameterFromString("grade","Mild")},ED.NuclearCataractCrossSection.prototype.dependentParameterValues=function(t,e){var a=[];switch(t){case"apexY":a.grade=-80>e?"Mild":-40>e?"Moderate":"Brunescent";break;case"grade":switch(e){case"Mild":a.apexY=-120;break;case"Moderate":a.apexY=-80;break;case"Brunescent":a.apexY=0}}return a},ED.NuclearCataractCrossSection.prototype.draw=function(t){var e=this.drawing.context;ED.NuclearCataractCrossSection.superclass.draw.call(this,t);var a=240,r=300,i=100,o=Math.asin(a/r),s=r*Math.cos(o),n=r-60,l=Math.acos(s/n);e.beginPath(),e.arc(i-s,0,n,l,-l,!0),e.arc(i+s,0,n,Math.PI+l,Math.PI-l,!0),e.stroke(),e.lineWidth=0,yellowColour="rgba(255, 255, 0, 0.75)";var h="rgba("+Math.round(120-this.apexY)+", "+Math.round(60-this.apexY)+", 0, 0.75)",d=e.createRadialGradient(i,0,210,i,0,50);return d.addColorStop(0,yellowColour),d.addColorStop(1,h),e.fillStyle=d,e.strokeStyle="rgba(0,0,0,1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PCIOL=function(t,e,a,r,i,o,s,n,l,h,d){this.className="PCIOL",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.PCIOL.prototype=new ED.Doodle,ED.PCIOL.prototype.constructor=ED.PCIOL,ED.PCIOL.superclass=ED.Doodle.prototype,ED.PCIOL.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Rotate,!1)},ED.PCIOL.prototype.setPropertyDefaults=function(){this.addAtBack=!0,this.isScaleable=!1,this.isUnique=!0},ED.PCIOL.prototype.setParameterDefaults=function(){this.scaleX=.75,this.scaleY=.75},ED.PCIOL.prototype.draw=function(t){var e=this.drawing.context;ED.PCIOL.superclass.draw.call(this,t),e.beginPath();var a=240;e.arc(0,0,a,0,2*Math.PI,!1),e.moveTo(150,-190),e.bezierCurveTo(160,-200,190,-350,160,-380),e.bezierCurveTo(90,-440,-150,-410,-220,-370),e.bezierCurveTo(-250,-350,-260,-400,-200,-430),e.bezierCurveTo(-110,-480,130,-470,200,-430),e.bezierCurveTo(270,-390,220,-140,220,-100),e.moveTo(-150,190),e.bezierCurveTo(-160,200,-190,350,-160,380),e.bezierCurveTo(-90,440,150,410,220,370),e.bezierCurveTo(250,350,260,400,200,430),e.bezierCurveTo(110,480,-130,470,-200,430),e.bezierCurveTo(-270,390,-220,140,-220,100),e.fillStyle="rgba(255,255,255,0.75)",e.lineWidth=4,e.strokeStyle="darkgray",this.drawBoundary(t);var r=new ED.Point(0,0);return r.setWithPolars(a,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(r),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PCIOL.prototype.description=function(){var t="Posterior chamber IOL",e=40,a="";return-e>this.originY&&(a.length>0&&(a+=" and"),a+=" superiorly"),this.originY>e&&(a.length>0&&(a+=" and"),a+=" inferiorly"),-e>this.originX&&(a.length>0&&(a+=" and"),a+=this.drawing.eye==ED.eye.Right?" temporally":" nasally"),this.originX>e&&(a.length>0&&(a+=" and"),a+=this.drawing.eye==ED.eye.Right?" nasally":" temporally"),a.length>0&&(t+=" displaced"+a),t},ED.PI=function(t,e,a,r,i,o,s,n,l,h,d){this.className="PI",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.PI.prototype=new ED.Doodle,ED.PI.prototype.constructor=ED.PI,ED.PI.superclass=ED.Doodle.prototype,ED.PI.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.PI.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(30,30)},ED.PI.prototype.draw=function(t){var e=this.drawing.context;ED.PI.superclass.draw.call(this,t);var a=360;e.beginPath();var r=Math.PI/24;return e.arc(0,0,a,-r-Math.PI/2,r-Math.PI/2,!1),e.lineTo(0,.8*-a),e.closePath(),e.fillStyle="rgba(218,230,241,1)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(t),this.isClicked},ED.PI.prototype.description=function(){return"Peripheral iridectomy at "+this.clockHour()+" o'clock"},ED.PhakoIncision=function(t,e,a,r,i,o,s,n,l,h,d){this.className="PhakoIncision",this.defaultRadius=330,this.sutureSeparation=1.5,this.apexYDelta=r+o,this.incisionLength=l*Math.PI/180*6*r/this.defaultRadius,this.incisionSite="Corneal",this.incisionType="Pocket",this.incisionMeridian=0,ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.PhakoIncision.prototype=new ED.Doodle,ED.PhakoIncision.prototype.constructor=ED.PhakoIncision,ED.PhakoIncision.superclass=ED.Doodle.prototype,ED.PhakoIncision.prototype.setHandles=function(){this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.PhakoIncision.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.radius.range.setMinAndMax(250,450),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.incisionMeridian={kind:"derived",type:"mod",range:new ED.Range(0,360),clock:"bottom",animate:!0},this.parameterValidationArray.incisionLength={kind:"derived",type:"float",range:new ED.Range(1,9.9),precision:1,animate:!0},this.parameterValidationArray.incisionSite={kind:"derived",type:"string",list:["Corneal","Limbal","Scleral"],animate:!0},this.parameterValidationArray.incisionType={kind:"derived",type:"string",list:["Pocket","Section"],animate:!1}},ED.PhakoIncision.prototype.setParameterDefaults=function(){this.setParameterFromString("incisionSite","Corneal"),this.setParameterFromString("incisionLength","3.5"),this.setParameterFromString("incisionType","Pocket"),this.setRotationWithDisplacements(90,-90)},ED.PhakoIncision.prototype.dependentParameterValues=function(t,e){var a=[];switch(t){case"rotation":var r=(180*(2*Math.PI-e+Math.PI/2)/Math.PI+360)%360;360==r&&(r=0),a.incisionMeridian=r;break;case"arc":a.incisionLength=e*6*this.radius/this.defaultRadius;break;case"radius":a.incisionSite=e>=428?"Scleral":e>=344?"Limbal":"Corneal",a.arc=this.incisionLength*this.defaultRadius/(6*e),this.updateArcRange(),a.apexY=this.apexYDelta-e,this.parameterValidationArray.apexY.range.setMinAndMax(-e,-e+34);break;case"apexY":a.apexYDelta=this.radius+e,a.incisionType=this.radius+e>0?"Section":"Pocket";break;case"incisionMeridian":a.rotation=(90-e+360)%360*Math.PI/180;break;case"incisionLength":a.arc=e*this.defaultRadius/(6*this.radius),this.updateArcRange();break;case"incisionSite":switch(e){case"Scleral":a.radius=428;break;case"Limbal":a.radius=376;break;case"Corneal":a.radius=330}break;case"incisionType":switch(e){case"Pocket":a.apexYDelta=0,a.apexY=-this.radius;break;case"Section":a.apexYDelta=34,a.apexY=34-this.radius}}return a},ED.PhakoIncision.prototype.updateArcRange=function(){this.radius>0?(this.parameterValidationArray.arc.range.min=this.parameterValidationArray.incisionLength.range.min*this.defaultRadius/(6*this.radius),this.parameterValidationArray.arc.range.max=this.parameterValidationArray.incisionLength.range.max*this.defaultRadius/(6*this.radius)):ED.errorHandler("ED.PhakoIncision","updateArcRange","Attempt to calculate a range of arc using an illegal value of radius: "+this.radius)},ED.PhakoIncision.prototype.draw=function(t){var e=this.drawing.context;ED.PhakoIncision.superclass.draw.call(this,t);var a=this.radius,r=40,i=a+r,o=a-r;e.beginPath();var s=this.arc/2;if(e.arc(0,0,i,-Math.PI/2+s,-Math.PI/2-s,!0),e.arc(0,0,o,-Math.PI/2-s,-Math.PI/2+s,!1),e.closePath(),0==this.apexYDelta?(e.fillStyle="rgba(200,200,200,0.75)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)"):(e.fillStyle="rgba(200,200,200,0)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0)"),this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&0!=this.apexYDelta){e.beginPath(),e.arc(0,0,a,-Math.PI/2+s,-Math.PI/2-s,!0);var n=this.sutureSeparation*this.defaultRadius/(6*this.radius),l=new ED.Point(0,0),h=s-n/2;do l.setWithPolars(a-r,h),e.moveTo(l.x,l.y),l.setWithPolars(a+r,h),e.lineTo(l.x,l.y),h-=n;while(h>-s);e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",e.stroke()}var d=new ED.Point(0,0);return d.setWithPolars(a,s),this.handleArray[3].location=this.transform.transformPoint(d),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PhakoIncision.prototype.description=function(){var t="";return t=this.radius>428?"Scleral ":this.radius>344?"Limbal ":"Corneal ",t+=0==this.apexY+this.radius?"pocket ":"section ",t+="incision at ",t+=this.clockHour()+" o'clock"},ED.PostSubcapCataract=function(t,e,a,r,i,o,s,n,l,h,d){this.className="PostSubcapCataract",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.PostSubcapCataract.prototype=new ED.Doodle,ED.PostSubcapCataract.prototype.constructor=ED.PostSubcapCataract,ED.PostSubcapCataract.superclass=ED.Doodle.prototype,ED.PostSubcapCataract.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.PostSubcapCataract.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parentClass="Lens",this.inFrontOfClassArray=["Lens"],this.parameterValidationArray.apexX.range.setMinAndMax(35,100),this.parameterValidationArray.apexY.range.setMinAndMax(-100,-35)},ED.PostSubcapCataract.prototype.setParameterDefaults=function(){this.apexX=35,this.apexY=35,this.radius=50},ED.PostSubcapCataract.prototype.dependentParameterValues=function(t){var e=[];switch(t){case"apexX":e.radius=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY);break;case"apexY":e.radius=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY)}return e},ED.PostSubcapCataract.prototype.draw=function(t){var e=this.drawing.context;ED.PostSubcapCataract.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,this.radius,0,2*Math.PI,!1),e.closePath(),e.lineWidth=4;var a=e.createPattern(this.drawing.imageArray.PSCPattern,"repeat");e.fillStyle=a,e.strokeStyle="lightgray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw;var r=new ED.Point(0,0);return r.setWithPolars(this.radius,Math.PI/4),this.handleArray[4].location=this.transform.transformPoint(r),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PostSubcapCataract.prototype.description=function(){return"Posterior subcapsular cataract"},ED.PostSubcapCataract.prototype.snomedCode=function(){return 315353005},ED.PostSubcapCataract.prototype.diagnosticHierarchy=function(){return 3},ED.PostSubcapCataractCrossSection=function(t,e,a,r,i,o,s,n,l,h,d){this.className="PostSubcapCataractCrossSection",this.grade="Mild",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.PostSubcapCataractCrossSection.prototype=new ED.Doodle,ED.PostSubcapCataractCrossSection.prototype.constructor=ED.PostSubcapCataractCrossSection,ED.PostSubcapCataractCrossSection.superclass=ED.Doodle.prototype,ED.PostSubcapCataractCrossSection.prototype.setHandles=function(){},ED.PostSubcapCataractCrossSection.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isRotatable=!1,this.isUnique=!0,this.parentClass="LensCrossSection",this.inFrontOfClassArray=["LensCrossSection"],this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-180,-20)},ED.PostSubcapCataractCrossSection.prototype.setParameterDefaults=function(){this.originX=44,this.apexY=-35},ED.PostSubcapCataractCrossSection.prototype.draw=function(t){var e=this.drawing.context;ED.PostSubcapCataractCrossSection.superclass.draw.call(this,t);var a=240,r=300,i=100,o=Math.asin(a/r),s=r*Math.cos(o),n=r-10;o=Math.acos(s/n);var l=Math.asin(-this.apexY/n);return e.beginPath(),e.arc(i-s,0,n,-l,l,!1),e.lineWidth=10,e.lineCap="round",e.lineJoin="round",e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(150,150,150,0.75)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PosteriorSynechia=function(t,e,a,r,i,o,s,n,l,h,d){this.className="PosteriorSynechia",this.size=150,ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.PosteriorSynechia.prototype=new ED.Doodle,ED.PosteriorSynechia.prototype.constructor=ED.PosteriorSynechia,ED.PosteriorSynechia.superclass=ED.Doodle.prototype,ED.PosteriorSynechia.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.PosteriorSynechia.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-380,-0),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/12,2*Math.PI/3),this.parameterValidationArray.size={kind:"derived",type:"float",range:new ED.Range(20,100),precision:1,animate:!0}},ED.PosteriorSynechia.prototype.setParameterDefaults=function(){this.arc=Math.PI/6,this.setRotationWithDisplacements(90,45);var t=this.drawing.lastDoodleOfClass("AntSeg");this.apexY=t?t.apexY+this.size:-200},ED.PosteriorSynechia.prototype.dependentParameterValues=function(t,e){var a=[];switch(t){case"size":var r=this.drawing.lastDoodleOfClass("AntSeg");r&&(a.apexY=r.apexY-e);break;case"apexY":var r=this.drawing.lastDoodleOfClass("AntSeg");r&&(a.size=r.apexY-e)}return a},ED.PosteriorSynechia.prototype.draw=function(t){var e=this.drawing.context;ED.PosteriorSynechia.superclass.draw.call(this,t);var a=200,r=this.drawing.lastDoodleOfClass("AntSeg");r&&(a=-r.apexY),-this.apexY,e.beginPath();var i=this.arc/2,o=-Math.PI/2+i,s=-Math.PI/2-i,n=new ED.Point(-a*Math.sin(i),-a*Math.cos(i)),l=new ED.Point(a*Math.sin(i),-a*Math.cos(i));e.beginPath(),e.arc(0,0,a,s,o,!1);var h=new ED.Point(this.apexX,this.apexY),d=l.pointAtAngleToLineToPointAtProportion(Math.PI/12,h,.33),c=h.pointAtAngleToLineToPointAtProportion(-Math.PI/12,l,.33);e.bezierCurveTo(d.x,d.y,c.x,c.y,this.apexX,this.apexY);var p=h.pointAtAngleToLineToPointAtProportion(Math.PI/12,n,.33),D=n.pointAtAngleToLineToPointAtProportion(-Math.PI/12,h,.33);return e.bezierCurveTo(p.x,p.y,D.x,D.y,n.x,n.y),e.closePath(),e.fillStyle="rgba(100, 200, 250, 0.5)",e.lineWidth=4,e.strokeStyle="rgba(250, 250, 250, 0.0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.arc(0,0,a,s,o,!1),e.lineWidth=6,e.strokeStyle="white",e.stroke(),e.strokeStyle="rgba(100, 200, 250, 0.5)",e.stroke(),e.beginPath(),e.moveTo(l.x,l.y),e.bezierCurveTo(d.x,d.y,c.x,c.y,this.apexX,this.apexY),e.bezierCurveTo(p.x,p.y,D.x,D.y,n.x,n.y),e.lineWidth=4,e.strokeStyle="gray",e.stroke()),this.handleArray[0].location=this.transform.transformPoint(n),this.handleArray[3].location=this.transform.transformPoint(l),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PosteriorSynechia.prototype.groupDescription=function(){return"Posterior synechiae at "},ED.PosteriorSynechia.prototype.description=function(){return this.clockHour()+" o'clock"},ED.RK=function(t,e,a,r,i,o,s,n,l,h,d){this.className="RK",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.RK.prototype=new ED.Doodle,ED.RK.prototype.constructor=ED.RK,ED.RK.superclass=ED.Doodle.prototype,ED.RK.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.RK.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isUnique,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.15),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.15),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-200,-60)},ED.RK.prototype.setParameterDefaults=function(){this.apexY=-100},ED.RK.prototype.draw=function(t){var e=this.drawing.context;ED.RK.superclass.draw.call(this,t);var a=320,r=-this.apexY,i=8,o=0,s=2*Math.PI;if(e.beginPath(),e.arc(0,0,a,o,s,!0),e.moveTo(r,0),e.arc(0,0,r,s,o,!1),e.closePath(),e.fillStyle="rgba(155,255,255,0)",e.lineWidth=2,e.strokeStyle="rgba(100,100,100,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var n=2*Math.PI/i;e.strokeStyle="rgba(100,100,100,0.7)",e.beginPath();var l;for(l=0;i>l;l++){var h=l*n,d=new ED.Point(0,0);d.setWithPolars(r,h);var c=new ED.Point(0,0);c.setWithPolars(a,h),e.moveTo(d.x,d.y),e.lineTo(c.x,c.y),e.closePath()}e.stroke()}var p=new ED.Point(0,0);return p.setWithPolars(a,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(p),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RK.prototype.description=function(){return"Radial keratotomy"},ED.Rubeosis=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Rubeosis",this.severity=50,ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Rubeosis.prototype=new ED.Doodle,ED.Rubeosis.prototype.constructor=ED.Rubeosis,ED.Rubeosis.superclass=ED.Doodle.prototype,ED.Rubeosis.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Rubeosis.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-380,-200),this.parameterValidationArray.severity={kind:"derived",type:"float",range:new ED.Range(20,100),precision:1,animate:!0}},ED.Rubeosis.prototype.setParameterDefaults=function(){this.arc=Math.PI/12,this.setRotationWithDisplacements(90,45);var t=this.drawing.lastDoodleOfClass("AntSeg");this.apexY=t?t.apexY-this.severity:-320},ED.Rubeosis.prototype.dependentParameterValues=function(t,e){var a=[];switch(t){case"severity":var r=this.drawing.lastDoodleOfClass("AntSeg");r&&(a.apexY=r.apexY-e);break;case"apexY":var r=this.drawing.lastDoodleOfClass("AntSeg");r&&(a.severity=r.apexY-e)}return a},ED.Rubeosis.prototype.draw=function(t){var e=this.drawing.context;ED.Rubeosis.superclass.draw.call(this,t);var a=200,r=this.drawing.lastDoodleOfClass("AntSeg");r&&(a=-r.apexY);var i=a+16;this.parameterValidationArray.apexY.range.max=-a-50,this.apexY=this.parameterValidationArray.apexY.range.constrain(-a-this.severity);var o=-this.apexY,s=i+(o-i)/2;e.beginPath();var n=this.arc/2,l=-Math.PI/2+n,h=-Math.PI/2-n,d=new ED.Point(-s*Math.sin(n),-s*Math.cos(n)),c=new ED.Point(s*Math.sin(n),-s*Math.cos(n));if(e.beginPath(),e.arc(0,0,i,l,h,!0),e.arc(0,0,o,h,l,!1),e.closePath(),e.fillStyle=this.isSelected?"rgba(240,240,240,0.5)":"rgba(240,240,240,0.0)",e.lineWidth=1,e.strokeStyle="rgba(120,120,120,0.0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();for(var p=2*Math.PI/16,D=Math.PI/24,u=2*Math.PI/60,y=a+2*(o-a)/3,g=1+Math.floor(this.arc/p),E=0;g>E;E++){var f=d.pointAtRadiusAndClockwiseAngle(a,D+E*p),m=d.pointAtRadiusAndClockwiseAngle(o,D+E*p+u),P=d.pointAtRadiusAndClockwiseAngle(y,D+E*p),w=d.pointAtRadiusAndClockwiseAngle(o,D+E*p+u/2);e.moveTo(f.x,f.y),e.bezierCurveTo(P.x,P.y,w.x,w.y,m.x,m.y),m=d.pointAtRadiusAndClockwiseAngle(o,D+E*p-u),P=d.pointAtRadiusAndClockwiseAngle(y,D+E*p),w=d.pointAtRadiusAndClockwiseAngle(o,D+E*p-u/2),e.moveTo(f.x,f.y),e.bezierCurveTo(P.x,P.y,w.x,w.y,m.x,m.y)}e.lineWidth=4,e.strokeStyle="red",e.stroke()}return this.handleArray[0].location=this.transform.transformPoint(d),this.handleArray[3].location=this.transform.transformPoint(c),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Rubeosis.prototype.groupDescription=function(){return"Rubeotic vessels on margin of pupil at "},ED.Rubeosis.prototype.description=function(){return this.clockHour()+" o'clock"},ED.SectorIridectomy=function(t,e,a,r,i,o,s,n,l,h,d){this.className="SectorIridectomy",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.SectorIridectomy.prototype=new ED.Doodle,ED.SectorIridectomy.prototype.constructor=ED.SectorIridectomy,ED.SectorIridectomy.superclass=ED.Doodle.prototype,ED.SectorIridectomy.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1)},ED.SectorIridectomy.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(20*Math.PI/180,Math.PI/2),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-334,-300),this.parameterValidationArray.radius.range.setMinAndMax(250,450)
},ED.SectorIridectomy.prototype.setParameterDefaults=function(){this.arc=60*Math.PI/180;var t=this.drawing.lastDoodleOfClass(this.className);t&&(this.rotation=t.rotation+Math.PI/2)},ED.SectorIridectomy.prototype.draw=function(t){var e=this.drawing.context;ED.SectorIridectomy.superclass.draw.call(this,t);var a,r=376,i=this.drawing.lastDoodleOfClass("AntSeg");a=i?-i.apexY-2:300;var o=a+(r-a)/2,s=this.arc/2;-Math.PI/2+s,-Math.PI/2-s;var n=o*Math.sin(s),l=-o*Math.cos(s),h=-o*Math.sin(s),d=l;e.beginPath();var s=this.arc/2;return e.arc(0,0,r,-Math.PI/2+s,-Math.PI/2-s,!0),e.arc(0,0,a,-Math.PI/2-s,-Math.PI/2+s,!1),e.closePath(),e.fillStyle="rgba(218,230,241,1)",e.lineWidth=4,e.strokeStyle="rgba(218,230,241,1)",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(h,d)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(n,l)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.SectorIridectomy.prototype.description=function(){var t="Sector iridectomy of "+(180*this.arc/Math.PI).toFixed(0)+" degrees at ";return t+=this.clockHour()+" o'clock"},ED.SidePort=function(t,e,a,r,i,o,s,n,l,h,d){this.className="SidePort",this.incisionLength=1.5,ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.SidePort.prototype=new ED.Doodle,ED.SidePort.prototype.constructor=ED.SidePort,ED.SidePort.superclass=ED.Doodle.prototype,ED.SidePort.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-334,-300),this.parameterValidationArray.arc.range.setMinAndMax(0,Math.PI),this.parameterValidationArray.radius.range.setMinAndMax(250,450)},ED.SidePort.prototype.setParameterDefaults=function(){this.arc=this.incisionLength/6,this.setRotationWithDisplacements(90,180)},ED.SidePort.prototype.draw=function(t){var e=this.drawing.context;ED.SidePort.superclass.draw.call(this,t);var a=334,r=30,i=a+r,o=a-r;e.beginPath();var s=this.arc/2;return e.arc(0,0,i,-Math.PI/2+s,-Math.PI/2-s,!0),e.arc(0,0,o,-Math.PI/2-s,-Math.PI/2+s,!1),e.closePath(),e.fillStyle="rgba(200,200,200,0.75)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(t),this.isClicked},ED.SidePort.prototype.groupDescription=function(){return"Sideport at "},ED.SidePort.prototype.description=function(){return this.clockHour()},ED.SidePort.prototype.groupDescriptionEnd=function(){return" o'clock"},ED.ToricPCIOL=function(t,e,a,r,i,o,s,n,l,h,d){this.className="ToricPCIOL",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.ToricPCIOL.prototype=new ED.Doodle,ED.ToricPCIOL.prototype.constructor=ED.ToricPCIOL,ED.ToricPCIOL.superclass=ED.Doodle.prototype,ED.ToricPCIOL.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Rotate,!1)},ED.ToricPCIOL.prototype.setPropertyDefaults=function(){this.addAtBack=!0,this.isOrientated=!1,this.isScaleable=!1,this.isUnique=!0},ED.ToricPCIOL.prototype.setParameterDefaults=function(){this.scaleX=.75,this.scaleY=.75},ED.ToricPCIOL.prototype.draw=function(t){var e=this.drawing.context;ED.ToricPCIOL.superclass.draw.call(this,t),e.beginPath();var a=240;if(e.arc(0,0,a,0,2*Math.PI,!1),e.moveTo(150,-190),e.bezierCurveTo(160,-200,190,-350,160,-380),e.bezierCurveTo(90,-440,-150,-410,-220,-370),e.bezierCurveTo(-250,-350,-260,-400,-200,-430),e.bezierCurveTo(-110,-480,130,-470,200,-430),e.bezierCurveTo(270,-390,220,-140,220,-100),e.moveTo(-150,190),e.bezierCurveTo(-160,200,-190,350,-160,380),e.bezierCurveTo(-90,440,150,410,220,370),e.bezierCurveTo(250,350,260,400,200,430),e.bezierCurveTo(110,480,-130,470,-200,430),e.bezierCurveTo(-270,390,-220,140,-220,100),e.fillStyle="rgba(255,255,255,0.75)",e.lineWidth=4,e.strokeStyle="darkgray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();var r=.7*Math.PI/4,i=r+Math.PI,o=new ED.Point(0,0);o.setWithPolars(a-20,r);var s=new ED.Point(0,0);s.setWithPolars(a-100,r);var n=new ED.Point(0,0);n.setWithPolars(a-20,i);var l=new ED.Point(0,0);l.setWithPolars(a-100,i),e.moveTo(o.x,o.y),e.lineTo(s.x,s.y),e.moveTo(n.x,n.y),e.lineTo(l.x,l.y),e.lineWidth=24,e.lineCap="round",e.strokeStyle="darkgray",e.stroke()}var h=new ED.Point(0,0);return h.setWithPolars(a,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(h),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ToricPCIOL.prototype.description=function(){var t="Toric posterior chamber IOL",e=40,a="";return-e>this.originY&&(a.length>0&&(a+=" and"),a+=" superiorly"),this.originY>e&&(a.length>0&&(a+=" and"),a+=" inferiorly"),-e>this.originX&&(a.length>0&&(a+=" and"),a+=" temporally"),this.originX>e&&(a.length>0&&(a+=" and"),a+=" nasally"),a.length>0&&(t+=" displaced"+a),t},ED.TrialFrame=function(t,e,a,r,i,o,s,n,l,h,d){this.className="TrialFrame",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.TrialFrame.prototype=new ED.Doodle,ED.TrialFrame.prototype.constructor=ED.TrialFrame,ED.TrialFrame.superclass=ED.Doodle.prototype,ED.TrialFrame.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.isUnique=!0},ED.TrialFrame.prototype.draw=function(t){var e=this.drawing.context;ED.TrialFrame.superclass.draw.call(this,t),e.beginPath();var a=420,r=340,i=300,o=20,s=50,n=-Math.PI/20,l=0+n,h=Math.PI-n;if(e.beginPath(),e.arc(0,0,a,l,h,!1),e.arc(0,0,i,h,l,!0),e.closePath(),e.fillStyle="rgba(230,230,230,1)",e.lineWidth=4,e.strokeStyle="darkgray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.font=s+"px sans-serif",e.fillStyle="blue",e.beginPath();for(var d=0,c=new ED.Point(0,0),p=new ED.Point(0,0),D=new ED.Point(0,0),u=new ED.Point(0,0),y=new ED.Point(0,0),g=0;19>g;g++){var E=g.toFixed(0);d=(-90-10*g)*Math.PI/180,c.setWithPolars(i,d),p.setWithPolars(i+o,d),D.setWithPolars(r,d),y.setWithPolars(a-o,d),u.setWithPolars(a,d),e.moveTo(c.x,c.y),e.lineTo(p.x,p.y),e.moveTo(y.x,y.y),e.lineTo(u.x,u.y),e.save(),e.translate(D.x,D.y),e.rotate(Math.PI+d),e.textAlign="center",e.fillText(E,0,40),e.restore()}e.moveTo(-20,0),e.lineTo(20,0),e.moveTo(0,-20),e.lineTo(0,20),e.stroke()}return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.TrialLens=function(t,e,a,r,i,o,s,n,l,h,d){this.className="TrialLens",this.axis="0",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.TrialLens.prototype=new ED.Doodle,ED.TrialLens.prototype.constructor=ED.TrialLens,ED.TrialLens.superclass=ED.Doodle.prototype,ED.TrialLens.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isShowHighlight=!1,this.isMoveable=!1,this.addAtBack=!0,this.isUnique=!0,this.parameterValidationArray.axis={kind:"derived",type:"mod",range:new ED.Range(0,180),clock:"bottom",animate:!0}},ED.TrialLens.prototype.setParameterDefaults=function(){this.setParameterFromString("axis","0")},ED.TrialLens.prototype.dependentParameterValues=function(t,e){var a=[];switch(t){case"rotation":a.axis=(360-180*e/Math.PI)%180;break;case"axis":a.rotation=(180-e)*Math.PI/180}return a},ED.TrialLens.prototype.draw=function(t){var e=this.drawing.context;ED.TrialLens.superclass.draw.call(this,t);var a=360,r=180;if(e.beginPath(),e.arc(0,0,a,0,2*Math.PI,!0),e.moveTo(r,0),e.arc(0,0,r,2*Math.PI,0,!1),e.lineWidth=4,e.fillStyle="rgba(255,100,100,1)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var i=20;e.beginPath(),e.moveTo(a-i,0),e.lineTo(r+i,0),e.moveTo(-a+i,0),e.lineTo(-r-i,0),e.lineWidth=16,e.strokeStyle="black",e.stroke()}return this.isClicked},null==ED||"object"!=typeof ED)var ED={};if(ED.Heart=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Heart",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Heart.prototype=new ED.Doodle,ED.Heart.prototype.constructor=ED.Heart,ED.Heart.superclass=ED.Doodle.prototype,ED.Heart.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Heart.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-460,-420),this.parameterValidationArray.apexY.range.setMinAndMax(-460,-400)},ED.Heart.prototype.setParameterDefaults=function(){this.apexX=-460,this.apexY=-460},ED.Heart.prototype.draw=function(t){var e=this.drawing.context;ED.Heart.superclass.draw.call(this,t);var a=0,r=2*Math.PI;return e.beginPath(),e.arc(0,0,400,a,r,!0),e.lineWidth=15,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 200, 200, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(-287,-51),e.bezierCurveTo(-344,53,-346,243,-116,209),e.bezierCurveTo(5,297,269,341,312,268),e.bezierCurveTo(387,141,319,-17,237,-59),e.bezierCurveTo(225,-133,141,-209,65,-215),e.bezierCurveTo(55,-209,43,-219,53,-193),e.bezierCurveTo(133,-185,201,-129,216,-46),e.bezierCurveTo(205,-23,167,11,187,25),e.bezierCurveTo(202,36,192,-37,235,-3),e.bezierCurveTo(291,41,333,227,295,207),e.bezierCurveTo(195,155,153,111,97,43),e.bezierCurveTo(74,15,177,62,181,43),e.bezierCurveTo(187,17,109,25,55,19),e.bezierCurveTo(31,-7,-172,-89,-173,-87),e.bezierCurveTo(-173,-84,-232,-117,-191,-73),e.bezierCurveTo(-115,-49,-61,-13,-37,-3),e.bezierCurveTo(-67,45,-14,171,3,165),e.bezierCurveTo(21,159,-53,45,15,23),e.bezierCurveTo(103,87,199,183,231,249),e.bezierCurveTo(199,297,-31,243,-81,199),e.bezierCurveTo(-53,175,-8,204,-13,187),e.bezierCurveTo(-17,171,-66,181,-105,185),e.bezierCurveTo(-331,209,-289,33,-273,-37),e.bezierCurveTo(-270,-47,-287,-51,-287,-51),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 200, 200, 1)",e.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Heart.prototype.description=function(){return"Heart"},ED.Aorta=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Aorta",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Aorta.prototype=new ED.Doodle,ED.Aorta.prototype.constructor=ED.Aorta,ED.Aorta.superclass=ED.Doodle.prototype,ED.Aorta.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Aorta.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-460,-420),this.parameterValidationArray.apexY.range.setMinAndMax(-460,-400)},ED.Aorta.prototype.setParameterDefaults=function(){this.scaleX=.5,this.scaleY=.5,this.originX=-352,this.originY=-416,this.apexX=-460,this.apexY=-460},ED.Aorta.prototype.draw=function(t){var e=this.drawing.context;ED.Aorta.superclass.draw.call(this,t);var a=0,r=2*Math.PI;return e.beginPath(),e.arc(0,0,400,a,r,!0),e.lineWidth=15,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 200, 200, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(216,-112),e.bezierCurveTo(216,-112,181,46,210,40),e.bezierCurveTo(239,33,282,-111,282,-111),e.moveTo(423,335),e.bezierCurveTo(423,335,453,57,313,31),e.bezierCurveTo(281,26,330,-100,330,-100),e.moveTo(-1,-25),e.bezierCurveTo(-1,-25,57,2,74,41),e.bezierCurveTo(82,61,93,79,116,78),e.bezierCurveTo(144,78,141,42,141,7),e.bezierCurveTo(141,-50,159,-97,159,-97),e.moveTo(198,582),e.bezierCurveTo(214,619,155,663,105,649),e.moveTo(-39,12),e.bezierCurveTo(-39,12,52,54,28,133),e.bezierCurveTo(28,133,-2,180,-16,200),e.bezierCurveTo(-49,246,-125,446,-28,595),e.lineTo(-1,640),e.bezierCurveTo(67,725,152,624,119,566),e.bezierCurveTo(151,598,255,603,251,514),e.bezierCurveTo(250,473,182,418,182,418),e.bezierCurveTo(118,352,162,209,254,211),e.bezierCurveTo(314,212,287,365,287,365),e.lineWidth=12,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(100, 100, 100, 1)",e.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Aorta.prototype.description=function(){return""},ED.RightCoronaryArtery=function(t,e,a,r,i,o,s,n,l,h,d){this.className="RightCoronaryArtery",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.RightCoronaryArtery.prototype=new ED.Doodle,ED.RightCoronaryArtery.prototype.constructor=ED.RightCoronaryArtery,ED.RightCoronaryArtery.superclass=ED.Doodle.prototype,ED.RightCoronaryArtery.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.RightCoronaryArtery.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-460,-420),this.parameterValidationArray.apexY.range.setMinAndMax(-460,-400)},ED.RightCoronaryArtery.prototype.setParameterDefaults=function(){this.originX=24,this.originY=2,this.scaleX=1.5,this.scaleY=1.5,this.apexX=-460,this.apexY=-460},ED.RightCoronaryArtery.prototype.draw=function(t){var e=this.drawing.context;ED.RightCoronaryArtery.superclass.draw.call(this,t);var a=0,r=2*Math.PI;return e.beginPath(),e.arc(0,0,400,a,r,!0),e.lineWidth=1,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 200, 200, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(-254,-66),e.bezierCurveTo(-379,8,-313,171,-289,204),e.bezierCurveTo(-245,265,-184,266,-151,252),e.bezierCurveTo(-144,261,-94,311,-94,311),e.moveTo(-244,-58),e.bezierCurveTo(-364,-23,-327,263,-173,247),e.bezierCurveTo(-138,243,-88,191,-36,242),e.bezierCurveTo(-15,261,-9,276,-9,276),e.moveTo(-54,292),e.bezierCurveTo(-54,292,-103,238,-110,234),e.bezierCurveTo(-125,237,-142,247,-142,247),e.moveTo(-82,306),e.lineTo(-142,247),e.moveTo(-42,286),e.lineTo(-96,232),e.bezierCurveTo(-84,218,-36,250,-24,276),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(100, 100, 100, 1)",e.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RightCoronaryArtery.prototype.description=function(){return""},ED.LeftCoronaryArtery=function(t,e,a,r,i,o,s,n,l,h,d){this.className="LeftCoronaryArtery",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.LeftCoronaryArtery.prototype=new ED.Doodle,ED.LeftCoronaryArtery.prototype.constructor=ED.LeftCoronaryArtery,ED.LeftCoronaryArtery.superclass=ED.Doodle.prototype,ED.LeftCoronaryArtery.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.LeftCoronaryArtery.prototype.setPropertyDefaults=function(){this.isDeletable=!1},ED.LeftCoronaryArtery.prototype.setParameterDefaults=function(){this.originY=0,this.scaleX=1.5,this.scaleY=1.5,this.apexX=-153,this.apexY=-84},ED.LeftCoronaryArtery.prototype.draw=function(t){var e=this.drawing.context;ED.LeftCoronaryArtery.superclass.draw.call(this,t);var a=0,r=2*Math.PI;return e.beginPath(),e.arc(-100,-50,100,a,r,!0),e.lineWidth=1,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 200, 200, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(this.apexX,this.apexY),e.bezierCurveTo(-165,-48,-94,-52,-37,-58),e.bezierCurveTo(20,-63,40,-34,102,-34),e.bezierCurveTo(119,-34,135,-36,135,-36),e.moveTo(68,136),e.bezierCurveTo(50,130,23,124,14,110),e.bezierCurveTo(2,92,-2,66,-7,39),e.bezierCurveTo(-11,23,-24,-5,-35,-26),e.bezierCurveTo(-50,-55,41,-34,42,-8),e.bezierCurveTo(45,25,39,41,39,41),e.moveTo(200,257),e.bezierCurveTo(223,258,289,267,311,253),e.bezierCurveTo(331,240,314,208,304,193),e.bezierCurveTo(282,155,246,114,224,90),e.moveTo(67,143),e.bezierCurveTo(67,143,42,138,16,129),e.bezierCurveTo(21,144,26,171,40,185),e.bezierCurveTo(63,208,102,210,102,210),e.moveTo(103,218),e.bezierCurveTo(103,218,55,208,39,202),e.bezierCurveTo(49,273,165,280,165,280),e.moveTo(195,136),e.bezierCurveTo(195,136,197,101,196,86),e.bezierCurveTo(214,97,232,110,243,130),e.bezierCurveTo(249,142,247,180,247,180),e.moveTo(164,284),e.bezierCurveTo(164,284,101,286,55,253),e.bezierCurveTo(35,238,24,200,16,175),e.lineTo(-6,94),e.moveTo(221,80),e.moveTo(135,-33),e.bezierCurveTo(135,-33,104,-23,71,-28),e.bezierCurveTo(110,-7,147,18,182,48),e.bezierCurveTo(193,57,205,73,215,77),e.bezierCurveTo(226,81,241,81,253,83),e.moveTo(190,133),e.bezierCurveTo(190,133,191,87,178,68),e.bezierCurveTo(165,49,96,11,96,11),e.moveTo(-4,98),e.bezierCurveTo(-10,136,-10,136,-22,156),e.moveTo(58,-10),e.bezierCurveTo(62,18,62,18,54,42),e.moveTo(102,10),e.bezierCurveTo(106,38,106,38,102,56),e.moveTo(222,90),e.bezierCurveTo(242,92,242,92,258,94),e.moveTo(258,142),e.bezierCurveTo(340,264,316,250,204,244),e.moveTo(258,142),e.bezierCurveTo(264,164,264,164,260,176),e.moveTo(54,-12),e.bezierCurveTo(54,-12,77,-4,84,7),e.bezierCurveTo(94,24,89,57,89,57),e.moveTo(-38,158),e.bezierCurveTo(-38,158,17,81,-58,-42),this.apexX>-200?e.bezierCurveTo(-152,-40,-146,-27,this.apexX-20,this.apexY):e.bezierCurveTo(-152,-40,-146,-27,this.apexX-8,this.apexY+15),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(100, 100, 100, 1)",e.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.LeftCoronaryArtery.prototype.description=function(){return-200>this.apexX?"Anomalous insertion of left coronary artery":""},ED.AnomalousVessels=function(t,e,a,r,i,o,s,n,l,h,d){this.className="AnomalousVessels",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.AnomalousVessels.prototype=new ED.Doodle,ED.AnomalousVessels.prototype.constructor=ED.AnomalousVessels,ED.AnomalousVessels.superclass=ED.Doodle.prototype,ED.AnomalousVessels.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.AnomalousVessels.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-460,-420),this.parameterValidationArray.apexY.range.setMinAndMax(-460,-400)},ED.AnomalousVessels.prototype.setParameterDefaults=function(){this.originY=-100,this.scaleX=1.5,this.scaleY=1.5,this.apexX=-460,this.apexY=-460},ED.AnomalousVessels.prototype.draw=function(t){var e=this.drawing.context;ED.AnomalousVessels.superclass.draw.call(this,t);var a=0,r=2*Math.PI;return e.beginPath(),e.arc(0,0,400,a,r,!0),e.lineWidth=1,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 200, 200, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(68,136),e.bezierCurveTo(50,130,23,124,14,110),e.bezierCurveTo(2,92,-2,66,-7,39),e.bezierCurveTo(-11,23,-24,-5,-35,-26),e.bezierCurveTo(-50,-55,41,-34,42,-8),e.bezierCurveTo(45,25,39,41,39,41),e.moveTo(200,257),e.bezierCurveTo(223,258,289,267,311,253),e.bezierCurveTo(331,240,314,208,304,193),e.bezierCurveTo(282,155,246,114,224,90),e.lineTo(254,89),e.moveTo(-6,94),e.bezierCurveTo(-8,113,-11,132,-33,164),e.moveTo(67,143),e.bezierCurveTo(67,143,42,138,16,129),e.bezierCurveTo(21,144,26,171,40,185),e.bezierCurveTo(63,208,102,210,102,210),e.moveTo(103,218),e.bezierCurveTo(103,218,55,208,39,202),e.bezierCurveTo(49,273,165,280,165,280),e.moveTo(-54,292),e.bezierCurveTo(-54,292,-103,238,-110,234),e.bezierCurveTo(-125,237,-142,247,-142,247),e.lineTo(-91,307),e.moveTo(195,136),e.bezierCurveTo(195,136,197,101,196,86),e.bezierCurveTo(214,97,232,110,243,130),e.bezierCurveTo(249,142,247,180,247,180),e.moveTo(164,284),e.bezierCurveTo(164,284,101,286,55,253),e.bezierCurveTo(35,238,24,200,16,175),e.lineTo(-6,94),e.moveTo(221,80),e.moveTo(257,151),e.bezierCurveTo(257,151,278,176,288,190),e.bezierCurveTo(297,204,312,227,304,240),e.bezierCurveTo(291,264,223,250,200,250),e.moveTo(-14,278),e.bezierCurveTo(-14,278,-49,217,-98,230),e.moveTo(135,-33),e.bezierCurveTo(135,-33,104,-23,71,-28),e.bezierCurveTo(110,-7,147,18,182,48),e.bezierCurveTo(193,57,205,73,215,77),e.bezierCurveTo(226,81,241,81,253,83),e.moveTo(190,133),e.bezierCurveTo(190,133,191,87,178,68),e.bezierCurveTo(165,49,96,11,96,11),e.moveTo(54,-12),e.bezierCurveTo(54,-12,77,-4,84,7),e.bezierCurveTo(94,24,89,57,89,57),e.moveTo(-210,-104),e.bezierCurveTo(-253,-100,-259,-73,-254,-66),e.bezierCurveTo(-379,8,-313,171,-289,204),e.bezierCurveTo(-245,265,-184,266,-151,252),e.bezierCurveTo(-144,261,-94,311,-94,311),e.moveTo(-38,158),e.bezierCurveTo(-38,158,17,81,-58,-42),e.bezierCurveTo(-152,-40,-206,-27,-238,-56),e.moveTo(-244,-58),e.bezierCurveTo(-364,-23,-327,263,-173,247),e.bezierCurveTo(-138,243,-88,191,-36,242),e.bezierCurveTo(-15,261,-9,276,-9,276),e.moveTo(-210,-94),e.bezierCurveTo(-277,-82,-206,-47,-186,-48),e.bezierCurveTo(-165,-48,-94,-52,-37,-58),e.bezierCurveTo(20,-63,40,-34,102,-34),e.bezierCurveTo(119,-34,135,-36,135,-36),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 200, 200, 1)",e.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AnomalousVessels.prototype.description=function(){return"AnomalousVessels"},ED.Lungs=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Lungs",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Lungs.prototype=new ED.Doodle,ED.Lungs.prototype.constructor=ED.Lungs,ED.Lungs.superclass=ED.Doodle.prototype,ED.Lungs.prototype.setHandles=function(){this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Lungs.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-40,30)},ED.Lungs.prototype.setParameterDefaults=function(){this.apexY=-20},ED.Lungs.prototype.draw=function(t){var e=this.drawing.context;return ED.Lungs.superclass.draw.call(this,t),e.beginPath(),e.moveTo(-147,-281),e.bezierCurveTo(-224,-279,-414,29,-426,289),e.bezierCurveTo(-334,226,-219,196,-79,236),e.bezierCurveTo(-6,231,-71,-284,-147,-281),e.moveTo(147,-281),e.bezierCurveTo(224,-279,414,29,426,289),e.bezierCurveTo(334,226,219,196,79,236),e.bezierCurveTo(6,231,71,-284,147,-281),e.closePath(),e.lineWidth=4,e.fillStyle="white",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[3].location=this.transform.transformPoint(new ED.Point(40,-40)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.leftExtremity=this.transform.transformPoint(new ED.Point(-40,-40)),this.rightExtremity=this.transform.transformPoint(new ED.Point(40,-40)),this.arc=this.calculateArc(),this.isClicked},ED.Lungs.prototype.description=function(){return 1==this.drawing.doodleArray.length?"No abnormality":""},ED.Effusion=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Effusion",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Effusion.prototype=new ED.Doodle,ED.Effusion.prototype.constructor=ED.Effusion,ED.Effusion.superclass=ED.Doodle.prototype,ED.Effusion.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Effusion.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1},ED.Effusion.prototype.setParameterDefaults=function(){this.apexX=-231,this.apexY=136},ED.Effusion.prototype.draw=function(t){var e=this.drawing.context;return ED.Effusion.superclass.draw.call(this,t),e.beginPath(),e.moveTo(this.apexX,this.apexY),e.lineTo(-400+(-136+this.apexY)*-.3,this.apexY),e.lineTo(-426,289),e.bezierCurveTo(-334,226,-219,196,-79,236),e.lineTo(-44,this.apexY),e.lineTo(this.apexX,this.apexY),e.closePath(),e.lineWidth=4,e.fillStyle="yellow",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Effusion.prototype.description=function(){return"pleural effusion in right lung"},ED.Bypass=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Bypass",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Bypass.prototype=new ED.Doodle,ED.Bypass.prototype.constructor=ED.Bypass,ED.Bypass.superclass=ED.Doodle.prototype,ED.Bypass.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Bypass.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1},ED.Bypass.prototype.setParameterDefaults=function(){var t=this.drawing.numberOfDoodlesOfClass(this.className);0==t?(this.apexX=40,this.apexY=-60):1==t?(this.apexX=-11,this.apexY=133):(this.apexX=-445,this.apexY=205)},ED.Bypass.prototype.draw=function(t){var e=this.drawing.context;ED.Bypass.superclass.draw.call(this,t),e.beginPath();var a=new ED.Point(-320,-200),r=new ED.Point(this.apexX,this.apexY),i=a.distanceTo(r),o=20,s=Math.PI/8;e.moveTo(a.x,a.y);var n=Math.atan((r.y-a.y)/(r.x-a.x));0>n&&(n=Math.PI/2+(Math.PI/2+n));var l=new ED.Point(0,0);l.setWithPolars(o,n);var h=new ED.Point(0,0);h.setWithPolars(i/2,n+Math.PI/2-s);var d=new ED.Point(l.x+r.x,l.y+r.y),c=new ED.Point(0,0);c.setWithPolars(o,n+Math.PI);var p=new ED.Point(c.x+r.x,c.y+r.y);return e.lineTo(a.x+l.x,a.y+l.y),e.bezierCurveTo(a.x+l.x+h.x,a.y+l.y+h.y,a.x+l.x+h.x,a.y+l.y+h.y,d.x,d.y),e.lineTo(r.x,r.y),e.lineTo(p.x,p.y),e.bezierCurveTo(a.x+c.x+h.x,a.y+c.y+h.y,a.x+c.x+h.x,a.y+c.y+h.y,a.x+c.x,a.y+c.y),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 000, 000, 1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.leftExtremity=this.transform.transformPoint(new ED.Point(-40,-40)),this.rightExtremity=this.transform.transformPoint(new ED.Point(40,-40)),this.arc=this.calculateArc(),this.isClicked},ED.Bypass.prototype.description=function(){var t="";return t=this.apexX>0?"left coronary artery":this.apexX>-300?"circumflex artery":"right coronary artery","Bypass graft to "+t},ED.Crepitations=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Crepitations",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Crepitations.prototype=new ED.Doodle,ED.Crepitations.prototype.constructor=ED.Crepitations,ED.Crepitations.superclass=ED.Doodle.prototype,ED.Crepitations.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Crepitations.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(50,200),this.parameterValidationArray.apexY.range.setMinAndMax(-0,0)},ED.Crepitations.prototype.setParameterDefaults=function(){this.rotation=-Math.PI/4,this.apexX=50,this.apexY=0,this.setOriginWithDisplacements(-150,300)},ED.Crepitations.prototype.draw=function(t){var e=this.drawing.context;ED.Crepitations.superclass.draw.call(this,t);var a=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY);if(e.beginPath(),e.arc(0,0,a,0,2*Math.PI,!0),e.lineWidth=3,e.strokeStyle="rgba(255, 255, 255, 0)",e.fillStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();var r=30;e.moveTo(-a,0),e.lineTo(a,0);for(var i=-1;2>i;i+=2)for(var o=r;a>o;o+=r){var s=this.xForY(a,o);e.moveTo(-s,i*o),e.lineTo(s,i*o)}e.lineWidth=15,e.lineCap="round",e.strokeStyle="rgba(200, 200, 200, 0.75)",e.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Crepitations.prototype.description=function(){var t=this.originX>0?" left lung":" right lung",e=this.originY>0?" lower lobe of":" upper lobe of";return"crepitations"+e+t},ED.Wheeze=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Wheeze",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Wheeze.prototype=new ED.Doodle,ED.Wheeze.prototype.constructor=ED.Wheeze,ED.Wheeze.superclass=ED.Doodle.prototype,ED.Wheeze.prototype.setHandles=function(){},ED.Wheeze.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-160,0),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.Wheeze.prototype.setParameterDefaults=function(){this.scaleX=.6,this.scaleY=.6,this.originX=172,this.originY=-62},ED.Wheeze.prototype.draw=function(t){var e=this.drawing.context;ED.Wheeze.superclass.draw.call(this,t);var a=100;e.beginPath(),e.arc(0,-50,a,0,2*Math.PI,!0),e.lineWidth=2,e.strokeStyle="rgba(255, 255, 255, 0)",e.fillStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.fillStyle="gray",e.strokeStyle="gray",e.lineWidth=8,e.beginPath(),e.arc(-50,0,20,0,2*Math.PI,!1),e.fill(),e.beginPath(),e.moveTo(-34,0),e.lineTo(-34,-100),e.lineTo(66,-150),e.lineTo(66,-50),e.stroke(),e.beginPath(),e.arc(50,-50,20,0,2*Math.PI,!1),e.fill(),e.closePath(),e.fillStyle="gray",e.fill()),this.isSelected&&!this.isForDrawing&&this.drawHandles(t);var r=new ED.Point(0,0);return r.setWithPolars(a,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(r),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Wheeze.prototype.description=function(){var t=this.originX>0?" left lung":" right lung",e=this.originY>0?" lower lobe of":" upper lobe of";return"wheeze"+e+t},ED.MetalStent=function(t,e,a,r,i,o,s,n,l,h,d){this.className="MetalStent",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.MetalStent.prototype=new ED.Doodle,ED.MetalStent.prototype.constructor=ED.MetalStent,ED.MetalStent.superclass=ED.Doodle.prototype,ED.MetalStent.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!0)},ED.MetalStent.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-160,0),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.MetalStent.prototype.setParameterDefaults=function(){this.originX=-18,this.originY=86,this.rotation=-4.985446531081719},ED.MetalStent.prototype.draw=function(t){console.log(this.originX,this.originY,this.rotation);var e=this.drawing.context;ED.MetalStent.superclass.draw.call(this,t);var a=50,r=10,i=10;if(e.beginPath(),e.rect(-a,-r,2*a,2*r),e.lineWidth=4,e.strokeStyle="blue",e.fillStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();for(var o=0;10>o;o++)e.moveTo(-a+o*i,-r),e.lineTo(-a+o*i,+r);e.stroke()}var s=new ED.Point(-50,-10);return this.handleArray[2].location=this.transform.transformPoint(s),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.MetalStent.prototype.description=function(){var t;return t=this.originX>0?"left coronary artery":this.originX>-300?"circumflex artery":"right coronary artery","Metal stent in "+t},ED.DrugStent=function(t,e,a,r,i,o,s,n,l,h,d){this.className="DrugStent",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.DrugStent.prototype=new ED.Doodle,ED.DrugStent.prototype.constructor=ED.DrugStent,ED.DrugStent.superclass=ED.Doodle.prototype,ED.DrugStent.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!0)},ED.DrugStent.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-160,0),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.DrugStent.prototype.setParameterDefaults=function(){this.originX=-18,this.originY=86,this.rotation=-4.985446531081719
},ED.DrugStent.prototype.draw=function(t){console.log(this.originX,this.originY,this.rotation);var e=this.drawing.context;ED.DrugStent.superclass.draw.call(this,t);var a=50,r=10,i=20;if(e.beginPath(),e.rect(-a,-r,2*a,2*r),e.lineWidth=4,e.strokeStyle="blue",e.fillStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();for(var o=0;5>o;o++)e.moveTo(-a+o*i,-r),e.lineTo(-a+(o+1)*i,+r),e.moveTo(-a+(o+1)*i,-r),e.lineTo(-a+o*i,+r);e.stroke()}var s=new ED.Point(-50,-10);return this.handleArray[2].location=this.transform.transformPoint(s),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.DrugStent.prototype.description=function(){var t;return t=this.originX>0?"left coronary artery":this.originX>-300?"circumflex artery":"right coronary artery","Metal stent in "+t},ED.Stenosis=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Stenosis",this.degree=0,this.type="Calcified",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Stenosis.prototype=new ED.Doodle,ED.Stenosis.prototype.constructor=ED.Stenosis,ED.Stenosis.superclass=ED.Doodle.prototype,ED.Stenosis.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Stenosis.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-10,10),this.parameterValidationArray.apexY.range.setMinAndMax(-100,0),this.parameterValidationArray.degree={kind:"derived",type:"int",range:new ED.Range(0,100),precision:0,animate:!0},this.parameterValidationArray.type={kind:"derived",type:"string",list:["Calcified","Non-calcified"],animate:!0}},ED.Stenosis.prototype.setParameterDefaults=function(){this.setParameterFromString("degree","0"),this.setParameterFromString("type","Calcified"),this.apexX=0,this.apexY=0,this.originX=-373,this.originY=323},ED.Stenosis.prototype.dependentParameterValues=function(t,e){var a=[];switch(t){case"apexX":a.type=e>0?"Calcified":"Non-calcified";break;case"apexY":a.degree=e/-1;break;case"type":a.apexX="Calcified"==e?10:-10;break;case"degree":a.apexY=-1*e}return a},ED.Stenosis.prototype.draw=function(t){var e=this.drawing.context;return ED.Stenosis.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,30,0,2*Math.PI,!1),e.lineWidth=2,e.strokeStyle="blue",e.fillStyle="rgba(155, 155, 0,"+this.apexY/-100+")",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&"Calcified"==this.type&&(e.beginPath(),e.arc(-10,-10,8,0,2*Math.PI,!1),e.moveTo(10,-10),e.arc(10,-10,8,0,2*Math.PI,!1),e.moveTo(10,10),e.arc(10,10,8,0,2*Math.PI,!1),e.moveTo(-10,10),e.arc(-10,10,8,0,2*Math.PI,!1),e.fillStyle="white",e.fill()),point=new ED.Point(this.apexX,this.apexY),this.handleArray[4].location=this.transform.transformPoint(point),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Stenosis.prototype.description=function(){var t;return t=this.originX>0?"left coronary artery":this.originX>-300?"circumflex artery":"right coronary artery",""+this.degree+"% "+this.type+" stenosis in the "+t},ED.Groin=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Groin",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Groin.prototype=new ED.Doodle,ED.Groin.prototype.constructor=ED.Groin,ED.Groin.superclass=ED.Doodle.prototype,ED.Groin.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Groin.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-460,-420),this.parameterValidationArray.apexY.range.setMinAndMax(-460,-400)},ED.Groin.prototype.setParameterDefaults=function(){},ED.Groin.prototype.draw=function(t){var e=this.drawing.context;return ED.Groin.superclass.draw.call(this,t),2*Math.PI,e.beginPath(),e.moveTo(12,49),e.bezierCurveTo(37,49,68,24,68,24),e.bezierCurveTo(73,42,136,318,136,318),e.lineTo(460,318),e.bezierCurveTo(460,318,468,191,468,159),e.bezierCurveTo(468,127,451,-48,451,-67),e.bezierCurveTo(451,-87,444,-188,444,-215),e.bezierCurveTo(444,-242,407,-402,407,-402),e.lineTo(-380,-402),e.bezierCurveTo(-380,-402,-417,-242,-417,-215),e.bezierCurveTo(-417,-189,-423,-87,-423,-67),e.bezierCurveTo(-423,-48,-440,127,-440,159),e.bezierCurveTo(-440,191,-432,318,-432,318),e.lineTo(-112,318),e.lineTo(-40,24),e.bezierCurveTo(-27,39,-10,49,15,49),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255, 175, 175, 0.5)",e.strokeStyle="rgba(100, 100, 100, 1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(-228,-189),e.lineTo(-158,-155),e.bezierCurveTo(-158,-155,-109,-113,-88,-75),e.bezierCurveTo(-74,-51,-65,-5,-40,24),e.moveTo(255,-189),e.lineTo(186,-155),e.bezierCurveTo(186,-155,136,-113,115,-75),e.bezierCurveTo(102,-51,92,-5,68,23),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(100, 100, 100, 1)",e.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Groin.prototype.description=function(){return"Groin"},ED.Haematoma=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Haematoma",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Haematoma.prototype=new ED.Doodle,ED.Haematoma.prototype.constructor=ED.Haematoma,ED.Haematoma.superclass=ED.Doodle.prototype,ED.Haematoma.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.Haematoma.prototype.setParameterDefaults=function(){this.originX=-150},ED.Haematoma.prototype.draw=function(t){var e=this.drawing.context;ED.Haematoma.superclass.draw.call(this,t);var a=30;e.beginPath(),e.arc(0,0,a,0,2*Math.PI,!0),e.lineWidth=1,e.strokeStyle="red",e.fillStyle="red",this.drawBoundary(t);var r=new ED.Point(0,0);return r.setWithPolars(a,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(r),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Haematoma.prototype.groupDescription=function(){return"Haematoma"},ED.Bruising=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Bruising",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Bruising.prototype=new ED.Doodle,ED.Bruising.prototype.constructor=ED.Bruising,ED.Bruising.superclass=ED.Doodle.prototype,ED.Bruising.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.Bruising.prototype.setParameterDefaults=function(){this.originX=-190,this.originY=100,this.scaleY=2},ED.Bruising.prototype.setPropertyDefaults=function(){this.isSqueezable=!0},ED.Bruising.prototype.draw=function(t){var e=this.drawing.context;ED.Bruising.superclass.draw.call(this,t);var a=100;e.beginPath(),e.arc(0,0,a,0,2*Math.PI,!0),e.lineWidth=1,e.strokeStyle="rgba(127, 0, 127, 0.5)",e.fillStyle="rgba(127, 0, 127, 0.5)",this.drawBoundary(t);var r=new ED.Point(0,0);return r.setWithPolars(a,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(r),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Bruising.prototype.description=function(){return"Bruising"},ED.Bruit=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Bruit",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Bruit.prototype=new ED.Doodle,ED.Bruit.prototype.constructor=ED.Bruit,ED.Bruit.superclass=ED.Doodle.prototype,ED.Bruit.prototype.setHandles=function(){},ED.Bruit.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-160,0),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.Bruit.prototype.setParameterDefaults=function(){this.scaleX=.6,this.scaleY=.6,this.originX=-150,this.originY=-62},ED.Bruit.prototype.draw=function(t){var e=this.drawing.context;ED.Bruit.superclass.draw.call(this,t);var a=100;e.beginPath(),e.arc(0,-50,a,0,2*Math.PI,!0),e.lineWidth=2,e.strokeStyle="rgba(155, 255, 255, 0)",e.fillStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.fillStyle="gray",e.strokeStyle="gray",e.lineWidth=8,e.beginPath(),e.arc(-50,0,20,0,2*Math.PI,!1),e.fill(),e.beginPath(),e.moveTo(-34,0),e.lineTo(-34,-100),e.lineTo(0,-80),e.stroke()),this.isSelected&&!this.isForDrawing&&this.drawHandles(t);var r=new ED.Point(0,0);return r.setWithPolars(a,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(r),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Bruit.prototype.description=function(){return"Bruit"},null==ED||"object"!=typeof ED)var ED={};if(ED.Surgeon=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Surgeon",this.surgeonPosition="Temporal",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Surgeon.prototype=new ED.Doodle,ED.Surgeon.prototype.constructor=ED.Surgeon,ED.Surgeon.superclass=ED.Doodle.prototype,ED.Surgeon.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.snapToAngles=!0,this.willStaySelected=!1,this.isUnique=!0,this.isDeletable=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(100,500),this.parameterValidationArray.surgeonPosition={kind:"derived",type:"string",list:["Superior","Supero-temporal","Temporal","Infero-temporal","Inferior","Infero-nasal","Nasal","Supero-nasal"],animate:!0};var t=Math.PI/4;this.anglesArray=[0,t,2*t,3*t,4*t,5*t,6*t,7*t]},ED.Surgeon.prototype.setParameterDefaults=function(){this.rotation=0,this.setParameterFromString("surgeonPosition","Temporal")},ED.Surgeon.prototype.dependentParameterValues=function(t,e){var a=[],r=this.drawing.eye==ED.eye.Right,i=2*Math.PI;switch(t){case"rotation":a.surgeonPosition=r?i/16>e?"Superior":3*i/16>e?"Supero-nasal":5*i/16>e?"Nasal":7*i/16>e?"Infero-nasal":9*i/16>e?"Inferior":11*i/16>e?"Infero-temporal":13*i/16>e?"Temporal":15*i/16>e?"Supero-temporal":"Superior":i/16>e?"Superior":3*i/16>e?"Supero-temporal":5*i/16>e?"Temporal":7*i/16>e?"Infero-temporal":9*i/16>e?"Inferior":11*i/16>e?"Infero-nasal":13*i/16>e?"Nasal":15*i/16>e?"Supero-nasal":"Superior";break;case"surgeonPosition":switch(e){case"Superior":a.rotation=0;break;case"Supero-temporal":a.rotation=r?7*Math.PI/4:1*Math.PI/4;break;case"Temporal":a.rotation=r?6*Math.PI/4:2*Math.PI/4;break;case"Infero-temporal":a.rotation=r?5*Math.PI/4:3*Math.PI/4;break;case"Inferior":a.rotation=Math.PI;break;case"Infero-nasal":a.rotation=r?3*Math.PI/4:5*Math.PI/4;break;case"Nasal":a.rotation=r?2*Math.PI/4:6*Math.PI/4;break;case"Supero-nasal":a.rotation=r?1*Math.PI/4:7*Math.PI/4}}return a},ED.Surgeon.prototype.draw=function(t){var e=this.drawing.context;ED.Surgeon.superclass.draw.call(this,t),e.beginPath();var a=.2,r=-300;e.moveTo(0*a,r-200*a),e.bezierCurveTo(-100*a,r-250*a,-145*a,r-190*a,-200*a,r-180*a),e.bezierCurveTo(-310*a,r-160*a,-498*a,r-75*a,-500*a,r+0*a),e.bezierCurveTo(-500*a,r+50*a,-500*a,r+460*a,-470*a,r+700*a),e.bezierCurveTo(-470*a,r+710*a,-500*a,r+770*a,-500*a,r+810*a),e.bezierCurveTo(-500*a,r+840*a,-440*a,r+850*a,-420*a,r+840*a),e.bezierCurveTo(-390*a,r+830*a,-380*a,r+710*a,-380*a,r+700*a),e.bezierCurveTo(-370*a,r+700*a,-360*a,r+780*a,-350*a,r+780*a),e.bezierCurveTo(-330*a,r+780*a,-340*a,r+730*a,-340*a,r+700*a),e.bezierCurveTo(-340*a,r+690*a,-350*a,r+680*a,-350*a,r+670*a),e.bezierCurveTo(-350*a,r+590*a,-385*a,r+185*a,-300*a,r+100*a),e.bezierCurveTo(-150*a,r+140*a,-250*a,r+200*a,0*a,r+300*a),e.bezierCurveTo(250*a,r+200*a,150*a,r+140*a,300*a,r+100*a),e.bezierCurveTo(380*a,r+180*a,350*a,r+590*a,350*a,r+670*a),e.bezierCurveTo(350*a,r+680*a,340*a,r+690*a,340*a,r+700*a),e.bezierCurveTo(340*a,r+730*a,330*a,r+780*a,350*a,r+780*a),e.bezierCurveTo(360*a,r+780*a,370*a,r+700*a,380*a,r+700*a),e.bezierCurveTo(380*a,r+710*a,390*a,r+830*a,420*a,r+840*a),e.bezierCurveTo(430*a,r+845*a,505*a,r+840*a,505*a,r+810*a),e.bezierCurveTo(505*a,r+760*a,470*a,r+710*a,470*a,r+700*a),e.bezierCurveTo(500*a,r+460*a,499*a,r+45*a,500*a,r+0*a),e.bezierCurveTo(498*a,r-78*a,308*a,r-164*a,200*a,r-182*a),e.bezierCurveTo(145*a,r-190*a,100*a,r-250*a,0*a,r-200*a),e.lineWidth=4,e.strokeStyle="rgba(120,120,120,1)";var i=new ED.Colour(0,0,0,1);return i.setWithHexString("3AFEFA"),e.fillStyle=i.rgba(),this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(0*a,r-250*a),e.bezierCurveTo(-100*a,r-250*a,-180*a,r-200*a,-200*a,r-170*a),e.bezierCurveTo(-209*a,r-157*a,-220*a,r-100*a,-230*a,r-50*a),e.bezierCurveTo(-260*a,r-70*a,-260*a,r-20*a,-260*a,r+0*a),e.bezierCurveTo(-260*a,r+20*a,-260*a,r+80*a,-230*a,r+60*a),e.bezierCurveTo(-230*a,r+90*a,-220*a,r+141*a,-210*a,r+160*a),e.bezierCurveTo(-190*a,r+200*a,-100*a,r+280*a,-40*a,r+300*a),e.bezierCurveTo(-34*a,r+303*a,-20*a,r+350*a,0*a,r+350*a),e.bezierCurveTo(20*a,r+350*a,34*a,r+300*a,40*a,r+300*a),e.bezierCurveTo(100*a,r+280*a,190*a,r+200*a,210*a,r+160*a),e.bezierCurveTo(218*a,r+143*a,230*a,r+90*a,230*a,r+60*a),e.bezierCurveTo(260*a,r+80*a,260*a,r+20*a,260*a,r+0*a),e.bezierCurveTo(260*a,r-20*a,260*a,r-70*a,230*a,r-50*a),e.bezierCurveTo(220*a,r-100*a,208*a,r-158*a,200*a,r-170*a),e.bezierCurveTo(180*a,r-200*a,100*a,r-250*a,0*a,r-250*a),e.fill(),e.stroke()),this.isClicked},ED.OperatingTable=function(t,e,a,r,i,o,s,n,l,h,d){this.className="OperatingTable",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.OperatingTable.prototype=new ED.Doodle,ED.OperatingTable.prototype.constructor=ED.OperatingTable,ED.OperatingTable.superclass=ED.Doodle.prototype,ED.OperatingTable.prototype.setPropertyDefaults=function(){this.isSelectable=!1},ED.OperatingTable.prototype.draw=function(t){var e=this.drawing.context;return ED.OperatingTable.superclass.draw.call(this,t),e.beginPath(),e.arc(0,-0,60,0,2*Math.PI,!0),e.lineWidth=30,e.strokeStyle="rgba(120,120,120,1)",e.fillStyle="rgba(220,220,220,1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.rect(-100,20,200,400),e.lineWidth=8,e.strokeStyle="rgba(120,120,120,1)",e.fillStyle="rgba(220,220,220,1)",e.fill(),e.stroke()),this.isClicked},ED.Label=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Label",this.labelText="Start typing..",this.labelWidth=0,this.labelHeight=80,this.labelFont="60px sans-serif",this.padding=10,this.maximumLength=20,this.isEdited=!1,this.lastOriginX=0,this.lastOriginY=0,ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Label.prototype=new ED.Doodle,ED.Label.prototype.constructor=ED.Label,ED.Label.superclass=ED.Doodle.prototype,ED.Label.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Label.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-1e3,1e3),this.parameterValidationArray.apexY.range.setMinAndMax(-1e3,1e3)},ED.Label.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(0,-100),this.lastOriginX=this.originX,this.lastOriginY=this.originY,this.apexX=100,this.apexY=-150},ED.Label.prototype.dependentParameterValues=function(t,e){var a=[];switch(t){case"originX":a.apexX=this.apexX-(e-this.lastOriginX),this.lastOriginX=e;break;case"originY":a.apexY=this.apexY-(e-this.lastOriginY),this.lastOriginY=e}return a},ED.Label.prototype.draw=function(t){var e=this.drawing.context;if(ED.Label.superclass.draw.call(this,t),e.font=this.labelFont,this.labelWidth=e.measureText(this.labelText).width+2*this.padding,e.beginPath(),e.rect(-this.labelWidth/2,-this.labelHeight/2,this.labelWidth,this.labelHeight),e.closePath(),e.lineWidth=2,this.isFilled=!1,e.strokeStyle="rgba(0, 0, 0, 0)",this.isSelected&&(e.strokeStyle="gray"),this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.fillText(this.labelText,-this.labelWidth/2+this.padding,this.labelHeight/6);var a,r=new ED.Point(0,0);a=0==this.apexX?2:Math.abs(this.apexY/this.apexX),0>=this.apexY&&a>=1&&(r.x=0,r.y=-this.labelHeight/2),0>=this.apexX&&1>a&&(r.x=-this.labelWidth/2,r.y=0),this.apexY>0&&a>=1&&(r.x=0,r.y=this.labelHeight/2),this.apexX>0&&1>a&&(r.x=this.labelWidth/2,r.y=0);var i=new ED.Point(this.apexX,this.apexY);e.beginPath(),e.moveTo(r.x,r.y),e.lineTo(i.x,i.y),e.strokeStyle="Gray",e.lineWidth=4,e.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Label.prototype.addLetter=function(t){var e=String.fromCharCode(t);this.isEdited||(this.labelText="",this.isEdited=!0),8==t?this.labelText.length>0&&(this.labelText=this.labelText.substring(0,this.labelText.length-1)):this.labelText.length<this.maximumLength&&(this.labelText+=e)},ED.MouseTest=function(t,e,a,r,i,o,s,n,l,h,d){this.className="MouseTest",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.MouseTest.prototype=new ED.Doodle,ED.MouseTest.prototype.constructor=ED.MouseTest,ED.MouseTest.superclass=ED.Doodle.prototype,ED.MouseTest.prototype.setPropertyDefaults=function(){this.isMoveable=!1},ED.MouseTest.prototype.draw=function(t){var e=this.drawing.context;ED.MouseTest.superclass.draw.call(this,t),e.beginPath();var a=200;return e.rect(-a/2,-a/2,a,a),e.closePath(),e.lineWidth=1,e.fillStyle="white",e.strokeStyle="blue",this.drawBoundary(t),this.isClicked&&console.log(t.x,t.y),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.isClicked},null==ED||"object"!=typeof ED)var ED={};var rsl=480,rsli=470,rtmo=404,rtmi=304,rcbo=270,rcbi=190,riro=190,riri=176,rpu=100;if(ED.Gonioscopy=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Gonioscopy",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Gonioscopy.prototype=new ED.Doodle,ED.Gonioscopy.prototype.constructor=ED.Gonioscopy,ED.Gonioscopy.superclass=ED.Doodle.prototype,ED.Gonioscopy.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Gonioscopy.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-460,-420),this.parameterValidationArray.apexY.range.setMinAndMax(-460,-400)},ED.Gonioscopy.prototype.setParameterDefaults=function(){this.apexX=-460,this.apexY=-460},ED.Gonioscopy.prototype.draw=function(t){var e=this.drawing.context;ED.Gonioscopy.superclass.draw.call(this,t);var a=0,r=2*Math.PI;if(e.beginPath(),e.arc(0,0,rsl,a,r,!0),e.lineWidth=15,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 200, 200, 1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.arc(0,0,rtmo,a,r,!0),e.moveTo(rtmi,0),e.arc(0,0,rtmi,r,a,!1),e.lineWidth=1;var i;-440>this.apexX?(i=-440>this.apexY?e.createPattern(this.drawing.imageArray.MeshworkPatternLight,"repeat"):-420>this.apexY?e.createPattern(this.drawing.imageArray.MeshworkPatternMedium,"repeat"):e.createPattern(this.drawing.imageArray.MeshworkPatternHeavy,"repeat"),e.fillStyle=i):e.fillStyle=-440>this.apexY?"rgba(250, 200, 0, 1)":-420>this.apexY?"rgba(200, 150, 0, 1)":"rgba(150, 100, 0, 1)",e.strokeStyle="rgba(200, 200, 200, 1)",e.fill(),e.stroke(),e.beginPath(),e.arc(0,0,rcbo,a,r,!0),e.arc(0,0,rcbi,r,a,!1),e.fillStyle="rgba(200, 200, 200, 1)",e.fill();var o=15,s=new ED.Point(0,0),n=new ED.Point(0,0),l=0;for(l=0;12>l;l++){var h=(o+30*l)*Math.PI/180;s.setWithPolars(rcbi,h),e.beginPath(),e.moveTo(s.x,s.y),1==l||4==l||7==l||10==l?(n.setWithPolars(rsl+80,h),e.lineWidth=6,e.strokeStyle="rgba(20, 20, 20, 1)"):(n.setWithPolars(rsl,h),e.lineWidth=2,e.strokeStyle="rgba(137, 137, 137, 1)"),e.lineTo(n.x,n.y),e.closePath(),e.stroke()}e.beginPath(),e.arc(0,0,riro,a,r,!0),e.arc(0,0,riri,r,a,!1),e.lineWidth=2,e.strokeStyle="rgba(180, 180, 180, 1)",e.fillStyle="rgba(200, 200, 200, 1)",e.fill(),e.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Gonioscopy.prototype.description=function(){var t="";return t=-440>this.apexX?-440>this.apexY?"Light patchy pigment":-420>this.apexY?"Medium patchy pigment":"Heavy patchy pigment":-440>this.apexY?"Light homogenous pigment":-420>this.apexY?"Medium homogenous pigment":"Heavy homogenous pigment"},ED.AngleGradeNorth=function(t,e,a,r,i,o,s,n,l,h,d){this.className="AngleGradeNorth",this.grade="4",this.seen="Yes",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.AngleGradeNorth.prototype=new ED.Doodle,ED.AngleGradeNorth.prototype.constructor=ED.AngleGradeNorth,ED.AngleGradeNorth.superclass=ED.Doodle.prototype,ED.AngleGradeNorth.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.AngleGradeNorth.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-rsli,-riri),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["4","3","2","1","0"],animate:!0},this.parameterValidationArray.seen={kind:"derived",type:"string",list:["Yes","No"],animate:!0}},ED.AngleGradeNorth.prototype.setParameterDefaults=function(){this.arc=90*Math.PI/180,this.apexY=-riri,this.setParameterFromString("grade","4"),this.setParameterFromString("seen","Yes")},ED.AngleGradeNorth.prototype.dependentParameterValues=function(t,e){var a=[];switch(t){case"apexY":var r="4";-e>=riro&&(r="3"),-e>=rcbo&&(r="2"),-e>=rtmo&&(r="1"),-e>=rsli&&(r="0"),a.grade=r,a.seen=-e>=rtmo?"No":"Yes";break;case"grade":var r="";switch(e){case"0":r=-this.apexY>=rsli?this.apexY:-rsli;break;case"1":r=-this.apexY>=rtmo&&rsli>-this.apexY?this.apexY:-rtmo;break;case"2":r=-this.apexY>=rcbo&&rtmo>-this.apexY?this.apexY:-360;break;case"3":r=-this.apexY>=riro&&rcbo>-this.apexY?this.apexY:-230;break;case"4":r=-this.apexY>=riri&&riro>-this.apexY?this.apexY:-riri}a.apexY=r;break;case"seen":var r="";switch(e){case"No":r=-this.apexY>=rtmo?this.apexY:-rtmo;break;case"Yes":r=rtmo>-this.apexY?this.apexY:-riri}a.apexY=r}return a},ED.AngleGradeNorth.prototype.draw=function(t){var e=this.drawing.context;ED.AngleGradeNorth.superclass.draw.call(this,t);var a=this.arc/2,r=-Math.PI/2+a,i=-Math.PI/2-a;return e.beginPath(),e.arc(0,0,-this.apexY,r,i,!0),e.arc(0,0,rpu,i,r,!1),e.closePath(),e.fillStyle="rgba(100, 200, 250, 1.0)",e.strokeStyle="rgba(100, 100, 100, 1.0)",e.lineWidth=4,this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AngleGradeEast=function(t,e,a,r,i,o,s,n,l,h,d){this.className="AngleGradeEast",this.grade="4",this.seen="Yes",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.AngleGradeEast.prototype=new ED.Doodle,ED.AngleGradeEast.prototype.constructor=ED.AngleGradeEast,ED.AngleGradeEast.superclass=ED.Doodle.prototype,ED.AngleGradeEast.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.AngleGradeEast.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-rsli,-riri),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["4","3","2","1","0"],animate:!0},this.parameterValidationArray.seen={kind:"derived",type:"string",list:["Yes","No"],animate:!0}},ED.AngleGradeEast.prototype.setParameterDefaults=function(){this.arc=90*Math.PI/180,this.apexY=-riri,this.rotation=Math.PI/2,this.setParameterFromString("grade","4"),this.setParameterFromString("seen","Yes")},ED.AngleGradeEast.prototype.dependentParameterValues=function(t,e){var a=[];switch(t){case"apexY":var r="4";-e>=riro&&(r="3"),-e>=rcbo&&(r="2"),-e>=rtmo&&(r="1"),-e>=rsli&&(r="0"),a.grade=r,a.seen=-e>=rtmo?"No":"Yes";break;case"grade":var r="";switch(e){case"0":r=-this.apexY>=rsli?this.apexY:-rsli;break;case"1":r=-this.apexY>=rtmo&&rsli>-this.apexY?this.apexY:-rtmo;break;case"2":r=-this.apexY>=rcbo&&rtmo>-this.apexY?this.apexY:-360;break;case"3":r=-this.apexY>=riro&&rcbo>-this.apexY?this.apexY:-230;break;case"4":r=-this.apexY>=riri&&riro>-this.apexY?this.apexY:-riri}a.apexY=r;break;case"seen":var r="";switch(e){case"No":r=-this.apexY>=rtmo?this.apexY:-rtmo;break;case"Yes":r=rtmo>-this.apexY?this.apexY:-riri}a.apexY=r}return a},ED.AngleGradeEast.prototype.draw=function(t){var e=this.drawing.context;ED.AngleGradeEast.superclass.draw.call(this,t);var a=this.arc/2,r=-Math.PI/2+a,i=-Math.PI/2-a;return e.beginPath(),e.arc(0,0,-this.apexY,r,i,!0),e.arc(0,0,rpu,i,r,!1),e.closePath(),e.fillStyle="rgba(100, 200, 250, 1.0)",e.strokeStyle="rgba(100, 100, 100, 1.0)",e.lineWidth=4,this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AngleGradeSouth=function(t,e,a,r,i,o,s,n,l,h,d){this.className="AngleGradeSouth",this.grade="4",this.seen="Yes",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.AngleGradeSouth.prototype=new ED.Doodle,ED.AngleGradeSouth.prototype.constructor=ED.AngleGradeSouth,ED.AngleGradeSouth.superclass=ED.Doodle.prototype,ED.AngleGradeSouth.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.AngleGradeSouth.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-rsli,-riri),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["4","3","2","1","0"],animate:!0},this.parameterValidationArray.seen={kind:"derived",type:"string",list:["Yes","No"],animate:!0}},ED.AngleGradeSouth.prototype.setParameterDefaults=function(){this.arc=90*Math.PI/180,this.apexY=-riri,this.rotation=Math.PI,this.setParameterFromString("grade","4"),this.setParameterFromString("seen","Yes")},ED.AngleGradeSouth.prototype.dependentParameterValues=function(t,e){var a=[];switch(t){case"apexY":var r="4";-e>=riro&&(r="3"),-e>=rcbo&&(r="2"),-e>=rtmo&&(r="1"),-e>=rsli&&(r="0"),a.grade=r,a.seen=-e>=rtmo?"No":"Yes";break;case"grade":var r="";switch(e){case"0":r=-this.apexY>=rsli?this.apexY:-rsli;break;case"1":r=-this.apexY>=rtmo&&rsli>-this.apexY?this.apexY:-rtmo;break;case"2":r=-this.apexY>=rcbo&&rtmo>-this.apexY?this.apexY:-360;break;case"3":r=-this.apexY>=riro&&rcbo>-this.apexY?this.apexY:-230;break;case"4":r=-this.apexY>=riri&&riro>-this.apexY?this.apexY:-riri}a.apexY=r;break;case"seen":var r="";switch(e){case"No":r=-this.apexY>=rtmo?this.apexY:-rtmo;break;case"Yes":r=rtmo>-this.apexY?this.apexY:-riri}a.apexY=r}return a},ED.AngleGradeSouth.prototype.draw=function(t){var e=this.drawing.context;ED.AngleGradeSouth.superclass.draw.call(this,t);var a=this.arc/2,r=-Math.PI/2+a,i=-Math.PI/2-a;return e.beginPath(),e.arc(0,0,-this.apexY,r,i,!0),e.arc(0,0,rpu,i,r,!1),e.closePath(),e.fillStyle="rgba(100, 200, 250, 1.0)",e.strokeStyle="rgba(100, 100, 100, 1.0)",e.lineWidth=4,this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AngleGradeWest=function(t,e,a,r,i,o,s,n,l,h,d){this.className="AngleGradeWest",this.grade="4",this.seen="Yes",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.AngleGradeWest.prototype=new ED.Doodle,ED.AngleGradeWest.prototype.constructor=ED.AngleGradeWest,ED.AngleGradeWest.superclass=ED.Doodle.prototype,ED.AngleGradeWest.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.AngleGradeWest.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-rsli,-riri),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["4","3","2","1","0"],animate:!0},this.parameterValidationArray.seen={kind:"derived",type:"string",list:["Yes","No"],animate:!0}},ED.AngleGradeWest.prototype.setParameterDefaults=function(){this.arc=90*Math.PI/180,this.apexY=-riri,this.rotation=3*Math.PI/2,this.setParameterFromString("grade","4"),this.setParameterFromString("seen","Yes")},ED.AngleGradeWest.prototype.dependentParameterValues=function(t,e){var a=[];switch(t){case"apexY":var r="4";-e>=riro&&(r="3"),-e>=rcbo&&(r="2"),-e>=rtmo&&(r="1"),-e>=rsli&&(r="0"),a.grade=r,a.seen=-e>=rtmo?"No":"Yes";break;case"grade":var r="";switch(e){case"0":r=-this.apexY>=rsli?this.apexY:-rsli;break;case"1":r=-this.apexY>=rtmo&&rsli>-this.apexY?this.apexY:-rtmo;break;case"2":r=-this.apexY>=rcbo&&rtmo>-this.apexY?this.apexY:-360;break;case"3":r=-this.apexY>=riro&&rcbo>-this.apexY?this.apexY:-230;break;case"4":r=-this.apexY>=riri&&riro>-this.apexY?this.apexY:-riri}a.apexY=r;break;case"seen":var r="";switch(e){case"No":r=-this.apexY>=rtmo?this.apexY:-rtmo;break;case"Yes":r=rtmo>-this.apexY?this.apexY:-riri}a.apexY=r}return a},ED.AngleGradeWest.prototype.draw=function(t){var e=this.drawing.context;ED.AngleGradeWest.superclass.draw.call(this,t);var a=this.arc/2,r=-Math.PI/2+a,i=-Math.PI/2-a;return e.beginPath(),e.arc(0,0,-this.apexY,r,i,!0),e.arc(0,0,rpu,i,r,!1),e.closePath(),e.fillStyle="rgba(100, 200, 250, 1.0)",e.strokeStyle="rgba(100, 100, 100, 1.0)",e.lineWidth=4,this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AngleNV=function(t,e,a,r,i,o,s,n,l,h,d){this.className="AngleNV",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.AngleNV.prototype=new ED.Doodle,ED.AngleNV.prototype.constructor=ED.AngleNV,ED.AngleNV.superclass=ED.Doodle.prototype,ED.AngleNV.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1)},ED.AngleNV.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(50,250)},ED.AngleNV.prototype.setParameterDefaults=function(){this.arc=30*Math.PI/180},ED.AngleNV.prototype.draw=function(t){var e=this.drawing.context;ED.AngleNV.superclass.draw.call(this,t);var a=rtmo,r=rtmi,i=r+(a-r)/2,o=this.arc/2,s=-Math.PI/2+o,n=-Math.PI/2-o,l=i*Math.sin(o),h=-i*Math.cos(o),d=-i*Math.sin(o),c=h;e.beginPath(),e.arc(0,0,r,s,n,!0),e.arc(0,0,a,n,s,!1),e.closePath();var p=e.createPattern(this.drawing.imageArray.NewVesselPattern,"repeat");return e.fillStyle=p,e.strokeStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(d,c)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(l,h)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AngleNV.prototype.groupDescription=function(){var t=this.drawing.totalDegreesExtent(this.className);return"Angle new vessels over "+(""+t)+" degrees"},ED.AntSynech=function(t,e,a,r,i,o,s,n,l,h,d){this.className="AntSynech",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.AntSynech.prototype=new ED.Doodle,ED.AntSynech.prototype.constructor=ED.AntSynech,ED.AntSynech.superclass=ED.Doodle.prototype,ED.AntSynech.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)
},ED.AntSynech.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-rsli,-rcbo),this.parameterValidationArray.arc.range.setMinAndMax(30*Math.PI/180,2*Math.PI)},ED.AntSynech.prototype.setParameterDefaults=function(){this.arc=30*Math.PI/180,this.apexY=-rtmi},ED.AntSynech.prototype.draw=function(t){var e=this.drawing.context;ED.AntSynech.superclass.draw.call(this,t);var a=-this.apexY,r=riri,i=this.arc/2,o=-Math.PI/2+i,s=-Math.PI/2-i,n=-Math.PI/2+i-Math.PI/14,l=-Math.PI/2-i+Math.PI/14,h=r*Math.sin(i),d=-r*Math.cos(i),c=-r*Math.sin(i),p=d;return e.beginPath(),e.arc(0,0,r,o,s,!0),e.arc(0,0,a,l,n,!1),e.closePath(),e.fillStyle="rgba(100, 200, 250, 1.0)",e.strokeStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(c,p)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(h,d)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(0,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AntSynech.prototype.groupDescription=function(){var t=this.drawing.totalDegreesExtent(this.className);return"Anterior synechiae over "+(""+t)+" degrees"},ED.AngleRecession=function(t,e,a,r,i,o,s,n,l,h,d){ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d),this.className="AngleRecession"},ED.AngleRecession.prototype=new ED.Doodle,ED.AngleRecession.prototype.constructor=ED.AngleRecession,ED.AngleRecession.superclass=ED.Doodle.prototype,ED.AngleRecession.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1)},ED.AngleRecession.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(50,250)},ED.AngleRecession.prototype.setParameterDefaults=function(){this.arc=30*Math.PI/180},ED.AngleRecession.prototype.draw=function(t){var e=this.drawing.context;ED.AngleRecession.superclass.draw.call(this,t);var a=riri-30,r=riri,i=this.arc/2,o=-Math.PI/2+i,s=-Math.PI/2-i,n=-Math.PI/2+i-Math.PI/24,l=-Math.PI/2-i+Math.PI/24,h=r*Math.sin(i),d=-r*Math.cos(i),c=-r*Math.sin(i),p=d;return e.beginPath(),e.arc(0,0,r,o,s,!0),e.arc(0,0,a,l,n,!1),e.closePath(),e.fillStyle="rgba(255, 255, 200, 1.0)",e.strokeStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(c,p)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(h,d)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AngleRecession.prototype.groupDescription=function(){var t=this.drawing.totalDegreesExtent(this.className);return"Angle recession over "+(""+t)+" degrees"},ED.OpticDisc=function(t,e,a,r,i,o,s,n,l,h,d){this.className="OpticDisc",this.numberOfHandles=8,this.mode="Basic",this.cdRatio="0",this.savedParams=["mode"],ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.OpticDisc.prototype=new ED.Doodle,ED.OpticDisc.prototype.constructor=ED.OpticDisc,ED.OpticDisc.superclass=ED.Doodle.prototype,ED.OpticDisc.prototype.setHandles=function(){for(var t=0;this.numberOfHandles>t;t++)this.handleArray[t]=new ED.Handle(null,!0,ED.Mode.Handles,!1);this.handleArray[this.numberOfHandles]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.OpticDisc.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isDeletable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-320,-20),this.parameterValidationArray.radius.range.setMinAndMax(50,290),this.parameterValidationArray.mode={kind:"derived",type:"string",list:["Basic","Expert"],animate:!1},this.parameterValidationArray.cdRatio={kind:"derived",type:"string",list:["0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9","1.0","No view"],animate:!0},this.handleVectorRangeArray=[];for(var t=0;this.numberOfHandles>t;t++){var e=2*Math.PI,a={};a.length=new ED.Range(50,290),a.angle=new ED.Range((15*e/16+t*e/8)%e,(1*e/16+t*e/8)%e),this.handleVectorRangeArray[t]=a}},ED.OpticDisc.prototype.setParameterDefaults=function(){this.apexY=-150,this.setParameterFromString("mode","Basic"),this.setParameterFromString("cdRatio","0.5");var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t);for(var e=0;this.numberOfHandles>e;e++){var a=new ED.Point(0,0);a.setWithPolars(-this.apexY,2*e*Math.PI/this.numberOfHandles),this.addPointToSquiggle(a)}},ED.OpticDisc.prototype.dependentParameterValues=function(t,e){var a=[];switch(t){case"mode":break;case"apexY":a.cdRatio=-300>e?"No view":(-e/300).toFixed(1);break;case"cdRatio":if("No view"!=e){var r=300*parseFloat(e);if(a.apexY=-r,"Expert"==this.mode){var i=0,o=this.numberOfHandles/2,s=(this.squiggleArray[0].pointsArray[i].length()+this.squiggleArray[0].pointsArray[o].length())/2;this.squiggleArray[0].pointsArray[i].setWithPolars(r,this.squiggleArray[0].pointsArray[i].direction()),this.squiggleArray[0].pointsArray[o].setWithPolars(r,this.squiggleArray[0].pointsArray[o].direction());for(var n=0;this.numberOfHandles>n;n++)if(n!=i&&n!=o){var l=this.squiggleArray[0].pointsArray[n].length()*r/s;l=l>300?300:l,this.squiggleArray[0].pointsArray[n].setWithPolars(l,this.squiggleArray[0].pointsArray[n].direction())}}}else a.apexY=-320;break;case"handles":var h=0;h+=this.squiggleArray[0].pointsArray[0].length(),h+=this.squiggleArray[0].pointsArray[this.numberOfHandles/2].length(),a.apexY=-Math.round(h/2);var d=Math.round(10*h/600)/10;a.cdRatio=d.toFixed(1)}return a},ED.OpticDisc.prototype.draw=function(t){var e=this.drawing.context;ED.OpticDisc.superclass.draw.call(this,t);var a=300,r=-this.apexY,i=0,o=2*Math.PI;e.beginPath(),e.arc(0,0,a,i,o,!0),e.closePath(),e.lineWidth=2;var s=e.createPattern(this.drawing.imageArray.CribriformPattern,"repeat");if(e.fillStyle=s,e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(e.beginPath(),e.arc(0,0,a,i,o,!0),"Basic"==this.mode)e.moveTo(r,0),e.arc(0,0,r,o,i,!1);else{var n,l,h,d,c=2*Math.PI/(3*this.numberOfHandles);e.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(var p=0;this.numberOfHandles>p;p++){n=this.squiggleArray[0].pointsArray[p];var D=this.numberOfHandles-1>p?p+1:0;l=this.squiggleArray[0].pointsArray[D],h=n.tangentialControlPoint(+c),d=l.tangentialControlPoint(-c),e.bezierCurveTo(h.x,h.y,d.x,d.y,l.x,l.y)}}e.closePath();var u=new ED.Colour(0,0,0,1);u.setWithHexString("FFA83C"),e.fillStyle=u.rgba(),e.fill(),e.beginPath();var y;y=this.drawing.eye==ED.eye.Right?-1:1;var g=new ED.Point(0,0);g.setWithPolars(150,-y*Math.PI/2);var E=new ED.Point(0,0);E.setWithPolars(400,-y*Math.PI/8);var f=new ED.Point(0,0);f.setWithPolars(450,y*Math.PI/8);var m=new ED.Point(0,0);m.setWithPolars(500,y*Math.PI/4),e.moveTo(g.x,g.y),e.bezierCurveTo(E.x,E.y,f.x,f.y,m.x,m.y);var g=new ED.Point(0,0);g.setWithPolars(150,-y*Math.PI/2);var E=new ED.Point(0,0);E.setWithPolars(400,7*-y*Math.PI/8);var f=new ED.Point(0,0);f.setWithPolars(450,7*y*Math.PI/8);var m=new ED.Point(0,0);m.setWithPolars(500,3*y*Math.PI/4),e.moveTo(g.x,g.y),e.bezierCurveTo(E.x,E.y,f.x,f.y,m.x,m.y);var g=new ED.Point(0,0);g.setWithPolars(150,-y*Math.PI/2);var E=new ED.Point(0,0);E.setWithPolars(300,2*-y*Math.PI/8);var f=new ED.Point(0,0);f.setWithPolars(350,5*-y*Math.PI/16);var m=new ED.Point(0,0);m.setWithPolars(450,3*-y*Math.PI/8),e.moveTo(g.x,g.y),e.bezierCurveTo(E.x,E.y,f.x,f.y,m.x,m.y);var g=new ED.Point(0,0);g.setWithPolars(150,-y*Math.PI/2);var E=new ED.Point(0,0);E.setWithPolars(300,6*-y*Math.PI/8);var f=new ED.Point(0,0);f.setWithPolars(350,11*-y*Math.PI/16);var m=new ED.Point(0,0);m.setWithPolars(450,5*-y*Math.PI/8),e.moveTo(g.x,g.y),e.bezierCurveTo(E.x,E.y,f.x,f.y,m.x,m.y),e.lineWidth=48,e.lineCap="round",e.strokeStyle="rgba(255, 0, 0, 0.5)",e.stroke(),"No view"==this.cdRatio&&(e.beginPath(),e.arc(0,0,400,0,2*Math.PI,!0),e.closePath(),e.fillStyle="gray",e.fill())}if("Expert"==this.mode)for(var p=0;this.numberOfHandles>p;p++)this.handleArray[p].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[p]);return this.handleArray[this.numberOfHandles].location=this.transform.transformPoint(new ED.Point(0,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.OpticDisc.prototype.description=function(){var t="";if("Expert"==this.mode){for(var e,a=this.getMeanRadius(),r=[],i=!1,o=0,s=0;this.numberOfHandles>s;s++)if(1.1*a>this.squiggleArray[0].pointsArray[s].length()){o=s;break}for(var s=0;this.numberOfHandles>s;s++){var n=(s+o)%this.numberOfHandles;this.squiggleArray[0].pointsArray[n].length()>1.1*a?i?e.endHour=this.squiggleArray[0].pointsArray[n].clockHour():(e={},e.startHour=this.squiggleArray[0].pointsArray[n].clockHour(),e.endHour=this.squiggleArray[0].pointsArray[n].clockHour(),i=!0):i&&(r.push(e),i=!1),s==this.numberOfHandles-1&&i&&(e.endHour=this.squiggleArray[0].pointsArray[n].clockHour(),r.push(e),i=!1)}if(r.length>0){var l=r.length>1;t=l?"Notches":"Notch";for(var s=0;r.length>s;s++)t+=r[s].startHour==r[s].endHour?" at "+r[s].startHour:" from "+r[s].startHour+" to "+r[s].endHour+" o'clock",l&&s!=r.length-1&&(t+=", and")}else t=1==this.drawing.doodleArray.length?"No abnormality":""}else t=1==this.drawing.doodleArray.length?"No abnormality":"";return t},ED.OpticDisc.prototype.setHandleProperties=function(){if("Basic"==this.mode){for(var t=0;this.numberOfHandles>t;t++)this.handleArray[t].isVisible=!1;this.handleArray[this.numberOfHandles].isVisible=!0,this.apexY=-this.getMeanRadius()}else{for(var t=0;this.numberOfHandles>t;t++)this.handleArray[t].isVisible=!0;this.handleArray[this.numberOfHandles].isVisible=!1,this.setMeanRadius(-this.apexY)}},ED.OpticDisc.prototype.minimumRadius=function(){var t=500;if("Basic"==this.mode)t=Math.abs(this.apexY);else for(var e=0;this.numberOfHandles>e;e++){var a=this.squiggleArray[0].pointsArray[e].length();t>a&&(t=a)}return t},ED.OpticDisc.prototype.getMeanRadius=function(){if(this.squiggleArray[0]!==void 0){for(var t=0,e=0;this.numberOfHandles>e;e++)t+=this.squiggleArray[0].pointsArray[e].length();return t/this.numberOfHandles}return-this.apexY},ED.OpticDisc.prototype.setMeanRadius=function(t){for(var e=this.getMeanRadius(),a=0;this.numberOfHandles>a;a++){var r=this.squiggleArray[0].pointsArray[a].length(),i=this.squiggleArray[0].pointsArray[a].direction(),o=r*t/e;o=o>300?300:o,this.squiggleArray[0].pointsArray[a].setWithPolars(o,i)}},ED.PeripapillaryAtrophy=function(t,e,a,r,i,o,s,n,l,h,d){this.className="PeripapillaryAtrophy",this.outerRadius=340,ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.PeripapillaryAtrophy.prototype=new ED.Doodle,ED.PeripapillaryAtrophy.prototype.constructor=ED.PeripapillaryAtrophy,ED.PeripapillaryAtrophy.superclass=ED.Doodle.prototype,ED.PeripapillaryAtrophy.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Handles,!1),this.handleArray[1]=new ED.Handle(null,!0,ED.Mode.Handles,!1),this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Handles,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Handles,!1)},ED.PeripapillaryAtrophy.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.addAtBack=!0,this.isUnique=!0,this.parameterValidationArray.rotation.range.setMinAndMax(7*Math.PI/4,Math.PI/4),this.handleCoordinateRangeArray=[];var t=1.4*this.outerRadius,e=this.outerRadius;this.handleCoordinateRangeArray[0]={x:new ED.Range(-t,-e),y:new ED.Range(-0,0)},this.handleCoordinateRangeArray[1]={x:new ED.Range(-0,0),y:new ED.Range(-t,-e)},this.handleCoordinateRangeArray[2]={x:new ED.Range(e,t),y:new ED.Range(-0,0)},this.handleCoordinateRangeArray[3]={x:new ED.Range(-0,0),y:new ED.Range(e,t)}},ED.PeripapillaryAtrophy.prototype.setParameterDefaults=function(){var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t),this.addPointToSquiggle(new ED.Point(-this.outerRadius-(this.drawing.eye==ED.eye.Right?100:0),0)),this.addPointToSquiggle(new ED.Point(0,-this.outerRadius)),this.addPointToSquiggle(new ED.Point(this.outerRadius+(this.drawing.eye==ED.eye.Right?0:100),0)),this.addPointToSquiggle(new ED.Point(0,this.outerRadius))},ED.PeripapillaryAtrophy.prototype.draw=function(t){var e=this.drawing.context;ED.PeripapillaryAtrophy.superclass.draw.call(this,t),e.beginPath();var a,r,i,o,s=.55;a=this.squiggleArray[0].pointsArray[0].x,r=this.squiggleArray[0].pointsArray[0].y,i=this.squiggleArray[0].pointsArray[1].x,o=this.squiggleArray[0].pointsArray[1].y,e.moveTo(a,r),e.bezierCurveTo(a,a*s,o*s,o,i,o),a=i,r=o,i=this.squiggleArray[0].pointsArray[2].x,o=this.squiggleArray[0].pointsArray[2].y,e.bezierCurveTo(-r*s,r,i,-i*s,i,o),a=i,r=o,i=this.squiggleArray[0].pointsArray[3].x,o=this.squiggleArray[0].pointsArray[3].y,e.bezierCurveTo(a,a*s,o*s,o,i,o),a=i,r=o,i=this.squiggleArray[0].pointsArray[0].x,o=this.squiggleArray[0].pointsArray[0].y,e.bezierCurveTo(-r*s,r,i,-i*s,i,o),e.moveTo(280,0),e.arc(0,0,280,0,2*Math.PI,!0),e.closePath(),e.lineWidth=2;var n=new ED.Colour(0,0,0,1);return n.setWithHexString("DFD989"),e.fillStyle=n.rgba(),e.strokeStyle="gray",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[0]),this.handleArray[1].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[1]),this.handleArray[2].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[2]),this.handleArray[3].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[3]),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PeripapillaryAtrophy.prototype.description=function(){var t="",e=-this.squiggleArray[0].pointsArray[0].x,a=-this.squiggleArray[0].pointsArray[1].y,r=this.squiggleArray[0].pointsArray[2].x,i=this.squiggleArray[0].pointsArray[3].y,o="",s=this.radius;if(e>s&&(s=e,o=this.drawing.eye==ED.eye.Right?"temporally":"nasally"),a>s&&(s=a,o="superiorly"),r>s&&(s=r,o=this.drawing.eye==ED.eye.Right?"nasally":"temporally"),i>s&&(s=i,o="inferiorly"),s>this.radius){var n="Mild";s>350&&(n="Moderate"),s>400&&(n="Signficant"),t+=n,t+=" peri-papillary atrophy, maximum ",t+=o}return t},ED.NerveFibreDefect=function(t,e,a,r,i,o,s,n,l,h,d){this.className="NerveFibreDefect",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.NerveFibreDefect.prototype=new ED.Doodle,ED.NerveFibreDefect.prototype.constructor=ED.NerveFibreDefect,ED.NerveFibreDefect.superclass=ED.Doodle.prototype,ED.NerveFibreDefect.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.NerveFibreDefect.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-560,-400)},ED.NerveFibreDefect.prototype.setParameterDefaults=function(){this.arc=20*Math.PI/180,this.apexY=-460,this.setRotationWithDisplacements(150,-120)},ED.NerveFibreDefect.prototype.draw=function(t){var e=this.drawing.context;ED.NerveFibreDefect.superclass.draw.call(this,t);var a=-this.apexY,r=360,i=r+(a-r)/2,o=this.arc/2,s=-Math.PI/2+o,n=-Math.PI/2-o,l=i*Math.sin(o),h=-i*Math.cos(o),d=-i*Math.sin(o),c=h;return e.beginPath(),e.arc(0,0,a,s,n,!0),e.arc(0,0,r,n,s,!1),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(200, 200, 200, 0.75)",e.strokeStyle="gray",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(d,c)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.NerveFibreDefect.prototype.groupDescription=function(){return"Nerve fibre layer defect at "},ED.NerveFibreDefect.prototype.description=function(){return this.clockHour()+" o'clock"},ED.DiscHaemorrhage=function(t,e,a,r,i,o,s,n,l,h,d){this.className="DiscHaemorrhage",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.DiscHaemorrhage.prototype=new ED.Doodle,ED.DiscHaemorrhage.prototype.constructor=ED.DiscHaemorrhage,ED.DiscHaemorrhage.superclass=ED.Doodle.prototype,ED.DiscHaemorrhage.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-490,-400)},ED.DiscHaemorrhage.prototype.setParameterDefaults=function(){this.arc=10*Math.PI/180,this.apexY=-350,this.setRotationWithDisplacements(150,-120)},ED.DiscHaemorrhage.prototype.draw=function(t){var e=this.drawing.context;ED.DiscHaemorrhage.superclass.draw.call(this,t);var a=-this.apexY,r=250,i=r+(a-r)/2,o=this.arc/2,s=-Math.PI/2+o,n=-Math.PI/2-o;return i*Math.sin(o),-i*Math.cos(o),-i*Math.sin(o),e.beginPath(),e.arc(0,0,a,s,n,!0),e.arc(0,0,r,n,s,!1),e.closePath(),e.lineWidth=4,e.fillStyle="red",e.strokeStyle="red",this.drawBoundary(t),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.DiscHaemorrhage.prototype.groupDescription=function(){return"Disc haemorrhage at "},ED.DiscHaemorrhage.prototype.description=function(){return this.clockHour()+" o'clock"},ED.OpticDiscPit=function(t,e,a,r,i,o,s,n,l,h,d){this.className="OpticDiscPit",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.OpticDiscPit.prototype=new ED.Doodle,ED.OpticDiscPit.prototype.constructor=ED.OpticDiscPit,ED.OpticDiscPit.superclass=ED.Doodle.prototype,ED.OpticDiscPit.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.OpticDiscPit.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.isUnique=!0,this.parameterValidationArray.originX.range.setMinAndMax(-150,150),this.parameterValidationArray.originY.range.setMinAndMax(-150,150),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,3),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,3)},ED.OpticDiscPit.prototype.setParameterDefaults=function(){this.originY=130,this.apexY=0,this.scaleX=1.5,this.originX=this.drawing.eye==ED.eye.Right?-50:50},ED.OpticDiscPit.prototype.draw=function(t){var e=this.drawing.context;ED.OpticDiscPit.superclass.draw.call(this,t),e.beginPath();var a=80;e.arc(0,0,a,0,2*Math.PI,!0),e.closePath();var r="rgba(200, 200, 200, 0.75)",i="rgba(100, 100, 100, 0.75)",o=e.createRadialGradient(0,0,a,0,0,10);return o.addColorStop(0,i),o.addColorStop(1,r),e.fillStyle=o,e.lineWidth=2,e.strokeStyle="gray",this.drawBoundary(t),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(55,-55)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.OpticDiscPit.prototype.description=function(){return"Acquired pit of optic nerve"},ED.DiscPallor=function(t,e,a,r,i,o,s,n,l,h,d){this.className="DiscPallor",this.grade="Sectorial",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.DiscPallor.prototype=new ED.Doodle,ED.DiscPallor.prototype.constructor=ED.DiscPallor,ED.DiscPallor.superclass=ED.Doodle.prototype,ED.DiscPallor.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1)},ED.DiscPallor.prototype.setPropertyDefaults=function(){this.isArcSymmetrical=!0,this.isMoveable=!1,this.parameterValidationArray.grade={kind:"derived",type:"string",list:["Sectorial","Diffuse"],animate:!0},this.parameterValidationArray.arc.delta=.2},ED.DiscPallor.prototype.setParameterDefaults=function(){this.arc=60*Math.PI/180,this.setRotationWithDisplacements(45,-120),this.setParameterFromString("grade","Sectorial")},ED.DiscPallor.prototype.dependentParameterValues=function(t,e){var a=[];switch(t){case"arc":a.grade=2*Math.PI>e?"Sectorial":"Diffuse";break;case"grade":switch(e){case"Sectorial":a.arc=this.arc<2*Math.PI?this.arc:Math.PI/2;break;case"Diffuse":a.arc=2*Math.PI}}return a},ED.DiscPallor.prototype.draw=function(t){var e=this.drawing.context;ED.DiscPallor.superclass.draw.call(this,t);var a=300,r=this.drawing.firstDoodleOfClass("OpticDisc");if(r)var i=r.minimumRadius();else var i=150;var o=i+(a-i)/2,s=this.arc/2,n=-Math.PI/2+s,l=-Math.PI/2-s,h=o*Math.sin(s),d=-o*Math.cos(s),c=-o*Math.sin(s),p=d;return e.beginPath(),e.arc(0,0,a,n,l,!0),e.arc(0,0,i,l,n,!1),e.closePath(),e.lineWidth=1,e.fillStyle="rgba(255,255,255,0.5)",e.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(c,p)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(h,d)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.DiscPallor.prototype.groupDescription=function(){return"Diffuse"==this.grade?"Diffuse disc pallor":"Disc pallor at "},ED.DiscPallor.prototype.description=function(){return"Diffuse"==this.grade?"":this.clockHour()+" o'clock"},ED.Papilloedema=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Papilloedema",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Papilloedema.prototype=new ED.Doodle,ED.Papilloedema.prototype.constructor=ED.Papilloedema,ED.Papilloedema.superclass=ED.Doodle.prototype,ED.Papilloedema.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.addAtBack=!0},ED.Papilloedema.prototype.setParameterDefaults=function(){this.radius=375},ED.Papilloedema.prototype.draw=function(t){var e=this.drawing.context;ED.Papilloedema.superclass.draw.call(this,t);var a=this.radius+75,r=this.radius-75,i=this.arc/2;-Math.PI/2+i,-Math.PI/2-i,e.beginPath(),e.arc(0,0,a,0,2*Math.PI,!0),e.arc(0,0,r,2*Math.PI,0,!1),e.closePath(),e.lineWidth=0,yellowColour="rgba(255, 255, 0, 0.75)";var o="rgba(240, 140, 40, 0.75)",s=e.createRadialGradient(0,0,this.radius+75,0,0,this.radius-75);return s.addColorStop(0,yellowColour),s.addColorStop(1,o),e.fillStyle=s,e.strokeStyle="rgba(0,0,0,0)",this.drawBoundary(t),this.isClicked},ED.Papilloedema.prototype.description=function(){return"Papilloedema"},ED.TransilluminationDefect=function(t,e,a,r,i,o,s,n,l,h,d){this.className="TransilluminationDefect",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.TransilluminationDefect.prototype=new ED.Doodle,ED.TransilluminationDefect.prototype.constructor=ED.TransilluminationDefect,ED.TransilluminationDefect.superclass=ED.Doodle.prototype,ED.TransilluminationDefect.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1)},ED.TransilluminationDefect.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/8,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-400,-100)},ED.TransilluminationDefect.prototype.setParameterDefaults=function(){this.arc=360*Math.PI/180;var t=this.drawing.lastDoodleOfClass(this.className);this.rotation=t?t.rotation+(this.drawing.eye==ED.eye.Right?-1:1)*(t.arc/2+this.arc/2+Math.PI/12):(this.drawing.eye==ED.eye.Right?-1:1)*this.arc/2},ED.TransilluminationDefect.prototype.draw=function(t){var e=this.drawing.context;ED.TransilluminationDefect.superclass.draw.call(this,t);var a=380,r=280,i=r+(a-r)/2,o=this.arc/2,s=-Math.PI/2+o,n=-Math.PI/2-o,l=i*Math.sin(o),h=-i*Math.cos(o),d=-i*Math.sin(o),c=h;if(e.beginPath(),e.arc(0,0,a,s,n,!0),e.arc(0,0,r,n,s,!1),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255,255,255,0)",e.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var p=30,D=Math.PI/8,u=-Math.PI/2-s+D/2;this.arc-Math.PI/2-s>u;u+=D){var y=new ED.Point(0,0);y.setWithPolars(i,u),this.drawCircle(e,y.x,y.y,p,"rgba(255,255,255,1)",4,"rgba(255,255,255,1)")}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(d,c)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(l,h)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.TransilluminationDefect.prototype.description=function(){return"Transillumination defects of iris"},ED.KrukenbergSpindle=function(t,e,a,r,i,o,s,n,l,h,d){this.className="KrukenbergSpindle",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.KrukenbergSpindle.prototype=new ED.Doodle,ED.KrukenbergSpindle.prototype.constructor=ED.KrukenbergSpindle,ED.KrukenbergSpindle.superclass=ED.Doodle.prototype,ED.KrukenbergSpindle.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.KrukenbergSpindle.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.3,.6),this.parameterValidationArray.scaleY.range.setMinAndMax(1,3)},ED.KrukenbergSpindle.prototype.setParameterDefaults=function(){this.originY=100,this.scaleX=.5,this.scaleY=2},ED.KrukenbergSpindle.prototype.draw=function(t){var e=this.drawing.context;ED.KrukenbergSpindle.superclass.draw.call(this,t),e.beginPath();var a=100;e.arc(0,0,a,0,2*Math.PI,!1),e.closePath(),e.fillStyle="rgba(255,128,0,0.5)",e.strokeStyle="rgba(255,128,0,0.5)",this.drawBoundary(t);var r=new ED.Point(0,0);return r.setWithPolars(a,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(r),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.KrukenbergSpindle.prototype.description=function(){return"Krukenberg spindle"},ED.PosteriorEmbryotoxon=function(t,e,a,r,i,o,s,n,l,h,d){this.className="PosteriorEmbryotoxon",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.PosteriorEmbryotoxon.prototype=new ED.Doodle,ED.PosteriorEmbryotoxon.prototype.constructor=ED.PosteriorEmbryotoxon,ED.PosteriorEmbryotoxon.superclass=ED.Doodle.prototype,ED.PosteriorEmbryotoxon.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0},ED.PosteriorEmbryotoxon.prototype.draw=function(t){var e=this.drawing.context;ED.PosteriorEmbryotoxon.superclass.draw.call(this,t);var a=370,r=340,i=0,o=2*Math.PI;return e.beginPath(),e.arc(0,0,a,i,o,!0),e.arc(0,0,r,o,i,!1),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(255,255,255,0.6)",e.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.isClicked},ED.PosteriorEmbryotoxon.prototype.description=function(){return"Posterior Embryotoxon"},ED.KeraticPrecipitates=function(t,e,a,r,i,o,s,n,l,h,d){this.className="KeraticPrecipitates",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.KeraticPrecipitates.prototype=new ED.Doodle,ED.KeraticPrecipitates.prototype.constructor=ED.KeraticPrecipitates,ED.KeraticPrecipitates.superclass=ED.Doodle.prototype,ED.KeraticPrecipitates.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.KeraticPrecipitates.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,40),this.parameterValidationArray.apexY.range.setMinAndMax(-160,0),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.KeraticPrecipitates.prototype.setParameterDefaults=function(){this.drawing.hasDoodleOfClass("Fundus")&&(this.originX=this.drawing.eye==ED.eye.Right?-100:100,this.scaleX=.5,this.scaleY=.5)},ED.KeraticPrecipitates.prototype.draw=function(t){var e=this.drawing.context;ED.KeraticPrecipitates.superclass.draw.call(this,t),e.beginPath();var a=200;if(e.arc(0,0,a,0,2*Math.PI,!0),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var r="rgba(110, 110, 110, 0.5)",i=10*((this.apexX+20)/20)/this.scaleX,o=new ED.Point(0,0),s=40+Math.abs(Math.floor(this.apexY/2)),n=0;s>n;n++)o.setWithPolars(a*ED.randomArray[n],2*Math.PI*ED.randomArray[n+100]),this.drawSpot(e,o.x,o.y,i,r);return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(.7*a,.7*-a)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.KeraticPrecipitates.prototype.description=function(){return this.apexX>20?"Mutton fat keratic precipitates":"Keratic precipitates"},ED.VisualField=function(t,e,a,r,i,o,s,n,l,h,d){this.className="VisualField",this.numberOfHandles=8,this.blindSpotX=0,ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.VisualField.prototype=new ED.Doodle,ED.VisualField.prototype.constructor=ED.VisualField,ED.VisualField.superclass=ED.Doodle.prototype,ED.VisualField.prototype.setHandles=function(){for(var t=0;this.numberOfHandles>t;t++)this.handleArray[t]=new ED.Handle(null,!0,ED.Mode.Handles,!1);this.handleArray[this.numberOfHandles]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.VisualField.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isDeletable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-320,-20),this.handleVectorRangeArray=[];for(var t=0;this.numberOfHandles>t;t++){var e=2*Math.PI,a={};a.length=new ED.Range(0,400),a.angle=new ED.Range((15*e/16+t*e/8)%e,(1*e/16+t*e/8)%e),this.handleVectorRangeArray[t]=a}},ED.VisualField.prototype.setParameterDefaults=function(){this.apexY=-40;var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t);for(var e=[[0,-370],[300,-260],[400,0],[300,260],[0,370],[-300,260],[-400,0],[-300,-260]],a=0;this.numberOfHandles>a;a++){var r=e[a],i=new ED.Point(r[0],r[1]);this.addPointToSquiggle(i)}this.drawing.eye==ED.eye.Right?(this.squiggleArray[0].pointsArray[3].x=220,this.squiggleArray[0].pointsArray[3].y=170,this.blindSpotX=-120):(this.squiggleArray[0].pointsArray[5].x=-220,this.squiggleArray[0].pointsArray[5].y=170,this.blindSpotX=120)},ED.VisualField.prototype.draw=function(t){var e=this.drawing.context;ED.VisualField.superclass.draw.call(this,t),e.beginPath();var a,r,i,o,s=2*Math.PI/(3*this.numberOfHandles);e.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(var n=0;this.numberOfHandles>n;n++){a=this.squiggleArray[0].pointsArray[n];var l=this.numberOfHandles-1>n?n+1:0;r=this.squiggleArray[0].pointsArray[l],100>a.length()||100>r.length()?e.lineTo(r.x,r.y):(i=a.tangentialControlPoint(+s),o=r.tangentialControlPoint(-s),e.bezierCurveTo(i.x,i.y,o.x,o.y,r.x,r.y))}e.moveTo(this.blindSpotX-this.apexY,0),e.arc(this.blindSpotX,0,-this.apexY,0,2*Math.PI,!0),e.closePath(),e.lineWidth=2,e.fillStyle="lightGray",e.strokeStyle="black",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(0,-450),e.lineTo(0,450),e.moveTo(-450,0),e.lineTo(450,0),e.lineWidth=8,e.strokeStyle="black",e.stroke());for(var n=0;this.numberOfHandles>n;n++)this.handleArray[n].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[n]);return this.handleArray[this.numberOfHandles].location=this.transform.transformPoint(new ED.Point(this.blindSpotX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.VisualField.prototype.description=function(){return""},ED.VisualFieldChart=function(t,e,a,r,i,o,s,n,l,h,d){this.className="VisualFieldChart",this.numberOfHandles=8,this.blindSpotX=0,ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.VisualFieldChart.prototype=new ED.Doodle,ED.VisualFieldChart.prototype.constructor=ED.VisualFieldChart,ED.VisualFieldChart.superclass=ED.Doodle.prototype,ED.VisualFieldChart.prototype.setPropertyDefaults=function(){this.isSelectable=!1
},ED.VisualFieldChart.prototype.setParameterDefaults=function(){var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t);for(var e=[[0,-370],[300,-260],[400,0],[300,260],[0,370],[-300,260],[-400,0],[-300,-260]],a=0;this.numberOfHandles>a;a++){var r=e[a],i=new ED.Point(r[0],r[1]);this.addPointToSquiggle(i)}this.drawing.eye==ED.eye.Right?(this.squiggleArray[0].pointsArray[3].x=220,this.squiggleArray[0].pointsArray[3].y=170,this.blindSpotX=-120):(this.squiggleArray[0].pointsArray[5].x=-220,this.squiggleArray[0].pointsArray[5].y=170,this.blindSpotX=120)},ED.VisualFieldChart.prototype.draw=function(t){var e=this.drawing.context;ED.VisualFieldChart.superclass.draw.call(this,t),e.beginPath();var a,r,i,o,s=2*Math.PI/(3*this.numberOfHandles);e.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(var n=0;this.numberOfHandles>n;n++){a=this.squiggleArray[0].pointsArray[n];var l=this.numberOfHandles-1>n?n+1:0;r=this.squiggleArray[0].pointsArray[l],i=a.tangentialControlPoint(+s),o=r.tangentialControlPoint(-s),e.bezierCurveTo(i.x,i.y,o.x,o.y,r.x,r.y)}return e.closePath(),e.lineWidth=2,e.fillStyle="gray",e.strokeStyle="black",this.drawBoundary(t),this.isClicked},ED.ConjunctivalFlap=function(t,e,a,r,i,o,s,n,l,h,d){this.className="ConjunctivalFlap",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.ConjunctivalFlap.prototype=new ED.Doodle,ED.ConjunctivalFlap.prototype.constructor=ED.ConjunctivalFlap,ED.ConjunctivalFlap.superclass=ED.Doodle.prototype,ED.ConjunctivalFlap.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.ConjunctivalFlap.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isArcSymmetrical=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-480,-100),this.parameterValidationArray.arc.range.setMinAndMax(60*Math.PI/180,160*Math.PI/180)},ED.ConjunctivalFlap.prototype.setParameterDefaults=function(){this.arc=120*Math.PI/180,this.apexY=-460},ED.ConjunctivalFlap.prototype.draw=function(t){var e=this.drawing.context;ED.NerveFibreDefect.superclass.draw.call(this,t);var a=280,r=this.arc/2,i=-Math.PI/2+r,o=-Math.PI/2-r;this.arc/6;var s=new ED.Point(this.apexX,this.apexY),n=new ED.Point(a*Math.sin(r),-a*Math.cos(r)),l=new ED.Point(-a*Math.sin(r),-a*Math.cos(r));e.beginPath(),e.arc(0,0,a,i,o,!0);var h=.8;return e.bezierCurveTo(l.x,l.y,h*l.x,s.y,s.x,s.y),e.bezierCurveTo(h*n.x,s.y,n.x,n.y,n.x,n.y),e.fillStyle="rgba(255,255,255,0.5)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(l),this.handleArray[3].location=this.transform.transformPoint(n),this.handleArray[4].location=this.transform.transformPoint(s),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ConjunctivalFlap.prototype.description=function(){return(-280>this.apexY?"Fornix based ":"Limbus based ")+"flap"},ED.PartialThicknessScleralFlap=function(t,e,a,r,i,o,s,n,l,h,d){this.className="PartialThicknessScleralFlap",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.PartialThicknessScleralFlap.prototype=new ED.Doodle,ED.PartialThicknessScleralFlap.prototype.constructor=ED.PartialThicknessScleralFlap,ED.PartialThicknessScleralFlap.superclass=ED.Doodle.prototype,ED.PartialThicknessScleralFlap.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.PartialThicknessScleralFlap.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isArcSymmetrical=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-480,-100),this.parameterValidationArray.arc.range.setMinAndMax(20*Math.PI/180,80*Math.PI/180)},ED.PartialThicknessScleralFlap.prototype.setParameterDefaults=function(){this.arc=50*Math.PI/180,this.apexY=-400},ED.PartialThicknessScleralFlap.prototype.draw=function(t){var e=this.drawing.context;ED.NerveFibreDefect.superclass.draw.call(this,t);var a=280,r=this.arc/2,i=-Math.PI/2+r,o=-Math.PI/2-r;this.arc/6;var s=new ED.Point(this.apexX,this.apexY),n=new ED.Point(a*Math.sin(r),-a*Math.cos(r)),l=new ED.Point(-a*Math.sin(r),-a*Math.cos(r));if(e.beginPath(),e.arc(0,0,a,i,o,!0),e.lineTo(l.x,this.apexY),e.lineTo(n.x,this.apexY),e.closePath(),e.fillStyle="rgba(220,220,150,0.5)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var h=r/2;i=-Math.PI/2+h,o=-Math.PI/2-h;var d=new ED.Point(this.apexX,-a+(this.apexY+a)/2);e.beginPath(),e.arc(0,0,a,i,o,!0),e.lineTo(-a*Math.sin(h),d.y),e.lineTo(a*Math.sin(h),d.y),e.closePath(),e.fillStyle="gray",e.fill()}return this.handleArray[0].location=this.transform.transformPoint(l),this.handleArray[3].location=this.transform.transformPoint(n),this.handleArray[4].location=this.transform.transformPoint(s),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PartialThicknessScleralFlap.prototype.description=function(){return(-280>this.apexY?"Fornix based ":"Limbus based ")+"flap"},ED.ArcuateScotoma=function(t,e,a,r,i,o,s,n,l,h,d){this.className="ArcuateScotoma",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.ArcuateScotoma.prototype=new ED.Doodle,ED.ArcuateScotoma.prototype.constructor=ED.ArcuateScotoma,ED.ArcuateScotoma.superclass=ED.Doodle.prototype,ED.ArcuateScotoma.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.ArcuateScotoma.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isArcSymmetrical=!0,this.parameterValidationArray.apexX.range.setMinAndMax(140,300),this.parameterValidationArray.apexY.range.setMinAndMax(-0,0)},ED.ArcuateScotoma.prototype.setParameterDefaults=function(){this.arc=60*Math.PI/180,this.apexX=200,this.drawing.eye==ED.eye.Left&&(this.scaleX=-1*this.scaleX);var t=this.drawing.lastDoodleOfClass(this.className);t&&(this.scaleY=-1*t.scaleY)},ED.ArcuateScotoma.prototype.draw=function(t){var e=this.drawing.context;ED.ArcuateScotoma.superclass.draw.call(this,t);var a=-100,r=100,i=-140,o=(r-a)/2,s=a+o;return e.beginPath(),e.arc(s,0,o,-Math.PI,0,!1),e.lineTo(this.apexX,0),o=(this.apexX-i)/2,s=i+o,e.arc(s,0,o,0,-Math.PI,!0),e.closePath(),e.lineWidth=6,e.fillStyle="gray",e.strokeStyle="black",this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ArcuateScotoma.prototype.description=function(){return this.scaleY>0?"Superior":"Inferior arcuate scotoma"},null==ED||"object"!=typeof ED)var ED={};if(ED.PostPole=function(t,e,a,r,i,o,s,n,l,h,d){this.className="PostPole",this.discRadius=84,this.cdRatio="0",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.PostPole.prototype=new ED.Doodle,ED.PostPole.prototype.constructor=ED.PostPole,ED.PostPole.superclass=ED.Doodle.prototype,ED.PostPole.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.PostPole.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0;var t=this.drawing.eye==ED.eye.Right?300:-300;this.parameterValidationArray.apexX.range.setMinAndMax(t,t),this.parameterValidationArray.apexY.range.setMinAndMax(-80,-8),this.parameterValidationArray.cdRatio={kind:"derived",type:"float",range:new ED.Range(0,1),precision:1,animate:!0},this.parameterValidationArray.apexY.delta=5},ED.PostPole.prototype.setParameterDefaults=function(){this.setParameterFromString("cdRatio","0.5"),this.apexX=this.drawing.eye==ED.eye.Right?300:-300},ED.PostPole.prototype.dependentParameterValues=function(t,e){var a=[];switch(t){case"apexY":a.cdRatio=-e/80;break;case"cdRatio":a.apexY=-(80*+e)}return a},ED.PostPole.prototype.draw=function(t){var e=this.drawing.context;ED.PostPole.superclass.draw.call(this,t);var a=this.drawing.eye==ED.eye.Right?300:-300;if(e.beginPath(),e.arc(a,0,this.discRadius,0,2*Math.PI,!0),e.lineWidth=4,e.strokeStyle="rgba(249,187,76,1)",e.fillStyle="rgba(249,187,76,1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.arc(a,0,-this.apexY,2*Math.PI,0,!1),e.fillStyle="white";var r=e.createPattern(this.drawing.imageArray.CribriformPatternSmall,"repeat");e.fillStyle=r,e.lineWidth=4,e.fill(),e.stroke(),e.beginPath();var i=this.drawing.eye==ED.eye.Right?1:-1,o=-300*i,s=-50*i,n=300*i,l=300*i,h=300*i,d=350*i,c=400*i,p=0;e.moveTo(o,-100),e.bezierCurveTo(s,-500,n,-200,l,-24),e.bezierCurveTo(h,-80,d,-140,c,-160),e.moveTo(c,160),e.bezierCurveTo(d,140,h,80,l,24),e.bezierCurveTo(n,200,s,500,o,100);var D=10;e.moveTo(p,-D),e.lineTo(p,D),e.moveTo(p-D,0),e.lineTo(p+D,0),e.lineWidth=8,e.lineCap="round",e.strokeStyle="red",e.stroke(),e.beginPath(),e.arc(0,0,2*this.discRadius,2*Math.PI,0,!1),e.lineWidth=1,e.strokeStyle="gray",e.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PostPole.prototype.description=function(){return 1==this.drawing.doodleArray.length?"No abnormality":""},ED.PostPole.prototype.isWithinDiscDiametersOfFovea=function(t,e){return t.originX*t.originX+t.originY*t.originY<4*e*this.discRadius*this.discRadius},ED.PostPole.prototype.isWithinDisc=function(t){var e=t.originX-(this.drawing.eye==ED.eye.Right?300:-300);return e*e+t.originY*t.originY<this.discRadius*this.discRadius},ED.PostPole.prototype.isWithinArcades=function(t){return 9e4>t.originX*t.originX+t.originY*t.originY},ED.Microaneurysm=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Microaneurysm",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Microaneurysm.prototype=new ED.Doodle,ED.Microaneurysm.prototype.constructor=ED.Microaneurysm,ED.Microaneurysm.superclass=ED.Doodle.prototype,ED.Microaneurysm.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(50,30)},ED.Microaneurysm.prototype.draw=function(t){var e=this.drawing.context;ED.Microaneurysm.superclass.draw.call(this,t);var a=14;return e.beginPath(),e.arc(0,0,a,0,2*Math.PI,!0),e.lineWidth=1,e.strokeStyle="red",e.fillStyle="red",this.drawBoundary(t),this.isClicked},ED.Microaneurysm.prototype.groupDescription=function(){return"Microaneurysms"},ED.HardExudate=function(t,e,a,r,i,o,s,n,l,h,d){this.className="HardExudate",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.HardExudate.prototype=new ED.Doodle,ED.HardExudate.prototype.constructor=ED.HardExudate,ED.HardExudate.superclass=ED.Doodle.prototype,ED.HardExudate.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(50,30)},ED.HardExudate.prototype.draw=function(t){var e=this.drawing.context;ED.HardExudate.superclass.draw.call(this,t);var a=14;return e.beginPath(),e.arc(0,0,a,0,2*Math.PI,!0),e.lineWidth=1,e.strokeStyle="rgba(220,220,0,1)",e.fillStyle="rgba(220,220,0,1)",this.drawBoundary(t),this.isClicked},ED.HardExudate.prototype.groupDescription=function(){return"Hard exudates"},ED.CottonWoolSpot=function(t,e,a,r,i,o,s,n,l,h,d){this.className="CottonWoolSpot",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.CottonWoolSpot.prototype=new ED.Doodle,ED.CottonWoolSpot.prototype.constructor=ED.CottonWoolSpot,ED.CottonWoolSpot.superclass=ED.Doodle.prototype,ED.CottonWoolSpot.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.CottonWoolSpot.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.isOrientated=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.CottonWoolSpot.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(-150,150)},ED.CottonWoolSpot.prototype.draw=function(t){var e=this.drawing.context;ED.CottonWoolSpot.superclass.draw.call(this,t);var a=80,r=50,i=r/3;return e.beginPath(),e.moveTo(-a,-r),e.lineTo(-a+i,-r+1*i),e.lineTo(-a,-r+2*i),e.lineTo(-a+i,-r+3*i),e.lineTo(-a,-r+4*i),e.lineTo(-a+i,-r+5*i),e.lineTo(-a,-r+6*i),e.bezierCurveTo(-a+i,-r+7*i,a-i,-r+7*i,a,-r+6*i),e.lineTo(a-i,-r+5*i),e.lineTo(a,-r+4*i),e.lineTo(a-i,-r+3*i),e.lineTo(a,-r+2*i),e.lineTo(a-i,-r+1*i),e.lineTo(a,-r),e.bezierCurveTo(a-i,-r-i,-a+i,-r-i,-a,-r),e.closePath(),e.lineWidth=4,e.strokeStyle="gray",e.fillStyle="rgba(220,220,220,0.5)",this.drawBoundary(t),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(a,-r)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CottonWoolSpot.prototype.groupDescription=function(){return"Cotton wool spots"},ED.PreRetinalHaemorrhage=function(t,e,a,r,i,o,s,n,l,h,d){this.className="PreRetinalHaemorrhage",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.PreRetinalHaemorrhage.prototype=new ED.Doodle,ED.PreRetinalHaemorrhage.prototype.constructor=ED.PreRetinalHaemorrhage,ED.PreRetinalHaemorrhage.superclass=ED.Doodle.prototype,ED.PreRetinalHaemorrhage.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.PreRetinalHaemorrhage.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(50,200),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,2)},ED.PreRetinalHaemorrhage.prototype.setParameterDefaults=function(){this.apexY=200,this.setOriginWithDisplacements(-150,150)},ED.PreRetinalHaemorrhage.prototype.draw=function(t){var e=this.drawing.context;ED.PreRetinalHaemorrhage.superclass.draw.call(this,t);var a=100,r=.6;return e.beginPath(),e.moveTo(a,0),e.lineTo(-a,0),e.bezierCurveTo(-a*r,0,-a*r,this.apexY,0,this.apexY),e.bezierCurveTo(a*r,this.apexY,a*r,0,a,0),e.closePath(),e.lineWidth=1,e.strokeStyle="red",e.fillStyle="red",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[2].location=this.transform.transformPoint(new ED.Point(100,0)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PreRetinalHaemorrhage.prototype.groupDescription=function(){return"Pre-retinal haemorrages"},ED.FibrousProliferation=function(t,e,a,r,i,o,s,n,l,h,d){this.className="FibrousProliferation",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.FibrousProliferation.prototype=new ED.Doodle,ED.FibrousProliferation.prototype.constructor=ED.FibrousProliferation,ED.FibrousProliferation.superclass=ED.Doodle.prototype,ED.FibrousProliferation.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!0)},ED.FibrousProliferation.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,2)},ED.FibrousProliferation.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(-200,150),this.rotation=-Math.PI/4},ED.FibrousProliferation.prototype.draw=function(t){var e=this.drawing.context;ED.FibrousProliferation.superclass.draw.call(this,t);var a=180,r=70,i=.6*a,o=.2*r;return e.beginPath(),e.moveTo(-a,-r),e.bezierCurveTo(-i,-o,i,-o,a,-r),e.bezierCurveTo(i,-o,i,o,a,r),e.bezierCurveTo(i,o,-i,o,-a,r),e.bezierCurveTo(-i,o,-i,-o,-a,-r),e.closePath(),e.lineWidth=1,e.strokeStyle="rgba(120,120,120,0.5)",e.fillStyle="rgba(120,120,120,0.5)",this.drawBoundary(t),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(a,-r)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.FibrousProliferation.prototype.description=function(){return"Fibrous proliferation"},ED.BlotHaemorrhage=function(t,e,a,r,i,o,s,n,l,h,d){this.className="BlotHaemorrhage",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.BlotHaemorrhage.prototype=new ED.Doodle,ED.BlotHaemorrhage.prototype.constructor=ED.BlotHaemorrhage,ED.BlotHaemorrhage.superclass=ED.Doodle.prototype,ED.BlotHaemorrhage.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.BlotHaemorrhage.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(-60,-60)},ED.BlotHaemorrhage.prototype.draw=function(t){var e=this.drawing.context;ED.BlotHaemorrhage.superclass.draw.call(this,t);var a=30;e.beginPath(),e.arc(0,0,a,0,2*Math.PI,!0),e.lineWidth=1,e.strokeStyle="red",e.fillStyle="red",this.drawBoundary(t);var r=new ED.Point(0,0);return r.setWithPolars(a,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(r),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.BlotHaemorrhage.prototype.groupDescription=function(){return"Blot haemorrhages"},ED.DiabeticNV=function(t,e,a,r,i,o,s,n,l,h,d){this.className="DiabeticNV",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.DiabeticNV.prototype=new ED.Doodle,ED.DiabeticNV.prototype.constructor=ED.DiabeticNV,ED.DiabeticNV.superclass=ED.Doodle.prototype,ED.DiabeticNV.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.DiabeticNV.prototype.setPropertyDefaults=function(){},ED.DiabeticNV.prototype.setParameterDefaults=function(){var t=this.drawing.numberOfDoodlesOfClass(this.className);switch(t){case 0:this.originX=this.drawing.eye==ED.eye.Right?300:-300,this.originY=-100;break;case 1:this.originX=this.drawing.eye==ED.eye.Right?-176:176,this.originY=-236;break;case 2:this.originX=this.drawing.eye==ED.eye.Right?-176:176,this.originY=236;break;default:this.setOriginWithDisplacements(0,-100)}},ED.DiabeticNV.prototype.draw=function(t){var e=this.drawing.context;ED.DiabeticNV.superclass.draw.call(this,t),e.beginPath();var a=60,r=a/2,i=0,o=Math.PI/8,s=8,n=new ED.Point(0,0),l=new ED.Point(0,0),h=new ED.Point(0,0),d=new ED.Point(0,0),c=new ED.Point(0,0);e.moveTo(0,0);var p;for(p=0;s>p;p++)i=2*p*Math.PI/s,n.setWithPolars(r,i-o),l.setWithPolars(a,i-o),h.setWithPolars(a,i),d.setWithPolars(a,i+o),c.setWithPolars(r,i+o),e.bezierCurveTo(n.x,n.y,l.x,l.y,h.x,h.y),e.bezierCurveTo(d.x,d.y,c.x,c.y,0,0);return e.fillStyle="rgba(100, 100, 100, 0)",e.lineWidth=3,e.strokeStyle="red",this.drawBoundary(t),point=new ED.Point(0,0),point.setWithPolars(a,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(point),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.DiabeticNV.prototype.groupDescription=function(){return"Diabetic new vessels "},ED.DiabeticNV.prototype.description=function(){return this.locationRelativeToDisc()},ED.DiabeticNV.prototype.snomedCode=function(){return 59276001},ED.Circinate=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Circinate",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Circinate.prototype=new ED.Doodle,ED.Circinate.prototype.constructor=ED.Circinate,ED.Circinate.superclass=ED.Doodle.prototype,ED.Circinate.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.Circinate.prototype.setPropertyDefaults=function(){},ED.Circinate.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(60,100)},ED.Circinate.prototype.draw=function(t){var e=this.drawing.context;ED.Circinate.superclass.draw.call(this,t),e.beginPath();var a=80;if(e.arc(0,0,a,0,2*Math.PI,!1),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(200,200,0,0)",e.strokeStyle="rgba(100,100,100,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var r=40,o=10,s=12,n=30,l=new ED.Point(0,0),h=new ED.Point(0,0);for(e.beginPath(),e.arc(0,0,o,0,2*Math.PI,!1),e.closePath(),e.fillStyle="red",e.fill(),phi=2*Math.PI/s,i=0;s>i;i++)e.beginPath(),l.setWithPolars(r,i*phi),h.setWithPolars(r+n,i*phi),e.moveTo(l.x,l.y),e.lineTo(h.x,h.y),e.closePath(),e.lineWidth=12,e.strokeStyle="rgba(220,220,0,1)",e.lineCap="round",e.stroke()}var d=new ED.Point(0,0);return d.setWithPolars(a,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(d),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Circinate.prototype.groupDescription=function(){return"Circinate maculopathy "},ED.Circinate.prototype.description=function(){return this.locationRelativeToFovea()},ED.CystoidMacularOedema=function(t,e,a,r,i,o,s,n,l,h,d){this.className="CystoidMacularOedema",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.CystoidMacularOedema.prototype=new ED.Doodle,ED.CystoidMacularOedema.prototype.constructor=ED.CystoidMacularOedema,ED.CystoidMacularOedema.superclass=ED.Doodle.prototype,ED.CystoidMacularOedema.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.CystoidMacularOedema.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.CystoidMacularOedema.prototype.setParameterDefaults=function(){},ED.CystoidMacularOedema.prototype.draw=function(t){var e=this.drawing.context;if(ED.CystoidMacularOedema.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,120,0,2*Math.PI,!0),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){for(var a="rgba(255, 255, 138, 0.5)",r="rgba(255, 82, 0, 0.7)",i=new ED.Point(0,0),o=8,s=0;o>s;s++){var n=2*s*Math.PI/o;i.setWithPolars(80,n),this.drawCircle(e,i.x,i.y,40,a,2,r)}this.drawCircle(e,0,0,60,a,2,r)}return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(84,-84)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CystoidMacularOedema.prototype.description=function(){return"Cystoid macular oedema"},ED.CystoidMacularOedema.prototype.snomedCode=function(){return 193387007},ED.CystoidMacularOedema.prototype.diagnosticHierarchy=function(){return 2},ED.HardDrusen=function(t,e,a,r,i,o,s,n,l,h,d){this.className="HardDrusen",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.HardDrusen.prototype=new ED.Doodle,ED.HardDrusen.prototype.constructor=ED.HardDrusen,ED.HardDrusen.superclass=ED.Doodle.prototype,ED.HardDrusen.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.HardDrusen.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-160,0),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.HardDrusen.prototype.setParameterDefaults=function(){this.drawing.hasDoodleOfClass("Fundus")&&(this.originX=this.drawing.eye==ED.eye.Right?-100:100,this.scaleX=.5,this.scaleY=.5)},ED.HardDrusen.prototype.draw=function(t){var e=this.drawing.context;ED.HardDrusen.superclass.draw.call(this,t),e.beginPath();var a=200;if(e.arc(0,0,a,0,2*Math.PI,!0),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var r="yellow",i=10/this.scaleX,o=new ED.Point(0,0),s=20+Math.abs(Math.floor(this.apexY/2)),n=0;s>n;n++)o.setWithPolars(a*ED.randomArray[n],2*Math.PI*ED.randomArray[n+100]),this.drawSpot(e,o.x,o.y,i,r);return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(.7*a,.7*-a)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.HardDrusen.prototype.description=function(){var t="Signficant numbers of ";return this.apexY>-100&&(t="Moderate numbers of "),this.apexY>-50&&(t="Several "),t+"hard drusen"},ED.LaserSpot=function(t,e,a,r,i,o,s,n,l,h,d){this.className="LaserSpot",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.LaserSpot.prototype=new ED.Doodle,ED.LaserSpot.prototype.constructor=ED.LaserSpot,ED.LaserSpot.superclass=ED.Doodle.prototype,ED.LaserSpot.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.LaserSpot.prototype.setPropertyDefaults=function(){this.parameterValidationArray.scaleX.range.setMinAndMax(.5,3),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,3)},ED.LaserSpot.prototype.setParameterDefaults=function(){this.scaleX=.75,this.scaleY=.75,this.setOriginWithDisplacements(100,80)},ED.LaserSpot.prototype.draw=function(t){var e=this.drawing.context;ED.LaserSpot.superclass.draw.call(this,t);var a=30;e.beginPath(),e.arc(0,0,a,0,2*Math.PI,!0),e.closePath(),e.lineWidth=2*a/3,e.fillStyle="yellow",e.strokeStyle="rgba(255, 128, 0, 1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw;var r=new ED.Point(0,0);return r.setWithPolars(a,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(r),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.LaserSpot.prototype.groupDescription=function(){return"Laser spots"},ED.SectorPRPPostPole=function(t,e,a,r,i,o,s,n,l,h,d){this.className="SectorPRPPostPole",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.SectorPRPPostPole.prototype=new ED.Doodle,ED.SectorPRPPostPole.prototype.constructor=ED.SectorPRPPostPole,ED.SectorPRPPostPole.superclass=ED.Doodle.prototype,ED.SectorPRPPostPole.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1)},ED.SectorPRPPostPole.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-400,-100)},ED.SectorPRPPostPole.prototype.setParameterDefaults=function(){this.arc=55*Math.PI/180,this.apexY=-300;var t=this.drawing.lastDoodleOfClass(this.className);this.rotation=t?t.rotation+(this.drawing.eye==ED.eye.Right?-1:1)*(t.arc/2+this.arc/2+Math.PI/12):(this.drawing.eye==ED.eye.Right?-1:1)*this.arc/2},ED.SectorPRPPostPole.prototype.draw=function(t){var e=this.drawing.context;ED.SectorPRPPostPole.superclass.draw.call(this,t);var a=500,r=-this.apexY,i=r+(a-r)/2,o=this.arc/2,s=-Math.PI/2+o,n=-Math.PI/2-o,l=i*Math.sin(o),h=-i*Math.cos(o),d=-i*Math.sin(o),c=h;if(e.beginPath(),e.arc(0,0,a,s,n,!0),e.arc(0,0,r,n,s,!1),e.closePath(),e.lineWidth=40,e.fillStyle="rgba(255,255,255,0)",e.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var p=30,D=30+p,u=[47,41,35,28,22,15],y=0,i=a-p;i>r;i-=D){for(var g=0,E=-Math.PI/2-s;this.arc-Math.PI/2-s>E;E+=D/i){E=-Math.PI/2-s+2*g*Math.PI/u[y];var f=new ED.Point(0,0);f.setWithPolars(i,E),this.drawLaserSpot(e,f.x,f.y),g++}y++}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(d,c)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(l,h)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.SectorPRPPostPole.prototype.description=function(){return"Sector PRP"},ED.PRPPostPole=function(t,e,a,r,i,o,s,n,l,h,d){this.className="PRPPostPole",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.PRPPostPole.prototype=new ED.Doodle,ED.PRPPostPole.prototype.constructor=ED.PRPPostPole,ED.PRPPostPole.superclass=ED.Doodle.prototype,ED.PRPPostPole.prototype.setPropertyDefaults=function(){this.addAtBack=!0,this.isUnique=!0,this.isMoveable=!1,this.isRotatable=!1},ED.PRPPostPole.prototype.draw=function(t){var e=this.drawing.context;ED.PRPPostPole.superclass.draw.call(this,t),e.beginPath(),e.rect(-480,-480,960,960);var a=320;if(e.moveTo(a,0),e.arc(0,0,a,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(255, 255, 255, 1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var r=15,i=30,o=48,s=(1e3-2*o)/(2*r+i),n=2*r+i,l=10,h=0;s>h;h++)for(var d=0;s>d;d++){var c=-500+o+h*n+Math.round(20*(-.5+ED.randomArray[h+d])),p=-500+o+d*n+Math.round(20*(-.5+ED.randomArray[h+d+100]));c*c+p*p>a*a&&(this.drawing.eye==ED.eye.Right?(13!=h||6!=d&&7!=d&&8!=d&&9!=d)&&(14!=h||7!=d&&8!=d)&&this.drawCircle(e,c,p,r,"Yellow",l,"rgba(255, 128, 0, 1)"):(2!=h||6!=d&&7!=d&&8!=d&&9!=d)&&(1!=h||7!=d&&8!=d)&&this.drawCircle(e,c,p,r,"Yellow",l,"rgba(255, 128, 0, 1)"))}return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PRPPostPole.prototype.description=function(){return"Panretinal photocoagulation"},ED.MacularGrid=function(t,e,a,r,i,o,s,n,l,h,d){this.className="MacularGrid",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.MacularGrid.prototype=new ED.Doodle,ED.MacularGrid.prototype.constructor=ED.MacularGrid,ED.MacularGrid.superclass=ED.Doodle.prototype,ED.MacularGrid.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.MacularGrid.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.addAtBack=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-150,-50)},ED.MacularGrid.prototype.setParameterDefaults=function(){this.apexY=-100,this.scaleX=.7,this.scaleY=.7},ED.MacularGrid.prototype.draw=function(t){var e=this.drawing.context;ED.PRPPostPole.superclass.draw.call(this,t);var a=250,r=-this.apexY;if(e.beginPath(),e.arc(0,0,a,0,2*Math.PI,!0),e.arc(0,0,r,2*Math.PI,0,!1),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var i=60;n=Math.floor(2*a/i);for(var o=-n/2*i,s=0;n+1>s;s++)for(var l=0;n+1>l;l++){var h=o+s*i+Math.round(15*(-.5+ED.randomArray[s+l])),d=o+l*i+Math.round(15*(-.5+ED.randomArray[s+l+100])),c=h*h+d*d;c>=r*r&&a*a>=c&&this.drawLaserSpot(e,h,d)}}var p=new ED.Point(0,0);return p.setWithPolars(a,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(p),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.MacularGrid.prototype.description=function(){return"Macular grid laser"},ED.FocalLaser=function(t,e,a,r,i,o,s,n,l,h,d){this.className="FocalLaser",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.FocalLaser.prototype=new ED.Doodle,ED.FocalLaser.prototype.constructor=ED.FocalLaser,ED.FocalLaser.superclass=ED.Doodle.prototype,ED.FocalLaser.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.FocalLaser.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-75,-50),this.parameterValidationArray.radius.range.setMinAndMax(50,75)},ED.FocalLaser.prototype.setParameterDefaults=function(){this.apexY=-50,this.setOriginWithDisplacements(150,80)},ED.FocalLaser.prototype.draw=function(t){var e=this.drawing.context;ED.PRPPostPole.superclass.draw.call(this,t);var a=-this.apexY;if(e.beginPath(),e.arc(0,0,a,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(-75>=this.apexY){var r=50,i=r/Math.sqrt(2);
this.drawLaserSpot(e,0,-r),this.drawLaserSpot(e,i,-i),this.drawLaserSpot(e,r,0),this.drawLaserSpot(e,i,i),this.drawLaserSpot(e,0,r),this.drawLaserSpot(e,-i,i),this.drawLaserSpot(e,-r,0),this.drawLaserSpot(e,-i,-i)}var o=25;this.drawLaserSpot(e,0,-o),this.drawLaserSpot(e,o,0),this.drawLaserSpot(e,0,o),this.drawLaserSpot(e,-o,0),this.drawLaserSpot(e,0,0)}var s=new ED.Point(0,0);return s.setWithPolars(a,Math.PI/4),this.handleArray[4].location=this.transform.transformPoint(s),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.FocalLaser.prototype.groupDescription=function(){return"Focal laser"},ED.Geographic=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Geographic",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Geographic.prototype=new ED.Doodle,ED.Geographic.prototype.constructor=ED.Geographic,ED.Geographic.superclass=ED.Doodle.prototype,ED.Geographic.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Geographic.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-100,0)},ED.Geographic.prototype.setParameterDefaults=function(){this.apexY=-100,this.scaleX=.7,this.scaleY=.7},ED.Geographic.prototype.draw=function(t){var e=this.drawing.context;ED.Geographic.superclass.draw.call(this,t);var a=200,r=-this.apexY,i=-this.apexY*Math.PI/800;e.beginPath();var o=new ED.Point(0,0);return this.drawing.eye==ED.eye.Right?(e.arc(0,0,a,i,2*Math.PI-i,!1),o.setWithPolars(r,Math.PI/2-i),e.lineTo(o.x,o.y),e.arc(0,0,r,2*Math.PI-i,i,!0)):(e.arc(0,0,a,Math.PI-i,-Math.PI+i,!0),o.setWithPolars(r,i-Math.PI/2),e.lineTo(o.x,o.y),e.arc(0,0,r,-Math.PI+i,Math.PI-i,!1)),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255,255,50,0.8)",e.strokeStyle="rgba(100,100,100,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw,o=new ED.Point(0,0),o.setWithPolars(a,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(o),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Geographic.prototype.description=function(){return"Geographic atrophy"},ED.Geographic.prototype.snomedCode=function(){return 414875008},ED.Geographic.prototype.diagnosticHierarchy=function(){return 2},ED.VitreousOpacity=function(t,e,a,r,i,o,s,n,l,h,d){this.className="VitreousOpacity",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.VitreousOpacity.prototype=new ED.Doodle,ED.VitreousOpacity.prototype.constructor=ED.VitreousOpacity,ED.VitreousOpacity.superclass=ED.Doodle.prototype,ED.VitreousOpacity.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.VitreousOpacity.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.isSqueezable=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-100,0),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,4),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,4)},ED.VitreousOpacity.prototype.setParameterDefaults=function(){this.apexY=-100,this.setOriginWithDisplacements(0,-100)},ED.VitreousOpacity.prototype.draw=function(t){var e=this.drawing.context;ED.VitreousOpacity.superclass.draw.call(this,t),e.beginPath(),e.beginPath();var a=200;e.arc(0,0,a,0,2*Math.PI,!0);var r=.3+.6*(a+2*this.apexY)/a;return e.fillStyle="rgba(255, 0, 0,"+r+")",e.lineWidth=0,e.strokeStyle="rgba(255, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw,point=new ED.Point(0,0),point.setWithPolars(a,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(point),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.VitreousOpacity.prototype.description=function(){return"Vitreous haemorrhage"},ED.VitreousOpacity.prototype.snomedCode=function(){return 31341008},ED.CNV=function(t,e,a,r,i,o,s,n,l,h,d){this.className="CNV",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.CNV.prototype=new ED.Doodle,ED.CNV.prototype.constructor=ED.CNV,ED.CNV.superclass=ED.Doodle.prototype,ED.CNV.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.CNV.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-80,0),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,2)},ED.CNV.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(0,-100)},ED.CNV.prototype.draw=function(t){var e=this.drawing.context;ED.CNV.superclass.draw.call(this,t),e.beginPath();var a=80,r=16,i=2*Math.PI/r,o=.5*Math.PI/r,s=4,n=new ED.Point(0,0),l=new ED.Point(0,0);l.setWithPolars(a,0),e.moveTo(l.x,l.y);for(var h=a,d=0;r>d;d++){var c=a*(s+ED.randomArray[d])/s,p=new ED.Point(0,0);p.setWithPolars(h,d*i+o);var D=new ED.Point(0,0);D.setWithPolars(c,(d+1)*i-o);var u=new ED.Point(0,0);u.setWithPolars(c,(d+1)*i),h=c,d==r-1?e.bezierCurveTo(p.x,p.y,D.x,D.y,l.x,l.y):e.bezierCurveTo(p.x,p.y,D.x,D.y,u.x,u.y),1==d&&(n.x=u.x,n.y=u.y)}return e.closePath(),e.lineWidth=0,e.fillStyle="red",e.strokeStyle="red",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.arc(0,0,.8*a,0,2*Math.PI,!1),e.closePath(),e.fillStyle="rgba(255,255,190,1)",e.fill()),this.handleArray[2].location=this.transform.transformPoint(n),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CNV.prototype.description=function(){return"CNV"},ED.CNV.prototype.snomedCode=function(){return 314517003},ED.CNV.prototype.diagnosticHierarchy=function(){return 2},ED.IRMA=function(t,e,a,r,i,o,s,n,l,h,d){this.className="IRMA",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.IRMA.prototype=new ED.Doodle,ED.IRMA.prototype.constructor=ED.IRMA,ED.IRMA.superclass=ED.Doodle.prototype,ED.IRMA.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!0)},ED.IRMA.prototype.setPropertyDefaults=function(){this.parameterValidationArray.scaleX.range.setMinAndMax(1,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(1,1.5)},ED.IRMA.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(100,100)},ED.IRMA.prototype.draw=function(t){var e=this.drawing.context;return ED.IRMA.superclass.draw.call(this,t),e.beginPath(),e.moveTo(0,30),e.bezierCurveTo(-30,30,-70,0,-50,-20),e.bezierCurveTo(-30,-40,-20,-10,0,-10),e.bezierCurveTo(20,-10,30,-40,50,-20),e.bezierCurveTo(70,0,30,30,0,30),e.fillStyle="rgba(100, 100, 100, 0)",e.lineWidth=3,e.strokeStyle="red",this.drawBoundary(t),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(50,-40)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.IRMA.prototype.groupDescription=function(){return"Intraretinal microvascular abnormalities "},ED.IRMA.prototype.description=function(){return this.locationRelativeToFovea()},ED.MacularThickening=function(t,e,a,r,i,o,s,n,l,h,d){this.className="MacularThickening",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.MacularThickening.prototype=new ED.Doodle,ED.MacularThickening.prototype.constructor=ED.MacularThickening,ED.MacularThickening.superclass=ED.Doodle.prototype,ED.MacularThickening.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.MacularThickening.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(100,400),this.parameterValidationArray.apexY.range.setMinAndMax(-0,0)},ED.MacularThickening.prototype.setParameterDefaults=function(){this.rotation=-Math.PI/4,this.apexX=100,this.apexY=0,this.setOriginWithDisplacements(0,150)},ED.MacularThickening.prototype.draw=function(t){var e=this.drawing.context;ED.MacularThickening.superclass.draw.call(this,t);var a=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY);if(e.beginPath(),e.arc(0,0,a,0,2*Math.PI,!0),e.lineWidth=3,e.strokeStyle="rgba(255, 255, 255, 0)",e.fillStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();var r=30;e.moveTo(-a,0),e.lineTo(a,0);for(var i=-1;2>i;i+=2)for(var o=r;a>o;o+=r){var s=this.xForY(a,o);e.moveTo(-s,i*o),e.lineTo(s,i*o)}e.lineWidth=15,e.lineCap="round",e.strokeStyle="rgba(200, 200, 200, 0.75)",e.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.MacularThickening.prototype.groupDescription=function(){return"Macular thickening "},ED.MacularThickening.prototype.description=function(){return this.locationRelativeToFovea()},ED.TractionRetinalDetachment=function(t,e,a,r,i,o,s,n,l,h,d){this.className="TractionRetinalDetachment",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.TractionRetinalDetachment.prototype=new ED.Doodle,ED.TractionRetinalDetachment.prototype.constructor=ED.TractionRetinalDetachment,ED.TractionRetinalDetachment.superclass=ED.Doodle.prototype,ED.TractionRetinalDetachment.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!0)},ED.TractionRetinalDetachment.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.addAtBack=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.TractionRetinalDetachment.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(200,-100)},ED.TractionRetinalDetachment.prototype.draw=function(t){var e=this.drawing.context;ED.TractionRetinalDetachment.superclass.draw.call(this,t),e.beginPath();var a=60,r=150;return e.moveTo(-r,-r),e.bezierCurveTo(-a,-a,a,-a,r,-r),e.bezierCurveTo(a,-a,a,a,r,r),e.bezierCurveTo(a,a,-a,a,-r,r),e.bezierCurveTo(-a,a,-a,-a,-r,-r),e.closePath(),e.lineWidth=1,e.strokeStyle="blue",e.fillStyle="blue",this.drawBoundary(t),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(r,-r)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.TractionRetinalDetachment.prototype.groupDescription=function(){return"Traction retinal detachment "},ED.TractionRetinalDetachment.prototype.description=function(){return this.locationRelativeToDisc()},null==ED||"object"!=typeof ED)var ED={};if(ED.StrabOpTemplate=function(t,e,a,r,i,o,s,n,l,h,d){this.className="StrabOpTemplate",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.StrabOpTemplate.prototype=new ED.Doodle,ED.StrabOpTemplate.prototype.constructor=ED.StrabOpTemplate,ED.StrabOpTemplate.superclass=ED.Doodle.prototype,ED.StrabOpTemplate.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isUnique=!0,this.isDeletable=!1},ED.StrabOpTemplate.prototype.draw=function(t){var e=this.drawing.context;ED.StrabOpTemplate.superclass.draw.call(this,t);var a=-200,r=70;return e.beginPath(),e.arc(0,0,80,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(100, 200, 250, 0.75)",e.strokeStyle="blue",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.arc(0,0,30,0,2*Math.PI,!0),e.fillStyle="black",e.fill(),e.beginPath(),e.moveTo(-r,a),e.lineTo(r,a),e.moveTo(a,-r),e.lineTo(a,r),e.moveTo(-r,-a),e.lineTo(r,-a),e.moveTo(-a,-r),e.lineTo(-a,r),e.lineWidth=16,e.strokeStyle="brown",e.stroke()),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Rectus=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Rectus",this.insertionY=-200,this.hangback=!1,this.canTranspose=!0,this.recession=0,this.transposition="None",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Rectus.prototype=new ED.Doodle,ED.Rectus.prototype.constructor=ED.Rectus,ED.Rectus.superclass=ED.Doodle.prototype,ED.Rectus.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Rectus.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.recession={kind:"derived",type:"float",range:new ED.Range(-12.5,6.5),precision:1,animate:!0},this.parameterValidationArray.transposition={kind:"derived",type:"string",list:["Up","None","Down"],animate:!0},this.parameterValidationArray.canTranspose={kind:"derived",type:"bool",animate:!1}},ED.Rectus.prototype.setParameterDefaults=function(){this.setParameterFromString("recession","0"),this.setParameterFromString("transposition","None"),this.apexY=this.insertionY,this.canTranspose=!0},ED.Rectus.prototype.dependentParameterValues=function(t,e){var a=[];switch(t){case"apexY":a.recession=Math.round(2*(e-this.insertionY)/16)/2;break;case"recession":a.apexY=16*e+this.insertionY;break;case"apexX":a.transposition=this.rotation>0&&this.rotation<Math.PI?0>e?"Up":e>0?"Down":"None":0>e?"Down":e>0?"Up":"None";break;case"transposition":switch(e){case"Up":a.apexX=this.rotation>0&&this.rotation<Math.PI?-50:50;break;case"Down":a.apexX=this.rotation>0&&this.rotation<Math.PI?50:-50;break;case"None":a.apexX=0}}var r=15;return this.apexY>this.insertionY-r&&this.apexY<this.insertionY+r&&this.canTranspose?this.parameterValidationArray.apexX.range.setMinAndMax(-100,100):this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.apexX>-r&&r>this.apexX?this.parameterValidationArray.apexY.range.setMinAndMax(-400,-100):this.parameterValidationArray.apexY.range.setMinAndMax(-200,-200),a},ED.Rectus.prototype.draw=function(t){var e=this.drawing.context;ED.Rectus.superclass.draw.call(this,t),e.beginPath();var a=60,r=-450;if(e.moveTo(-a,r),e.lineTo(a,r),e.lineTo(this.apexX+a,this.apexY),e.lineTo(this.apexX-a,this.apexY),e.closePath(),e.lineWidth=2,e.fillStyle="rgba(255, 140 , 80, 1)",e.strokeStyle="rgba(255, 184, 93, 1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(this.insertionY<this.apexY){var i=-a+this.apexX*(this.insertionY-r)/(this.apexY-r);e.beginPath(),e.moveTo(i,this.insertionY),e.lineTo(i+2*a,this.insertionY),e.lineTo(this.apexX+a,this.apexY),e.lineTo(this.apexX-a,this.apexY),e.closePath(),e.fillStyle="rgba(255, 220, 140, 1)",e.fill()}if(0!=this.apexX||this.apexY!=this.insertionY){var o,s=15,n=15,l=10,h=20;o=this.insertionY>this.apexY?this.apexY:this.insertionY;var d;d=!this.hangback&&this.insertionY>this.apexY?this.apexY+s:this.insertionY+s;var c=this.apexX;e.beginPath(),e.moveTo(c,d),e.lineTo(c-n,d+n),e.moveTo(c+n,d+n),e.lineTo(c,d),e.arc(c,d,4,0,2*Math.PI,!0),e.moveTo(c,d),e.lineTo(c-a+l,d),e.lineTo(c-a+l,o),e.moveTo(c-a+l,o-s),e.lineTo(c-a+l+h,o-s),e.moveTo(c+a-l-h,o-s),e.lineTo(c+a-l,o-s),e.moveTo(c+a-l,o),e.lineTo(c+a-l,d),e.lineTo(c,d),e.lineWidth=4,e.strokeStyle="black",e.stroke()}}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},null==ED||"object"!=typeof ED)var ED={};ED.Fundus=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Fundus",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Fundus.prototype=new ED.Doodle,ED.Fundus.prototype.constructor=ED.Fundus,ED.Fundus.superclass=ED.Doodle.prototype,ED.Fundus.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.isFilled=!1},ED.Fundus.prototype.draw=function(t){var e=this.drawing.context;if(ED.Fundus.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,480,0,2*Math.PI,!0),e.closePath(),e.lineWidth=2,e.strokeStyle="red",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(this.drawing.eye!=ED.eye.Right)var a=200,r=100,i=-50,o=-100,s=100;else var a=-200,r=-100,i=50,o=100,s=-100;e.moveTo(a,-50),e.bezierCurveTo(r,-166,0,-62,0,-12),e.bezierCurveTo(0,-40,i,-100,o,-50),e.moveTo(a,50),e.bezierCurveTo(r,166,0,62,0,12),e.bezierCurveTo(0,40,i,100,o,50);var n=10;e.moveTo(s,-n),e.lineTo(s,n),e.moveTo(s-n,0),e.lineTo(s+n,0),e.moveTo(25,0),e.arc(0,0,25,0,2*Math.PI,!0),e.moveTo(12,0),e.arc(0,0,12,0,2*Math.PI,!0),e.stroke()}return this.isClicked},ED.Fundus.prototype.description=function(){return""},ED.EpiretinalMembrane=function(t,e,a,r,i,o,s,n,l,h,d){ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d),this.className="EpiretinalMembrane"},ED.EpiretinalMembrane.prototype=new ED.Doodle,ED.EpiretinalMembrane.prototype.constructor=ED.EpiretinalMembrane,ED.EpiretinalMembrane.superclass=ED.Doodle.prototype,ED.EpiretinalMembrane.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!0)},ED.EpiretinalMembrane.prototype.setPropertyDefaults=function(){this.isSelectable=!0,this.isOrientated=!1,this.isScaleable=!0,this.isSqueezable=!0,this.isMoveable=!0,this.isRotatable=!0,this.rangeOfScale=new ED.Range(.5,1.5),this.rangeOfArc=new ED.Range(Math.PI/6,2*Math.PI),this.rangeOfApexX=new ED.Range(-0,0),this.rangeOfApexY=new ED.Range(-40,30)},ED.EpiretinalMembrane.prototype.setParameterDefaults=function(){this.originY=0,this.originX=this.drawing.hasDoodleOfClass("PostPole")?0:this.drawing.eye==ED.eye.Right?-100:100},ED.EpiretinalMembrane.prototype.draw=function(t){var e=this.drawing.context;ED.EpiretinalMembrane.superclass.draw.call(this,t),e.beginPath();var a=120;if(e.arc(0,0,a,0,2*Math.PI,!0),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.strokeStyle="rgba(0, 255, 0, 0.7)",e.beginPath(),e.moveTo(-a,0),e.lineTo(a,0);var r=.9*a,i=-a/2,o=.3;e.moveTo(-r,i),e.bezierCurveTo(-r*o,i*o,r*o,i*o,r,i),i=a/2,e.moveTo(-r,i),e.bezierCurveTo(-r*o,i*o,r*o,i*o,r,i),r=.6*a,i=.8*-a,o=.5,e.moveTo(-r,i),e.bezierCurveTo(-r*o,i*o,r*o,i*o,r,i),i=.8*a,e.moveTo(-r,i),e.bezierCurveTo(-r*o,i*o,r*o,i*o,r,i),e.lineWidth=18,e.lineCap="round",e.stroke()}return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(.7*a,.7*-a)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.EpiretinalMembrane.prototype.description=function(){var t="Epiretinal membrane";return t},ED.EpiretinalMembrane.prototype.snomedCode=function(){return 367649002},ED.EpiretinalMembrane.prototype.diagnosticHierarchy=function(){return 2},ED.SectorPRP=function(t,e,a,r,i,o,s,n,l,h,d){this.className="SectorPRP",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.SectorPRP.prototype=new ED.Doodle,ED.SectorPRP.prototype.constructor=ED.SectorPRP,ED.SectorPRP.superclass=ED.Doodle.prototype,ED.SectorPRP.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1)},ED.SectorPRP.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-400,-100)},ED.SectorPRP.prototype.setParameterDefaults=function(){this.arc=55*Math.PI/180,this.apexY=-100;var t=this.drawing.lastDoodleOfClass(this.className);this.rotation=t?t.rotation+(this.drawing.eye==ED.eye.Right?-1:1)*(t.arc/2+this.arc/2+Math.PI/12):(this.drawing.eye==ED.eye.Right?-1:1)*this.arc/2},ED.SectorPRP.prototype.draw=function(t){var e=this.drawing.context;ED.SectorPRP.superclass.draw.call(this,t);var a=476,r=-this.apexY,i=r+(a-r)/2,o=this.arc/2,s=-Math.PI/2+o,n=-Math.PI/2-o,l=i*Math.sin(o),h=-i*Math.cos(o),d=-i*Math.sin(o),c=h;if(e.beginPath(),e.arc(0,0,a,s,n,!0),e.arc(0,0,r,n,s,!1),e.closePath(),e.lineWidth=40,e.fillStyle="rgba(255,255,255,0)",e.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var p=30,D=30+p,u=[47,41,35,28,22,15],y=0,i=a-p;i>r;i-=D){for(var g=0,E=-Math.PI/2-s;this.arc-Math.PI/2-s>E;E+=D/i){E=-Math.PI/2-s+2*g*Math.PI/u[y];var f=new ED.Point(0,0);f.setWithPolars(i,E),this.drawLaserSpot(e,f.x,f.y),g++}y++}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(d,c)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(l,h)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.LaserCircle=function(t,e,a,r,i,o,s,n,l,h,d){this.className="LaserCircle",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.LaserCircle.prototype=new ED.Doodle,ED.LaserCircle.prototype.constructor=ED.LaserCircle,ED.LaserCircle.superclass=ED.Doodle.prototype,ED.LaserCircle.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.LaserCircle.prototype.setPropertyDefaults=function(){this.isOrientated=!0,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(50,400),this.parameterValidationArray.apexY.range.setMinAndMax(-400,-50)},ED.LaserCircle.prototype.setParameterDefaults=function(){this.apexX=84,this.apexY=-84;var t=this.drawing.lastDoodleOfClass(this.className);if(t){var e=new ED.Point(t.originX,t.originY),a=new ED.Point(0,0);a.setWithPolars(e.length(),e.direction()+Math.PI/6),this.move(a.x,a.y)}else this.move(200*(this.drawing.eye==ED.eye.Right?-1:1),-300)},ED.LaserCircle.prototype.draw=function(t){var e=this.drawing.context;if(ED.LaserCircle.superclass.draw.call(this,t),e.beginPath(),e.moveTo(this.apexX,this.apexY),e.lineTo(this.apexX,-this.apexY),e.lineTo(-this.apexX,-this.apexY),e.lineTo(-this.apexX,this.apexY),e.lineTo(this.apexX,this.apexY),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var a=25,r=new ED.Point(0,0),i=this.apexX+this.apexY;if(0>i)var o=this.apexX;else var o=-this.apexY;for(var s=Math.round(Math.PI/(a/o)),n=0;s+1>n;n++)if(0>i){var l=-Math.PI/2+n*Math.PI/s;r.setWithPolars(o,l),this.drawLaserSpot(e,r.x,r.y+i)}else{var l=-Math.PI+n*Math.PI/s;r.setWithPolars(o,l),this.drawLaserSpot(e,r.x-i,r.y)}for(var n=1;s>n;n++)if(0>i){var l=Math.PI/2+n*Math.PI/s;r.setWithPolars(o,l),this.drawLaserSpot(e,r.x,r.y-i)}else{var l=0+n*Math.PI/s;r.setWithPolars(o,l),this.drawLaserSpot(e,r.x+i,r.y)}s=Math.abs(Math.round(i/a));for(var n=0;2*s+1>n;n++)if(0>i){var h=this.apexY+o+n*Math.abs(i/s);this.drawLaserSpot(e,-o,h),this.drawLaserSpot(e,o,h)}else{var d=-this.apexX+o+n*Math.abs(i/s);this.drawLaserSpot(e,d,-o),this.drawLaserSpot(e,d,o)}}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.LaserCircle.prototype.description=function(){var t="";return t+="LaserCircle scar ",t+=this.clockHour()+" o'clock"},ED.LaserDemarcation=function(t,e,a,r,i,o,s,n,l,h,d){this.className="LaserDemarcation",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.LaserDemarcation.prototype=new ED.Doodle,ED.LaserDemarcation.prototype.constructor=ED.LaserDemarcation,ED.LaserDemarcation.superclass=ED.Doodle.prototype,ED.LaserDemarcation.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.LaserDemarcation.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/4,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-400,-300)},ED.LaserDemarcation.prototype.setParameterDefaults=function(){this.arc=120*Math.PI/180,this.apexY=-350;var t=this.drawing.lastDoodleOfClass(this.className);this.rotation=t?t.rotation+Math.PI/4:this.drawing.eye==ED.eye.Right?-.8*Math.PI:.8*Math.PI},ED.LaserDemarcation.prototype.draw=function(t){var e=this.drawing.context;ED.LaserDemarcation.superclass.draw.call(this,t);var a=476,r=-this.apexY,i=r+(a-r)/2,o=this.arc/2,s=-Math.PI/2+o,n=-Math.PI/2-o,l=i*Math.sin(o),h=-i*Math.cos(o),d=-i*Math.sin(o),c=h;if(e.beginPath(),e.arc(0,0,a,s,n,!0),e.arc(0,0,r,n,s,!1),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255,255,255,0)",e.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var p=25,D=new ED.Point(0,0);if(this.arc<1.9*Math.PI){for(var u=a-r,y=Math.PI/2,g=Math.round(y/(p/u)),E=new ED.Point(-a*Math.sin(o-u/a),-a*Math.cos(o-u/a)),f=0;g>f;f++)D.setWithPolars(u,n+.5*(u/a)-f*y/g),this.drawLaserSpot(e,E.x+D.x,E.y+D.y);for(var m=this.arc-2*u/a,P=Math.round(m/(p/r)),w=E.direction(),f=0;P+1>f;f++)D.setWithPolars(r,w+f*m/P),this.drawLaserSpot(e,D.x,D.y);for(var b=new ED.Point(-a*Math.sin(-o+u/a),-a*Math.cos(-o+u/a)),f=0;g>f;f++)D.setWithPolars(u,s+Math.PI-.5*(u/a)+f*y/g),this.drawLaserSpot(e,b.x+D.x,b.y+D.y)}else for(var g=Math.round(2*Math.PI/(p/r)),f=0;g>f;f++)D.setWithPolars(r,2*f*Math.PI/g),this.drawLaserSpot(e,D.x,D.y)}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(d,c)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RRD=function(t,e,a,r,i,o,s,n,l,h,d){this.className="RRD",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.RRD.prototype=new ED.Doodle,ED.RRD.prototype.constructor=ED.RRD,ED.RRD.superclass=ED.Doodle.prototype,ED.RRD.prototype.setHandles=function(){this.handleArray[1]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.RRD.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(1,4),this.parameterValidationArray.scaleY.range.setMinAndMax(1,4),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-400,400)},ED.RRD.prototype.setParameterDefaults=function(){this.arc=120*Math.PI/180,this.apexY=-100},ED.RRD.prototype.draw=function(t){var e=this.drawing.context;ED.RRD.superclass.draw.call(this,t);var a=476,r=this.arc/2,i=-Math.PI/2+r,o=-Math.PI/2-r,s=a*Math.sin(r),n=-a*Math.cos(r),l=-a*Math.sin(r),h=n;e.beginPath(),e.arc(0,0,a,i,o,!0);var d=.6,c=25;if(-c>this.apexY)e.bezierCurveTo(l,h,d*l,this.apexY,this.apexX,this.apexY),e.bezierCurveTo(-d*l,this.apexY,s,n,s,n);else if(c>this.apexY){var p=Math.acos((0-this.apexY)/c),D=c*Math.sin(p);e.bezierCurveTo(l,h,d*l,this.apexY,-D,this.apexY),e.arc(0,0,c,-Math.PI/2-p,-Math.PI/2+p,!1),e.bezierCurveTo(-d*l,this.apexY,s,n,s,n)}else e.bezierCurveTo(l,h,d*l,this.apexY,0,25),e.arc(0,0,c,Math.PI/2,2.5*Math.PI,!1),e.bezierCurveTo(-d*l,this.apexY,s,n,s,n);return e.lineWidth=4,e.fillStyle="rgba(0, 0, 255, 0.75)",e.strokeStyle="blue",this.drawBoundary(t),this.handleArray[1].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(s,n)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RRD.prototype.description=function(){var t="";return t+=Math.cos(this.rotation)>0?"Supero":"Infero",t+=Math.sin(this.rotation)>0?this.drawing.eye==ED.eye.Right?"nasal":"temporal":this.drawing.eye==ED.eye.Right?"temporal":"nasal",t+=" retinal detachment",t+=this.isMacOff()?" (macula off)":" (macula on)"},ED.RRD.prototype.snomedCode=function(){return this.isMacOff()?232009009:232008001},ED.RRD.prototype.diagnosticHierarchy=function(){return this.isMacOff()?10:9},ED.RRD.prototype.isMacOff=function(){if(this.drawing.eye==ED.eye.Right)var t=new ED.Point(-100,0);else var t=new ED.Point(100,0);var e=this.drawing.transform.transformPoint(t);return this.draw(e)?!0:!1},ED.PeripheralRRD=function(t,e,a,r,i,o,s,n,l,h,d){this.className="PeripheralRRD",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.PeripheralRRD.prototype=new ED.Doodle,ED.PeripheralRRD.prototype.constructor=ED.PeripheralRRD,ED.PeripheralRRD.superclass=ED.Doodle.prototype,ED.PeripheralRRD.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.PeripheralRRD.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/4,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-400,-300)},ED.PeripheralRRD.prototype.setParameterDefaults=function(){this.arc=112*Math.PI/180,this.apexY=-380;var t=this.drawing.lastDoodleOfClass(this.className);t?this.drawing.eye==ED.eye.Right:this.rotation=this.drawing.eye==ED.eye.Right?-.8*Math.PI:.8*Math.PI},ED.PeripheralRRD.prototype.draw=function(t){var e=this.drawing.context;ED.PeripheralRRD.superclass.draw.call(this,t);var a=476,r=-this.apexY,i=r+(a-r)/2,o=a-r,s=this.arc/2,n=-Math.PI/2+s,l=-Math.PI/2-s,h=i*Math.sin(s),d=-i*Math.cos(s),c=-i*Math.sin(s),p=d,D=new ED.Point(0,0);D.x=-a*Math.sin(s-o/a),D.y=-a*Math.cos(s-o/a);var u=new ED.Point(0,0);u.x=-a*Math.sin(-s+o/a),u.y=-a*Math.cos(-s+o/a),e.beginPath(),e.arc(0,0,a,n,l,!0);var y=l-Math.PI/2;return e.arc(D.x,D.y,o,y,y-Math.PI/2+o/a,!0),e.arc(0,0,r,D.direction()-Math.PI/2,u.direction()-Math.PI/2,!1),y=n+Math.PI/2,e.arc(u.x,u.y,o,y+Math.PI/2-o/a,y,!0),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(0, 0, 255, 0.75)",e.strokeStyle="blue",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(c,p)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(h,d)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PeripheralRRD.prototype.snomedCode=function(){return 232008001},ED.PeripheralRRD.prototype.diagnosticHierarchy=function(){return 8},ED.UTear=function(t,e,a,r,i,o,s,n,l,h,d){this.className="UTear",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.UTear.prototype=new ED.Doodle,ED.UTear.prototype.constructor=ED.UTear,ED.UTear.superclass=ED.Doodle.prototype,ED.UTear.prototype.setHandles=function(){this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.UTear.prototype.setPropertyDefaults=function(){this.isOrientated=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-40,30)},ED.UTear.prototype.setParameterDefaults=function(){this.apexY=-20;var t=this.drawing.lastDoodleOfClass(this.className);if(t){var e=new ED.Point(t.originX,t.originY),a=new ED.Point(0,0);a.setWithPolars(e.length(),e.direction()+Math.PI/6),this.move(a.x,a.y)}else this.move(200*(this.drawing.eye==ED.eye.Right?-1:1),-300)},ED.UTear.prototype.draw=function(t){var e=this.drawing.context;return ED.UTear.superclass.draw.call(this,t),e.beginPath(),e.moveTo(0,40),e.bezierCurveTo(-20,40,-40,-20,-40,-40),e.bezierCurveTo(-40,-60,-20,this.apexY,0,this.apexY),e.bezierCurveTo(20,this.apexY,40,-60,40,-40),e.bezierCurveTo(40,-20,20,40,0,40),e.closePath(),e.lineWidth=4,e.fillStyle="red",e.strokeStyle="blue",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[3].location=this.transform.transformPoint(new ED.Point(40,-40)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.leftExtremity=this.transform.transformPoint(new ED.Point(-40,-40)),this.rightExtremity=this.transform.transformPoint(new ED.Point(40,-40)),this.arc=this.calculateArc(),this.isClicked
},ED.UTear.prototype.description=function(){var t="";return 1>this.scaleX&&(t="Small "),this.scaleX>1.5&&(t="Large "),t+="'U' tear at ",t+=this.clockHour()+" o'clock"},ED.RoundHole=function(t,e,a,r,i,o,s,n,l,h,d){this.className="RoundHole",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.RoundHole.prototype=new ED.Doodle,ED.RoundHole.prototype.constructor=ED.RoundHole,ED.RoundHole.superclass=ED.Doodle.prototype,ED.RoundHole.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.RoundHole.prototype.setPropertyDefaults=function(){},ED.RoundHole.prototype.setParameterDefaults=function(){var t=300;this.originX=t,this.originY=t;var e=this.drawing.lastDoodleOfClass(this.className);if(e){var a=new ED.Point(e.originX,e.originY),r=a.direction()+Math.PI/8,i=a.length(),o=new ED.Point(0,0);o.setWithPolars(i,r),this.originX=o.x,this.originY=o.y}},ED.RoundHole.prototype.draw=function(t){var e=this.drawing.context;ED.RoundHole.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,30,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,e.fillStyle="red",e.strokeStyle="blue",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[2].location=this.transform.transformPoint(new ED.Point(21,-21)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t);var a=this.transform.transformPoint(new ED.Point(0,0)),r=this.transform.transformPoint(new ED.Point(60,0)),i=a.x-this.drawing.canvas.width/2,o=a.y-this.drawing.canvas.height/2,s=this.scaleX*Math.sqrt(i*i+o*o),n=this.scaleX*(r.x-a.x);return this.arc=Math.atan(n/s),this.isClicked},ED.RoundHole.prototype.description=function(){var t="";return 1>this.scaleX&&(t="Small "),this.scaleX>1.5&&(t="Large "),t+="Round hole ",t+=this.clockHour()+" o'clock"},ED.RoundHole.prototype.snomedCode=function(){return 302888003},ED.RoundHole.prototype.diagnosticHierarchy=function(){return 3},ED.CystoidMacularOedema=function(t,e,a,r,i,o,s,n,l,h,d){this.className="CystoidMacularOedema",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.CystoidMacularOedema.prototype=new ED.Doodle,ED.CystoidMacularOedema.prototype.constructor=ED.CystoidMacularOedema,ED.CystoidMacularOedema.superclass=ED.Doodle.prototype,ED.CystoidMacularOedema.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.CystoidMacularOedema.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-40,30),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.CystoidMacularOedema.prototype.setParameterDefaults=function(){this.drawing.hasDoodleOfClass("Fundus")&&(this.originX=this.drawing.eye==ED.eye.Right?-100:100,this.scaleX=.5,this.scaleY=.5)},ED.CystoidMacularOedema.prototype.draw=function(t){var e=this.drawing.context;ED.CystoidMacularOedema.superclass.draw.call(this,t);var a=100;if(e.beginPath(),e.arc(0,0,a,0,2*Math.PI,!0),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){for(var r="rgba(255, 255, 138, 0.5)",i="rgba(255, 82, 0, 0.7)",o=new ED.Point(0,0),s=8,n=0;s>n;n++){var l=2*n*Math.PI/s;o.setWithPolars(2*a/3,l),this.drawCircle(e,o.x,o.y,40,r,2,i)}this.drawCircle(e,0,0,a/2,r,2,i)}return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(84,-84)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CystoidMacularOedema.prototype.description=function(){return"Cystoid macular oedema"},ED.CystoidMacularOedema.prototype.snomedCode=function(){return 193387007},ED.CystoidMacularOedema.prototype.diagnosticHierarchy=function(){return 2},ED.EpiretinalMembrane=function(t,e,a,r,i,o,s,n,l,h,d){this.className="EpiretinalMembrane",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.EpiretinalMembrane.prototype=new ED.Doodle,ED.EpiretinalMembrane.prototype.constructor=ED.EpiretinalMembrane,ED.EpiretinalMembrane.superclass=ED.Doodle.prototype,ED.EpiretinalMembrane.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!0)},ED.EpiretinalMembrane.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-40,30),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.scaleX.range.setMinAndMax(.25,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.25,1.5)},ED.EpiretinalMembrane.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(0,-100),this.drawing.hasDoodleOfClass("Fundus")&&(this.originX=this.drawing.eye==ED.eye.Right?-100:100,this.scaleX=.5,this.scaleY=.5)},ED.EpiretinalMembrane.prototype.draw=function(t){var e=this.drawing.context;ED.EpiretinalMembrane.superclass.draw.call(this,t),e.beginPath();var a=120;if(e.arc(0,0,a,0,2*Math.PI,!0),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.strokeStyle="rgba(0, 255, 0, 0.7)",e.beginPath(),e.moveTo(-a,0),e.lineTo(a,0);var r=.9*a,i=-a/2,o=.3;e.moveTo(-r,i),e.bezierCurveTo(-r*o,i*o,r*o,i*o,r,i),i=a/2,e.moveTo(-r,i),e.bezierCurveTo(-r*o,i*o,r*o,i*o,r,i),r=.6*a,i=.8*-a,o=.5,e.moveTo(-r,i),e.bezierCurveTo(-r*o,i*o,r*o,i*o,r,i),i=.8*a,e.moveTo(-r,i),e.bezierCurveTo(-r*o,i*o,r*o,i*o,r,i),e.lineWidth=18,e.lineCap="round",e.stroke()}return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(.7*a,.7*-a)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.EpiretinalMembrane.prototype.description=function(){return"Epiretinal membrane"},ED.EpiretinalMembrane.prototype.snomedCode=function(){return 367649002},ED.EpiretinalMembrane.prototype.diagnosticHierarchy=function(){return 2},ED.MacularHole=function(t,e,a,r,i,o,s,n,l,h,d){this.className="MacularHole",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.MacularHole.prototype=new ED.Doodle,ED.MacularHole.prototype.constructor=ED.MacularHole,ED.MacularHole.superclass=ED.Doodle.prototype,ED.MacularHole.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.MacularHole.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-40,30),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.MacularHole.prototype.setParameterDefaults=function(){this.drawing.hasDoodleOfClass("Fundus")&&(this.originX=this.drawing.eye==ED.eye.Right?-100:100,this.scaleX=.5,this.scaleY=.5)},ED.MacularHole.prototype.draw=function(t){var e=this.drawing.context;ED.MacularHole.superclass.draw.call(this,t);var a=40;return e.beginPath(),e.arc(0,0,a,0,2*Math.PI,!0),e.closePath(),e.lineWidth=0,e.fillStyle="yellow",e.strokeStyle="red",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.arc(0,0,2*a/3,0,2*Math.PI,!0),e.closePath(),e.fillStyle="red",e.fill()),point=new ED.Point(0,0),point.setWithPolars(a,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(point),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.MacularHole.prototype.description=function(){return"Macular hole"},ED.MacularHole.prototype.snomedCode=function(){return 232006002},ED.MacularHole.prototype.diagnosticHierarchy=function(){return 2},ED.BuckleOperation=function(t,e,a,r,i,o,s,n,l,h,d){this.className="BuckleOperation",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.BuckleOperation.prototype=new ED.Doodle,ED.BuckleOperation.prototype.constructor=ED.BuckleOperation,ED.BuckleOperation.superclass=ED.Doodle.prototype,ED.BuckleOperation.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.willReport=!1},ED.BuckleOperation.prototype.draw=function(t){var e=this.drawing.context;return ED.BuckleOperation.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,100,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,this.isFilled=!1,e.strokeStyle="#444",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(this.drawRectus(e,"Sup"),this.drawRectus(e,"Nas"),this.drawRectus(e,"Inf"),this.drawRectus(e,"Tem")),this.isClicked},ED.BuckleOperation.prototype.drawRectus=function(t,e){switch(t.beginPath(),e){case"Sup":x1=-60,y1=-480,x2=-60,y2=-200,x3=60,y3=-200,x4=60,y4=-480,xd=30,yd=0;break;case"Nas":x1=480,y1=-60,x2=200,y2=-60,x3=200,y3=60,x4=480,y4=60,xd=0,yd=30;break;case"Inf":x1=60,y1=480,x2=60,y2=200,x3=-60,y3=200,x4=-60,y4=480,xd=-30,yd=0;break;case"Tem":x1=-480,y1=60,x2=-200,y2=60,x3=-200,y3=-60,x4=-480,y4=-60,xd=0,yd=-30;default:}t.moveTo(x1,y1),t.lineTo(x2,y2),t.lineTo(x3,y3),t.lineTo(x4,y4),t.moveTo(x1+xd,y1+yd),t.lineTo(x2+xd,y2+yd),t.moveTo(x1+2*xd,y1+2*yd),t.lineTo(x2+2*xd,y2+2*yd),t.moveTo(x1+3*xd,y1+3*yd),t.lineTo(x2+3*xd,y2+3*yd),t.fillStyle="#CA6800",t.fill(),t.lineWidth=8,t.strokeStyle="#804000",t.stroke()},ED.CircumferentialBuckle=function(t,e,a,r,i,o,s,n,l,h,d){this.className="CircumferentialBuckle",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.CircumferentialBuckle.prototype=new ED.Doodle,ED.CircumferentialBuckle.prototype.constructor=ED.CircumferentialBuckle,ED.CircumferentialBuckle.superclass=ED.Doodle.prototype,ED.CircumferentialBuckle.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.CircumferentialBuckle.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.addAtBack=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-410,-320),this.parameterValidationArray.scaleX.range.setMinAndMax(.25,4),this.parameterValidationArray.scaleY.range.setMinAndMax(.25,4)},ED.CircumferentialBuckle.prototype.setParameterDefaults=function(){this.arc=140*Math.PI/180,this.apexY=-320,this.rotation=-45*Math.PI/180},ED.CircumferentialBuckle.prototype.draw=function(t){var e=this.drawing.context;ED.CircumferentialBuckle.superclass.draw.call(this,t);var a=320;-350>this.apexY&&this.apexY>-380?a=350:-380>this.apexY&&(a=410);var r=220,i=this.arc/2,o=-Math.PI/2+i,s=-Math.PI/2-i,n=a*Math.sin(i),l=-a*Math.cos(i),h=-a*Math.sin(i),d=l;if(e.beginPath(),e.arc(0,0,a,o,s,!0),e.arc(0,0,r,s,o,!1),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(200,200,200,0.75)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();var c=30;rgi=r+(a-r-c)/2,rgo=a-(a-r-c)/2,e.arc(0,0,rgo,o,s,!0),e.arc(0,0,rgi,s,o,!1),e.closePath(),e.fill(),e.stroke()}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(h,d)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(n,l)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,-a)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CircumferentialBuckle.prototype.description=function(){var t="";return t=-380>=this.apexY?"280 circumferential buckle ":-350>=this.apexY?"279 circumferential buckle ":"277 circumferential buckle ",t+=this.arc>1.8*Math.PI?"encirclement":this.clockHourExtent()+" o'clock"},ED.BuckleSuture=function(t,e,a,r,i,o,s,n,l,h,d){this.className="BuckleSuture",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.BuckleSuture.prototype=new ED.Doodle,ED.BuckleSuture.prototype.constructor=ED.BuckleSuture,ED.BuckleSuture.superclass=ED.Doodle.prototype,ED.BuckleSuture.prototype.setHandles=function(){},ED.BuckleSuture.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.willReport=!1},ED.BuckleSuture.prototype.setParameterDefaults=function(){this.arc=15*Math.PI/180,this.apexY=-320;var t=this.drawing.lastDoodleOfClass(this.className);this.rotation=t?t.rotation+Math.PI/6:-60*Math.PI/180},ED.BuckleSuture.prototype.draw=function(t){var e=this.drawing.context;ED.BuckleSuture.superclass.draw.call(this,t);var a=340,i=this.drawing.lastDoodleOfClass("CircumferentialBuckle");i&&(a=-i.apexY+20);var o=200,s=this.arc/2,n=-Math.PI/2+s,l=-Math.PI/2-s;if(e.beginPath(),e.arc(0,0,a,n,l,!0),e.arc(0,0,o,l,n,!1),e.closePath(),e.lineWidth=4,this.isFilled=!1,e.strokeStyle="#666",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){r=o+(a-o)/2;var h=r*Math.sin(s),d=-r*Math.cos(s);e.beginPath(),e.arc(h,d,5,0,2*Math.PI,!0),e.moveTo(h+20,d+20),e.lineTo(h,d),e.lineTo(h+20,d-20),e.stroke()}return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.EncirclingBand=function(t,e,a,r,i,o,s,n,l,h,d){this.className="EncirclingBand",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.EncirclingBand.prototype=new ED.Doodle,ED.EncirclingBand.prototype.constructor=ED.EncirclingBand,ED.EncirclingBand.superclass=ED.Doodle.prototype,ED.EncirclingBand.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.addAtBack=!0,this.isUnique=!0},ED.EncirclingBand.prototype.setParameterDefaults=function(){this.rotation=-45*Math.PI/180},ED.EncirclingBand.prototype.draw=function(t){var e=this.drawing.context;ED.EncirclingBand.superclass.draw.call(this,t);var a=270,r=this.drawing.lastDoodleOfClass("CircumferentialBuckle");if(r){var i=r.apexY;-350>i&&i>-380?a=286:-380>i&&(a=315)}var o=a+15,s=a-15;if(e.beginPath(),e.arc(0,0,o,0,2*Math.PI,!0),e.arc(0,0,s,2*Math.PI,0,!1),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(200,200,200,0.75)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();var n=Math.PI/16;e.arc(0,0,o+10,n,-n,!0),e.arc(0,0,s-10,-n,n,!1),e.closePath(),e.lineWidth=6,e.stroke()}return this.isClicked},ED.EncirclingBand.prototype.description=function(){var t="Encircling band, with Watzke in ";if(this.drawing.eye==ED.eye.Right)var e=!0;else var e=!1;var a=this.rotation+Math.PI/2;return t+=Math.cos(a)>0?"supero":"infero",t+=Math.sin(a)>0?e?"nasal":"temporal":e?"temporal":"nasal",t+=" quadrant"},ED.DrainageSite=function(t,e,a,r,i,o,s,n,l,h,d){this.className="DrainageSite",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.DrainageSite.prototype=new ED.Doodle,ED.DrainageSite.prototype.constructor=ED.DrainageSite,ED.DrainageSite.superclass=ED.Doodle.prototype,ED.DrainageSite.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.DrainageSite.prototype.setParameterDefaults=function(){var t=this.drawing.lastDoodleOfClass(this.className);this.rotation=t?t.rotation+Math.PI/6:-60*Math.PI/180},ED.DrainageSite.prototype.draw=function(t){var e=this.drawing.context;ED.DrainageSite.superclass.draw.call(this,t);var a=440,r=360,i=Math.PI/30,o=-Math.PI/2+i,s=-Math.PI/2-i;return e.beginPath(),e.arc(0,0,a,o,s,!0),e.lineTo(0,-r),e.closePath(),e.lineWidth=4,e.strokeStyle="#777",this.drawBoundary(t),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.DrainageSite.prototype.groupDescription=function(){return"Drainage site at "},ED.DrainageSite.prototype.description=function(){return this.clockHour()+" o'clock"},ED.RadialSponge=function(t,e,a,r,i,o,s,n,l,h,d){this.className="RadialSponge",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.RadialSponge.prototype=new ED.Doodle,ED.RadialSponge.prototype.constructor=ED.RadialSponge,ED.RadialSponge.superclass=ED.Doodle.prototype,ED.RadialSponge.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.addAtBack=!0},ED.RadialSponge.prototype.setParameterDefaults=function(){var t=this.drawing.lastDoodleOfClass(this.className);this.rotation=t?t.rotation+Math.PI/6:-60*Math.PI/180},ED.RadialSponge.prototype.draw=function(t){var e=this.drawing.context;ED.RadialSponge.superclass.draw.call(this,t);var a=-220,r=200,i=80;return e.beginPath(),e.moveTo(-i/2,a),e.lineTo(-i/2,a-r),e.lineTo(i/2,a-r),e.lineTo(i/2,a),e.closePath(),e.lineWidth=4,e.fillStyle="lightgray",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.arc(0,a-r+40,5,0,2*Math.PI,!0),e.lineTo(-20,a-r+30),e.moveTo(0,a-r+40),e.lineTo(20,a-r+30),e.moveTo(-i/2-20,a-40),e.lineTo(-i/2-20,a-r+40),e.lineTo(i/2+20,a-r+40),e.lineTo(i/2+20,a-40),e.closePath(),e.stroke()),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RadialSponge.prototype.groupDescription=function(){return"Radial sponge at "},ED.RadialSponge.prototype.description=function(){return this.clockHour()+" o'clock"},ED.Sclerostomy=function(t,e,a,r,i,o,s,n,l,h,d){this.className="Sclerostomy",this.parsPlana=-560,this.overallGauge="20g",this.gauge="23g",this.isSutured=!1,ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.Sclerostomy.prototype=new ED.Doodle,ED.Sclerostomy.prototype.constructor=ED.Sclerostomy,ED.Sclerostomy.superclass=ED.Doodle.prototype,ED.Sclerostomy.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Sclerostomy.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-660,-460),this.parameterValidationArray.overallGauge={kind:"derived",type:"string",list:["20g","23g","25g","27g"],animate:!1},this.parameterValidationArray.gauge={kind:"derived",type:"string",list:["20g","23g","25g","27g"],animate:!1},this.parameterValidationArray.isSutured={kind:"derived",type:"bool"}},ED.Sclerostomy.prototype.setParameterDefaults=function(){this.apexY=-600,this.gauge="23g",this.setRotationWithDisplacements(60,-45)},ED.Sclerostomy.prototype.dependentParameterValues=function(t,e){var a=[];switch(t){case"apexY":a.gauge=-610>e?"20g":-560>e?"23g":-510>e?"25g":"27g";break;case"overallGauge":a.gauge=e;break;case"gauge":a.apexY="20g"==e?-650:"23g"==e?-600:"25g"==e?-550:-500}return a},ED.Sclerostomy.prototype.draw=function(t){var e=this.drawing.context;if(ED.Sclerostomy.superclass.draw.call(this,t),e.beginPath(),e.rect(-60,this.parsPlana-120,120,160),e.lineWidth=2,e.strokeStyle="rgba(0, 0, 0, 0)",e.fillStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){switch(this.gauge){case"20g":e.beginPath(),e.moveTo(-50,this.parsPlana),e.bezierCurveTo(-30,this.parsPlana-30,30,this.parsPlana-30,50,this.parsPlana),e.bezierCurveTo(30,this.parsPlana+30,-30,this.parsPlana+30,-50,this.parsPlana),e.closePath(),e.fillStyle="red",e.fill();break;case"23g":e.beginPath(),e.rect(-60,this.parsPlana-120,120,60),e.fillStyle="rgba(0, 0, 255, 0.5)",e.fill(),e.beginPath(),e.rect(-30,this.parsPlana-60,60,60),e.fillStyle="rgba(120, 120, 120, 0.5)",e.fill(),e.beginPath(),e.rect(-30,this.parsPlana,60,100),e.fillStyle="rgba(220, 220, 220, 0.5)",e.fill();break;case"25g":e.beginPath(),e.rect(-50,this.parsPlana-120,100,60),e.fillStyle="rgba(255, 128, 0, 0.5)",e.fill(),e.beginPath(),e.rect(-20,this.parsPlana-60,40,60),e.fillStyle="rgba(120, 120, 120, 0.5)",e.fill(),e.beginPath(),e.rect(-20,this.parsPlana,40,100),e.fillStyle="rgba(220, 220, 220, 0.5)",e.fill();break;case"27g":e.beginPath(),e.rect(-40,this.parsPlana-120,80,60),e.fillStyle="rgba(0, 255, 0, 0.5)",e.fill(),e.beginPath(),e.rect(-15,this.parsPlana-60,30,60),e.fillStyle="rgba(120, 120, 120, 0.5)",e.fill(),e.beginPath(),e.rect(-15,this.parsPlana,30,100),e.fillStyle="rgba(220, 220, 220, 0.5)",e.fill()}e.fill(),(this.isSutured||"20g"==this.gauge)&&(e.beginPath(),e.moveTo(-40,this.parsPlana+40),e.lineTo(-40,this.parsPlana-40),e.lineTo(40,this.parsPlana+40),e.lineTo(40,this.parsPlana-40),e.lineTo(-40,this.parsPlana+40),e.lineWidth=6,e.strokeStyle="rgba(0,0,120,0.7)",e.closePath(),e.stroke())}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Sclerostomy.prototype.drawHighlightExtras=function(){var t=this.drawing.context;t.lineWidth=1,t.fillStyle="gray",t.font="64px sans-serif",t.fillText(this.gauge,80,this.parsPlana+20)},ED.Sclerostomy.prototype.groupDescription=function(){return"Sclerostomies at "},ED.Sclerostomy.prototype.description=function(){var t=this.isSutured?" (sutured)":"";return this.clockHour()+t},ED.Sclerostomy.prototype.groupDescriptionEnd=function(){return" o'clock"},ED.ChandelierSingle=function(t,e,a,r,i,o,s,n,l,h,d){this.className="ChandelierSingle",this.parsPlana=-560,ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.ChandelierSingle.prototype=new ED.Doodle,ED.ChandelierSingle.prototype.constructor=ED.ChandelierSingle,ED.ChandelierSingle.superclass=ED.Doodle.prototype,ED.ChandelierSingle.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.ChandelierSingle.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(180,90)},ED.ChandelierSingle.prototype.draw=function(t){var e=this.drawing.context;return ED.ChandelierSingle.superclass.draw.call(this,t),e.beginPath(),e.rect(-60,this.parsPlana-60,120,160),e.lineWidth=2,e.strokeStyle="rgba(0, 0, 0, 0)",e.fillStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(-20,this.parsPlana+60),e.lineTo(20,this.parsPlana+60),e.lineTo(20,this.parsPlana+120),e.lineTo(0,this.parsPlana+140),e.lineTo(-20,this.parsPlana+120),e.lineTo(-20,this.parsPlana+60),e.fillStyle="rgba(120, 120, 120, 0.5)",e.fill(),e.beginPath(),e.rect(-60,this.parsPlana,120,60),e.fillStyle="rgba(120, 120, 120, 1)",e.fill(),e.beginPath(),e.moveTo(0,this.parsPlana),e.bezierCurveTo(0,this.parsPlana-50,50,this.parsPlana-100,100,this.parsPlana-100),e.lineWidth=40,e.strokeStyle="rgba(120, 120, 120, 0.5)",e.stroke()),this.isClicked},ED.ChandelierSingle.prototype.groupDescription=function(){return"Chandelier at "},ED.ChandelierSingle.prototype.description=function(){return this.clockHour()+" o'clock"},ED.ChandelierDouble=function(t,e,a,r,i,o,s,n,l,h,d){this.className="ChandelierDouble",this.parsPlana=-560,ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.ChandelierDouble.prototype=new ED.Doodle,ED.ChandelierDouble.prototype.constructor=ED.ChandelierDouble,ED.ChandelierDouble.superclass=ED.Doodle.prototype,ED.ChandelierDouble.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.ChandelierDouble.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(180,90)},ED.ChandelierDouble.prototype.draw=function(t){var e=this.drawing.context;if(ED.ChandelierDouble.superclass.draw.call(this,t),e.beginPath(),e.rect(-120,this.parsPlana-60,240,160),e.lineWidth=2,e.strokeStyle="rgba(0, 0, 0, 0)",e.fillStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();var a=-80;e.moveTo(a-20,this.parsPlana+60),e.lineTo(a+20,this.parsPlana+60),e.lineTo(a+20,this.parsPlana+120),e.lineTo(a,this.parsPlana+140),e.lineTo(a-20,this.parsPlana+120),e.lineTo(a-20,this.parsPlana+60);var a=80;e.moveTo(a-20,this.parsPlana+60),e.lineTo(a+20,this.parsPlana+60),e.lineTo(a+20,this.parsPlana+120),e.lineTo(a,this.parsPlana+140),e.lineTo(a-20,this.parsPlana+120),e.lineTo(a-20,this.parsPlana+60),e.fillStyle="rgba(120, 120, 120, 0.5)",e.fill(),e.beginPath(),e.rect(-120,this.parsPlana,240,60),e.fillStyle="rgba(120, 120, 120, 1)",e.fill(),e.beginPath(),e.moveTo(0,this.parsPlana),e.bezierCurveTo(0,this.parsPlana-50,50,this.parsPlana-100,100,this.parsPlana-100),e.lineWidth=40,e.strokeStyle="rgba(120, 120, 120, 0.5)",e.stroke()}return this.isClicked},ED.ChandelierDouble.prototype.groupDescription=function(){return"Twin chandelier at "},ED.ChandelierDouble.prototype.description=function(){return this.clockHour()+" o'clock"},ED.CornealErosion=function(t,e,a,r,i,o,s,n,l,h,d){this.className="CornealErosion",this.isInVisualAxis=!1,ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.CornealErosion.prototype=new ED.Doodle,ED.CornealErosion.prototype.constructor=ED.CornealErosion,ED.CornealErosion.superclass=ED.Doodle.prototype,ED.CornealErosion.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.CornealErosion.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.isRotatable=!1,this.parameterValidationArray.originX.range.setMinAndMax(-150,150),this.parameterValidationArray.originY.range.setMinAndMax(-150,150),this.parameterValidationArray.scaleX.range.setMinAndMax(.25,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.25,2)},ED.CornealErosion.prototype.setParameterDefaults=function(){this.apexY=-50,this.scaleX=1.5,this.scaleY=1,this.setOriginWithDisplacements(0,25)},ED.CornealErosion.prototype.draw=function(t){var e=this.drawing.context;ED.CornealErosion.superclass.draw.call(this,t),e.beginPath();var a=120;e.arc(0,0,a,0,2*Math.PI,!1),e.closePath(),e.lineWidth=3,e.fillStyle="rgba(230, 230, 230, 0.25)",e.strokeStyle="rgba(100, 100, 100, 1)",this.drawBoundary(t);var r=new ED.Point(0,0);return r.setWithPolars(a,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(r),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CornealErosion.prototype.groupDescription=function(){return"Removal of some corneal epithelium"},ED.CutterPI=function(t,e,a,r,i,o,s,n,l,h,d){this.className="CutterPI",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.CutterPI.prototype=new ED.Doodle,ED.CutterPI.prototype.constructor=ED.CutterPI,ED.CutterPI.superclass=ED.Doodle.prototype,ED.CutterPI.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.CutterPI.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(160,40)},ED.CutterPI.prototype.draw=function(t){var e=this.drawing.context;return ED.CutterPI.superclass.draw.call(this,t),e.beginPath(),e.arc(0,-324,40,0,2*Math.PI,!0),e.fillStyle="rgba(255,255,255,1)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(t),this.isClicked},ED.CutterPI.prototype.groupDescription=function(){return"Cutter iridectomy/s"},ED.ScleralIncision=function(t,e,a,r,i,o,s,n,l,h,d){this.className="ScleralIncision",ED.Doodle.call(this,t,e,a,r,i,o,s,n,l,h,d)},ED.ScleralIncision.prototype=new ED.Doodle,ED.ScleralIncision.prototype.constructor=ED.ScleralIncision,ED.ScleralIncision.superclass=ED.Doodle.prototype,ED.ScleralIncision.prototype.setHandles=function(){this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1)},ED.ScleralIncision.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/16,Math.PI/2)},ED.ScleralIncision.prototype.setParameterDefaults=function(){this.arc=Math.PI/8,this.setRotationWithDisplacements(60,-120)},ED.ScleralIncision.prototype.draw=function(t){var e=this.drawing.context;ED.ScleralIncision.superclass.draw.call(this,t);var a=560,r=40,i=a+r,o=a-r;e.beginPath();var s=this.arc/2;if(e.arc(0,0,i,-Math.PI/2+s,-Math.PI/2-s,!0),e.arc(0,0,o,-Math.PI/2-s,-Math.PI/2+s,!1),e.closePath(),e.fillStyle="rgba(200,200,200,0)",e.lineWidth=5,e.strokeStyle="rgba(120,120,120,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.arc(0,0,a,-Math.PI/2+s,-Math.PI/2-s,!0);var n=.2,l=new ED.Point(0,0),h=s-n/2;do l.setWithPolars(a-r,h),e.moveTo(l.x,l.y),l.setWithPolars(a+r,h),e.lineTo(l.x,l.y),h-=n;while(h>-s);e.lineWidth=6,e.strokeStyle="rgba(120,120,120,0.75)",e.stroke()}var d=new ED.Point(0,0);return d.setWithPolars(a,s),this.handleArray[3].location=this.transform.transformPoint(d),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ScleralIncision.prototype.groupDescription=function(){return"Scleral incision at "},ED.ScleralIncision.prototype.description=function(){return this.clockHour()},ED.ScleralIncision.prototype.groupDescriptionEnd=function(){return" o'clock"};