/*! eyedraw 13-04-2013 */
function EyeDrawChecker(){this._eyedraws=[],this._eyedrawsReady=[],this._allReadyListeners=[];var t=this;$("canvas").each(function(){($(this).hasClass("ed_canvas_display")||$(this).hasClass("ed_canvas_edit"))&&t._eyedraws.push($(this).attr("id"))}),this.eyedrawReady=function(t){if($.inArray(t,this._eyedraws)>-1&&-1==$.inArray(t,this._eyedrawsReady)&&(this._eyedrawsReady.push(t),this.allEyedrawsReady()))for(var e=0;this._allReadyListeners.length>e;e++)this._allReadyListeners[e]()},this.allEyedrawsReady=function(){return this._eyedraws.length==this._eyedrawsReady.length?!0:!1},this.registerForReady=function(t){this.allEyedrawsReady()?t():this._allReadyListeners.push(t)}}function getOEEyeDrawChecker(){return OEEyeDrawChecker||(OEEyeDrawChecker=new EyeDrawChecker),OEEyeDrawChecker}function EyeDrawReadyListener(t){this.drawing=t;var e="right";this.drawing.eye&&(e="left"),this.side=e,this.drawing.registerForNotifications(this,"callBack",["doodlesLoaded"]),this.callBack=function(){checker=getOEEyeDrawChecker(),checker.eyedrawReady(this.drawing.canvas.id)}}function eyeDrawInit(t){function e(e){this.drawing=e,this.drawing.registerForNotifications(this,"notificationHandler",["ready","doodlesLoaded","doodleAdded","doodleDeleted","doodleSelected","mousedragged","parameterChanged"]),this.notificationHandler=function(e){var r=document.getElementById(t.inputId);switch(e.eventName){case"ready":if(null!=r&&r.value.length>0)this.drawing.loadDoodles(t.inputId),this.drawing.repaint();else for(var i=0;t.onReadyCommandArray.length>i;i++){var o=t.onReadyCommandArray[i][0],s=t.onReadyCommandArray[i][1];this.drawing[o].apply(this.drawing,s)}ED.objectIsEmpty(t.bindingArray)||this.drawing.addBindings(t.bindingArray),ED.objectIsEmpty(t.deleteValueArray)||this.drawing.addDeleteValues(t.deleteValueArray),null!=r&&(r.value=window[t.drawingName].save()),t.focus&&a.focus();break;case"doodlesLoaded":for(var i=0;t.onDoodlesLoadedCommandArray.length>i;i++){var o=t.onDoodlesLoadedCommandArray[i][0],s=t.onDoodlesLoadedCommandArray[i][1];this.drawing[o].apply(this.drawing,s)}break;case"doodleAdded":null!=r&&r.value.length>0&&(r.value=this.drawing.save());break;case"doodleDeleted":null!=r&&r.value.length>0&&(r.value=this.drawing.save());break;case"doodleSelected":for(var n in t.syncArray){var l=window["ed_drawing_edit_"+n];l.deselectDoodles()}break;case"mousedragged":null!=r&&r.value.length>0&&(r.value=this.drawing.save());break;case"parameterChanged":var h=e.object.doodle;for(var n in t.syncArray){var d=window["ed_drawing_edit_"+n];for(var c in t.syncArray[n])for(var p in t.syncArray[n][c]){var D=d.firstDoodleOfClass(p);if(h&&h.className==c&&D&&D.willSync){var u=t.syncArray[n][c][p].parameters;if(u!==void 0)for(var i=0;u.length>i;i++)if(u[i]==e.object.parameter&&h[e.object.parameter]!=D[e.object.parameter]){var y=e.object.value-e.object.oldValue,g=D[e.object.parameter]+y;D.setSimpleParameter(e.object.parameter,g),D.updateDependentParameters(e.object.parameter),d.updateBindings(D)}}}d.repaint()}null!=r&&r.value.length>0&&(r.value=this.drawing.save())}}}var a=document.getElementById(t.canvasId),r=[];r.offsetX=t.offsetX,r.offsetY=t.offsetY,r.toImage=t.toImage,r.graphicsPath=t.graphicsPath,window[t.drawingName]=new ED.Drawing(a,t.eye,t.idSuffix,t.isEditable,r),window["ed_controller_"+t.idSuffix]=new e(window[t.drawingName]);for(var i=[],o=0;t.listenerArray.length>o;o++)i[o]=new t.listenerArray[o](window[t.drawingName]);i.push(new EyeDrawReadyListener(window[t.drawingName])),window[t.drawingName].init()}var OEEyeDrawChecker;